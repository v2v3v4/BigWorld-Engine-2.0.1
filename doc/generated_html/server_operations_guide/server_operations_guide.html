<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Server Operations Guide</title><link rel="stylesheet" href="../css/bigworld.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div id="bigworld-header"><img src="http://try.bigworldtech.com/bigworld/image.php?img=bigworld_logo.gif&amp;svn=$HeadURL:$" alt="bw logo"></div><div id="content"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="Server_Operations_Guide"></a>Server Operations Guide</h1></div><div><p class="releaseinfo">BigWorld Technology 2.0. Released 2010.</p></div><div><p class="copyright">Copyright &copy; 1999-2010 BigWorld Pty Ltd. All rights reserved. </p></div><div><div class="legalnotice"><a name="d0e17"></a><p>This document is proprietary commercial in confidence and access
  is restricted to authorised users. This document is protected by
  copyright laws of Australia, other countries and international treaties.
  Unauthorised use, reproduction or distribution of this document, or any
  portion of this document, may result in the imposition of civil and
  criminal penalties as provided by law.</p></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="chapter"><a href="#xref_Introduction">1. Introduction</a></span></dt><dt><span class="chapter"><a href="#xref_Server_Configuration_With_bw_xml">2. Server Configuration with <span class="literal">bw.xml</span></a></span></dt><dd><dl><dt><span class="section"><a href="#xref_The_Entry_parentFile">2.1. The entry <span class="literal">parentFile</span></a></span></dt><dt><span class="section"><a href="#xref_User_Dependent_Configuration">2.2. User dependent configuration</a></span></dt><dt><span class="section"><a href="#xref_Command_Line_Options_Override_XML">2.3. Command-Line Options</a></span></dt><dt><span class="section"><a href="#xref_General_Configuration_Options">2.4. General Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e1179">2.5. Billing System Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Network_Configuration_Options">2.6. Network Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Network_Address_Translation_Configuration_Options">2.7. Network Address Translation Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Load_Balancing_Configuration_Options">2.8. Load Balancing Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1509">2.8.1. Entities Cardinality Configuration Options</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_BaseApp_Configuration_Options">2.9. BaseApp Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_BaseApp_Secondary_Database_Configuration_Options">2.9.1. Secondary Database Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e2042">2.9.2. Packet Log Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e2099">2.9.3. ID Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e2164">2.9.4. Client Upstream Limits</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_BaseAppMgr_Configuration_Options">2.10. BaseAppMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Bots_Configuration_Options">2.11. Bots Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_CellApp_Configuration_Options">2.12. CellApp Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3128">2.12.1. Noise Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e3225">2.12.2. ID Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e3290">2.12.3. CellApp Profiles Configuration Options</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_CellAppMgr_Configuration_Options">2.13. CellAppMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_DBMgr_Configuration_Options">2.14. DBMgr Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4134">2.14.1. Data Consolidation Options</a></span></dt><dt><span class="section"><a href="#d0e4170">2.14.2. XML Database Options</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_LoginApp_Configuration_Options">2.15. LoginApp Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Reviver_Configuration_Options">2.16. Reviver Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4662">2.16.1. Reviver's BaseAppMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e4698">2.16.2. Reviver's CellAppMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e4734">2.16.3. Reviver's DBMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e4770">2.16.4. Reviver's LoginApp Configuration Options</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xref_Admin_Tools">3. Cluster Administration Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_WebConsole">3.1. WebConsole</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4878">3.1.1. Modules</a></span></dt><dt><span class="section"><a href="#xref_WebConsole_Installation_And_Configuration">3.1.2. Installation and Configuration</a></span></dt><dt><span class="section"><a href="#xref_WebConsole_User_Admin">3.1.3. User Administration</a></span></dt><dt><span class="section"><a href="#xref_WebConsole_Modes">3.1.4. Production Mode vs Development Mode</a></span></dt><dt><span class="section"><a href="#xref_WebConsole_Customising">3.1.5. Customising</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_MessageLogger">3.2. Message Logger</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5217">3.2.1. Configuration</a></span></dt><dt><span class="section"><a href="#d0e5275">3.2.2. File Format</a></span></dt><dt><span class="section"><a href="#xref_Command_Line_Utilities">3.2.3. Command Line Utilities</a></span></dt><dt><span class="section"><a href="#d0e5562">3.2.4. Automatic Log Archiving</a></span></dt><dt><span class="section"><a href="#xref_MessageLogger_Scalability">3.2.5. Production Scalability</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_StatLogger">3.3. StatLogger</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5664">3.3.1. Requirements</a></span></dt><dt><span class="section"><a href="#d0e5715">3.3.2. Output</a></span></dt><dt><span class="section"><a href="#xref_StatLogger_Data_Collection_And_Aggregation">3.3.3. Data Collection and Aggregation</a></span></dt><dt><span class="section"><a href="#xref_StatLogger_Configuration">3.3.4. Configuration</a></span></dt><dt><span class="section"><a href="#d0e6167">3.3.5. Database</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Server_Command_Line_Utilities">3.4. Server Command-Line Utilities</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_control_cluster_py">3.4.1. Control Cluster</a></span></dt><dt><span class="section"><a href="#d0e6634">3.4.2. MessageLogger Related Utilities</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Space_Viewer">3.5. Space Viewer</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6693">3.5.1. Selecting Spaces to View</a></span></dt><dt><span class="section"><a href="#d0e6711">3.5.2. Viewing Spaces</a></span></dt><dt><span class="section"><a href="#xref_Customising_Entity_And_Display_Colours">3.5.3. Customising Entity and Display Colours</a></span></dt><dt><span class="section"><a href="#xref_Running_Space_Viewer_Remotely">3.5.4. Running Space Viewer Remotely</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xref_Fault_Tolerance">4. Fault Tolerance</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_CellApp_Fault_Tolerance">4.1. CellApp Fault Tolerance</a></span></dt><dt><span class="section"><a href="#xref_BaseApp_Fault_Tolerance">4.2. BaseApp Fault Tolerance</a></span></dt><dt><span class="section"><a href="#xref_Fault_Tolerance_With_Reviver">4.3. Fault Tolerance with Reviver</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_Specifying_Components_To_Support">4.3.1. Specifying Components to Support</a></span></dt><dt><span class="section"><a href="#xref_Reviver_Layout">4.3.2. Recommended Reviver Layout</a></span></dt><dt><span class="section"><a href="#xref_Command_Line_Options">4.3.3. Command-Line Options</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xref_Backups_And_Disaster_Recovery">5. Backups and Disaster Recovery</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_Disaster_Recovery">5.1. Disaster Recovery</a></span></dt><dt><span class="section"><a href="#xref_Database_Snapshot_Tool">5.2. Database Snapshot Tool</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7097">5.2.1. Operational Behaviour</a></span></dt><dt><span class="section"><a href="#d0e7130">5.2.2. Usage</a></span></dt><dt><span class="section"><a href="#xref_Snapshot_Tool_Requirements">5.2.3. Requirements</a></span></dt><dt><span class="section"><a href="#xref_Partitioning">5.2.4. Partitioning</a></span></dt><dt><span class="section"><a href="#xref_Snapshot_Tool_Configuration">5.2.5. Configuration</a></span></dt><dt><span class="section"><a href="#d0e7540">5.2.6. Restoring From a Snapshot</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Data_Consolidation_Tool">5.3. Data Consolidation Tool</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_Skipping_Data_Consolidation">5.3.1. Skipping Data Consolidation</a></span></dt><dt><span class="section"><a href="#xref_Ignoring_SQLite_Errors">5.3.2. Ignoring SQLite Errors</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xref_Controlled_Startup_And_Shutdown">6. Controlled Startup and Shutdown</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7751">6.1. Server-wide Shutdown</a></span></dt><dt><span class="section"><a href="#d0e7836">6.2. Individual Application Retirement</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7841">6.2.1. BaseApp Retirement</a></span></dt><dt><span class="section"><a href="#d0e7852">6.2.2. CellApp Retirement</a></span></dt><dt><span class="section"><a href="#d0e7857">6.2.3. Retirement via WebConsole</a></span></dt><dt><span class="section"><a href="#d0e7867">6.2.4. Retirement via <span class="literal">control_cluster.py</span></a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xref_Stress_Testing_With_Bots">7. Stress Testing with Bots</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7886">7.1. The Login Process</a></span></dt><dt><span class="section"><a href="#d0e8009">7.2. Python Interface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8021">7.2.1. Python Controller (<span class="literal">bot_op.py</span>)</a></span></dt><dt><span class="section"><a href="#d0e8127">7.2.2. Methods and Attributes</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Controlling_Movement">7.3. Controlling Movement</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_NodeProperties_Section">7.3.1. NodeProperties Section</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8646">7.4. Extending Bots</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8649">7.4.1. Creating New Movement Controllers</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Bots_Misc">7.5. Miscellaneous Bots Issues</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_Bots_Misc_File_Descriptor_Limit">7.5.1. Running out of File Descriptors</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xref_Security">8. Security</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8715">8.1. Security of the Server</a></span></dt><dt><span class="section"><a href="#xref_Security_Server_Ports">8.2. Server Ports</a></span></dt><dt><span class="section"><a href="#xref_Blocking_Ports_And_Related_Security_Considerations">8.3. Blocking Ports and Related Security Considerations</a></span></dt></dl></dd><dt><span class="chapter"><a href="#xref_BigWorld_Server_Across_Multiple_Machines">9. BigWorld Server Across Multiple Machines</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8912">9.1. How To Start</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8917">9.1.1. WebConsole</a></span></dt><dt><span class="section"><a href="#d0e8926">9.1.2. Auto Configuration Via
      <span class="literal">control_cluster.py</span></a></span></dt><dt><span class="section"><a href="#d0e8938">9.1.3. Hard-Coded Scripts</a></span></dt><dt><span class="section"><a href="#d0e8946">9.1.4. Manual Start</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8951">9.2. How To Stop</a></span></dt><dt><span class="section"><a href="#d0e8967">9.3. How To Monitor</a></span></dt><dt><span class="section"><a href="#xref_LoginApp_And_Scalability">9.4. LoginApp and Scalability</a></span></dt></dl></dd><dt><span class="chapter"><a href="#xref_Multiple_BigWorld_Servers_In_A_Single_LAN">10. Multiple BigWorld Servers in a Single LAN</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9057">10.1. Keeping Processes Separate</a></span></dt><dt><span class="section"><a href="#d0e9067">10.2. Centralised Cluster Monitoring</a></span></dt><dt><span class="section"><a href="#xref_Auto_Detections_Of_LoginApps">10.3. Auto-Detection of LoginApps</a></span></dt></dl></dd><dt><span class="chapter"><a href="#xref_DBMgr_MySQL_Support">11. MySQL Support</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_Compiling_DBMgr_With_MySQL_Support">11.1. Compiling DBMgr with MySQL Support</a></span></dt><dt><span class="section"><a href="#d0e9133">11.2. Update <code class="filename">bw.xml</code> To Use MySQL</a></span></dt><dt><span class="section"><a href="#xref_Initialise_Database_With_Entity_Definitions">11.3. Synchronise Database With Entity Definitions</a></span></dt><dt><span class="section"><a href="#xref_Enabling_Secondary_Databases">11.4. Enabling Secondary Databases</a></span></dt><dt><span class="section"><a href="#xref_MySQL_Privileges">11.5. Privileges</a></span></dt><dt><span class="section"><a href="#d0e9332">11.6. The ClearAutoLoad tool</a></span></dt></dl></dd><dt><span class="chapter"><a href="#xref_RPM">12. RPM</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9390">12.1. Directory Structures and Files</a></span></dt><dt><span class="section"><a href="#d0e9426">12.2. How to Generate Binary RPM Packages</a></span></dt><dt><span class="section"><a href="#d0e9521">12.3. Customising RPM Packages</a></span></dt><dt><span class="section"><a href="#d0e9597">12.4. Setting up a Yum Repository</a></span></dt><dt><span class="section"><a href="#d0e9710">12.5. Install, Upgrade and Uninstall using Yum Command</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9718">12.5.1. Install and Upgrade using a RPM Package Directly</a></span></dt><dt><span class="section"><a href="#d0e9751">12.5.2. Install and Upgrade using Yum Repository</a></span></dt><dt><span class="section"><a href="#d0e9765">12.5.3. Remove an Installed Package</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e9772">12.6. How to Obtain Version Number of an Installed Package</a></span></dt></dl></dd><dt><span class="chapter"><a href="#xref_First_Aid_After_Crash">13. First Aid After a Crash</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9811">13.1. Change your coredump output directory, if necessary</a></span></dt><dt><span class="section"><a href="#d0e9842">13.2. Determine the first process(es) that crashed</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9854">13.2.1. BigWorld logs</a></span></dt><dt><span class="section"><a href="#d0e9868">13.2.2. Chronologically listing core files</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Generate_Stack_Trace">13.3. Generate a stack trace of the process that crashed</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9927">13.3.1. Troubleshooting</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Retrieve_Crash_Logs">13.4. Retrieve relevant log information</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9960">13.4.1. Generating a log summary from a core file</a></span></dt><dt><span class="section"><a href="#d0e9975">13.4.2. Archiving all logs</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e9989">13.5. Back up the crash information</a></span></dt><dt><span class="section"><a href="#d0e10030">13.6. Notify BigWorld Support of the crash</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e10061">13.6.1. Uploading large files</a></span></dt><dt><span class="section"><a href="#d0e10083">13.6.2. Providing BigWorld access to your server cluster</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#xref_Common_Log_Messages">14. Common Log Messages</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e10093">14.1. Warnings</a></span></dt><dt><span class="section"><a href="#d0e10198">14.2. Errors</a></span></dt></dl></dd><dt><span class="chapter"><a href="#xref_Clock">15. Clock</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e10259">15.1. BigWorld Timing Methods</a></span></dt><dt><span class="section"><a href="#xref_Clock_source">15.2. Linux Clock Source</a></span></dt></dl></dd><dt><span class="chapter"><a href="#xref_Machine_Groups">16. Machine Groups and Categories</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e10340">16.1. Introduction</a></span></dt><dt><span class="section"><a href="#xref_BWMachined_Machine_Groups">16.2. Configuration</a></span></dt><dt><span class="section"><a href="#d0e10381">16.3. User Defined Categories</a></span></dt></dl></dd></dl></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Introduction"></a>Chapter&nbsp;1.&nbsp;Introduction</h2></div></div></div><p>BigWorld Technology is BigWorld's middleware for implementing
  Massively Multiplayer Online Games. This document is a guide to performing
  operations with the server software. It is not intended for game designers
  or game logic implementers, but rather for 'machine room' or 'cluster
  control' operators and administrators.</p><p>It is assumed that the server has been installed according to the
  instructions in the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_installation_guide/server_installation_guide.html#Server_Installation_Guide" class="olink">Server Installation Guide</a>.
  An understanding of the basic BigWorld processes is also assumed. For more
  details on these processes, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s chapters <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Design_Introduction" class="olink"><i>Design Introduction</i></a> and <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For details on BigWorld terminology, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../glossary_of_terms/glossary_of_terms.html#Glossary_Of_Terms" class="olink">Glossary of Terms</a>.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Server_Configuration_With_bw_xml"></a>Chapter&nbsp;2.&nbsp;Server Configuration with <span class="literal">bw.xml</span></h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#xref_The_Entry_parentFile">2.1. The entry <span class="literal">parentFile</span></a></span></dt><dt><span class="section"><a href="#xref_User_Dependent_Configuration">2.2. User dependent configuration</a></span></dt><dt><span class="section"><a href="#xref_Command_Line_Options_Override_XML">2.3. Command-Line Options</a></span></dt><dt><span class="section"><a href="#xref_General_Configuration_Options">2.4. General Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e1179">2.5. Billing System Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Network_Configuration_Options">2.6. Network Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Network_Address_Translation_Configuration_Options">2.7. Network Address Translation Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Load_Balancing_Configuration_Options">2.8. Load Balancing Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e1509">2.8.1. Entities Cardinality Configuration Options</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_BaseApp_Configuration_Options">2.9. BaseApp Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_BaseApp_Secondary_Database_Configuration_Options">2.9.1. Secondary Database Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e2042">2.9.2. Packet Log Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e2099">2.9.3. ID Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e2164">2.9.4. Client Upstream Limits</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_BaseAppMgr_Configuration_Options">2.10. BaseAppMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Bots_Configuration_Options">2.11. Bots Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_CellApp_Configuration_Options">2.12. CellApp Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e3128">2.12.1. Noise Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e3225">2.12.2. ID Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e3290">2.12.3. CellApp Profiles Configuration Options</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_CellAppMgr_Configuration_Options">2.13. CellAppMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_DBMgr_Configuration_Options">2.14. DBMgr Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4134">2.14.1. Data Consolidation Options</a></span></dt><dt><span class="section"><a href="#d0e4170">2.14.2. XML Database Options</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_LoginApp_Configuration_Options">2.15. LoginApp Configuration Options</a></span></dt><dt><span class="section"><a href="#xref_Reviver_Configuration_Options">2.16. Reviver Configuration Options</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4662">2.16.1. Reviver's BaseAppMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e4698">2.16.2. Reviver's CellAppMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e4734">2.16.3. Reviver's DBMgr Configuration Options</a></span></dt><dt><span class="section"><a href="#d0e4770">2.16.4. Reviver's LoginApp Configuration Options</a></span></dt></dl></dd></dl></div><p>The single most important configuration file on the server is
  <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>,
  where <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em></span> is the
  resource tree used by the server (usually specified in
  <span class="literal">~/.bwmachined.conf</span>).</p><p>All sever processes read this file. It contains many parameters, all
  of which are described in this chapter. The default values are appropriate
  for many different games, and care should be taken when changing them, since
  it might affect performance.</p><p>On the description of the parameters, please note the
  following:</p><div class="itemizedlist"><ul type="disc"><li><p>Boolean parameters should be specified as true or false.</p></li><li><p>Where a tag is specified as
      <span class="literal"><em class="replaceable"><code>tag1</code></em>/<em class="replaceable"><code>tag2</code></em></span>,
      the second tag is specified inside the scope of the first one. For
      example, the tag <span class="literal">dbMgr/allowEmptyDigest</span> is specified
      as:</p></li></ul></div><pre class="programlisting">&lt;dbMgr&gt;
  &lt;allowEmptyDigest&gt; true &lt;/allowEmptyDigest&gt;
&lt;/dbMgr&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_The_Entry_parentFile"></a>2.1.&nbsp;The entry <span class="literal">parentFile</span></h2></div></div></div><p>The entry <span class="literal">parentFile</span> in the configuration file
    specifies the next file in the chain of files where BigWorld should look
    for an entry for a configuration option.</p><p>To assign a default value to a configuration option, BigWorld
    follows the steps below:</p><div class="itemizedlist"><ul type="disc"><li><p>Searches for an entry for the configuration option in file
        <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>.</p></li><li><p>If the file does not contain an entry for the configuration
        option, then the chain of configuration files is inspected, until the
        entry is found.</p></li><li><p>If the entry is not specified in any of these files, a
        hard-coded default is used.</p></li></ul></div><p>All default values for a production environment are stored in file
    <code class="filename">bigworld/res/server/production_defaults.xml</code>. The file
    <code class="filename">bigworld/res/server/development_defaults.xml</code>
    specialises this with default values for a development environment.
    Typically, the entry <span class="literal">parentFile</span> in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span> is
    set to either <span class="literal">server/production_defaults.xml</span> or
    <span class="literal">server/development_defaults.xml</span>, and only non-default
    options are stored in your <span class="literal">server/bw.xml</span>.</p><p>The example below shows the configuration option
    <span class="literal">maxCPUOffload</span> in section <span class="literal">balance</span>
    having its default value overridden:</p><div class="informalfigure"><div class="mediaobject"><img src="images/overriding_default_values_for_configuration_options.png"><span class="caption"><p>Overriding default values for configuration
        options</p></span></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_User_Dependent_Configuration"></a>2.2.&nbsp;User dependent configuration</h2></div></div></div><p>A file that is user dependent can be used instead of
    <code class="code">bw.xml</code>. This is useful to allow multiple users to run from
    the same resource tree. In a production environment, for example, you may
    run the resources using a test user before using the production
    user.</p><p>If a file with the name <code class="code">server/bw_&lt;username&gt;.xml</code>
    exists, this is used as the start of the server configuration chain
    instead of <code class="code">server/bw.xml</code>.</p><p>Typically, the <code class="code">parentFile</code> section in this file would
    refer to <code class="code">server/bw.xml</code> and only options specific to the user,
    such as <code class="code">dbMgr/databaseName</code> would be in this file.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Command_Line_Options_Override_XML"></a>2.3.&nbsp;Command-Line Options</h2></div></div></div><p>The configuration options specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    can also be overridden via command-line arguments.</p><p>To override a default value, add arguments in the format
    <span class="literal">+optionName</span> value.</p><p>The example shows the <span class="literal">baseApp</span> section's
    configuration option <span class="literal">pythonPort</span> having its default
    value changed to <span class="literal">40001</span>, and the option
    <span class="literal">archivePeriod</span> changed to <span class="literal">0</span>:</p><pre class="programlisting">baseapp +baseApp/pythonPort 40001 +baseApp/archivePeriod 0</pre><p>Values changed via the command line are not sent to components
    started via BWMachined. This includes using WebConsole,
    <span class="literal">control_cluster.py</span>, and components started by a Reviver
    process.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_General_Configuration_Options"></a>2.4.&nbsp;General Configuration Options</h2></div></div></div><p>The list below describes the general configuration options:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">bitsPerSecondToClient</span>
        (Integer)</em></p><p>Desired default bandwidth from server to the client. To
        calculate the number of bytes to be sent in each packet, the formula
        below is used (where <span class="literal">UDP_OVERHEAD</span> is 28
        bytes):</p><p><span class="literal">packetSize = (bitsPerSecondToClient / 8 /
        gameUpdateHertz) - UDP_OVERHEAD</span></p></li><li><p><em class="emphasis"><span class="literal">debugConfigOptions</span>
        (Integer)</em></p><p>Level of logging information generated when processing
        configuration parameters in file
        <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/
        bw.xml</span>.</p><p>The possible values are described in the list below:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">0 </em></p><p>No log is generated.</p></li><li><p><em class="emphasis">1</em></p><p>A log message is generated for each configuration option
            read.</p></li><li><p><em class="emphasis">2</em></p><p>A verbose message is generated for each configuration option
            read.</p></li></ul></div></li><li><p><em class="emphasis"><span class="literal">desiredBaseApps</span>
        (Integer)</em></p><p>Number of BaseApps that need to be running for the server to
        start.</p></li><li><p><em class="emphasis"><span class="literal">desiredCellApps</span>
        (Integer)</em></p><p>Number of CellApps that need to be running for the server to
        start.</p></li><li><p><em class="emphasis"><span class="literal">externalInterface</span>
        (String)</em></p><p>Network adapter interface to use for external communication, if
        not explicitly set by the server component.</p><p>In a production environment, BaseApps are recommended to have
        two Ethernet adapters: one adapter connected to the Internet, and a
        separate one connected to the internal LAN.</p><p>During development, there is no problem with using the same
        interface.</p><p>Accepted formats are:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">Adapter name</em> <span class="symbol">&#8208;</span> Examples: <span class="literal">eth0</span>,
            <span class="literal">eth1</span></p></li><li><p><em class="emphasis">IP<span class="literal">[/netmask</span>]</em> <span class="symbol">&#8208;</span> Examples: <span class="literal">10.5.2.1,
            10.0.0.0/8</span>, <span class="literal">192.168.5.0/24</span></p></li><li><p><em class="emphasis">Domain name</em> <span class="symbol">&#8208;</span> Examples:
            <span class="literal">intern0.cluster/24</span>,
            <span class="literal">extern5.cluster/24</span></p></li></ul></div><p>This value can be overridden by a tag with same name in the
        following sections:</p><div class="itemizedlist"><ul type="circle"><li><p><span class="literal">baseApp</span> <span class="symbol">&#8208;</span> For more details, see <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>.</p></li><li><p><span class="literal">loginApp</span> <span class="symbol">&#8208;</span> For more details, see <a href="#xref_LoginApp_Configuration_Options" title="2.15.&nbsp;LoginApp Configuration Options">LoginApp Configuration Options</a>.</p></li></ul></div></li><li><p><em class="emphasis"><span class="literal">externalLatencyMax</span>
        (Float)</em></p><p>Maximum number of seconds by which packets sent from the server
        process will be artificially delayed. Each packet will be randomly
        delayed between this value and externalLatencyMin.</p><p>This value can be overridden by a tag with the same name in the
        following sections:</p><div class="itemizedlist"><ul type="circle"><li><p><span class="literal">baseApp</span> <span class="symbol">&#8208;</span> For more details, see <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>.</p></li><li><p><span class="literal">loginApp</span> <span class="symbol">&#8208;</span> For more details, see <a href="#xref_LoginApp_Configuration_Options" title="2.15.&nbsp;LoginApp Configuration Options">LoginApp Configuration Options</a>.</p></li></ul></div><p><em class="emphasis">This feature is useful for testing during
        development.</em></p><p>See also <span class="literal">externalLossRatio</span>,
        <span class="literal">xref_externalLatencyMin</span></p></li><li><p><em class="emphasis"><span class="literal">externalLatencyMin</span>
        (Float)</em></p><p>Minimum number of seconds by which packets sent from the server
        process will be artificially delayed. Each packet will be randomly
        delayed between this value and externalLatencyMax.</p><p>This value can be overridden by a tag with the same name in the
        following sections:</p><div class="itemizedlist"><ul type="circle"><li><p><span class="literal">baseApp</span> <span class="symbol">&#8208;</span> For more details, see <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>.</p></li><li><p><span class="literal">loginApp</span> <span class="symbol">&#8208;</span> For more details, see <a href="#xref_LoginApp_Configuration_Options" title="2.15.&nbsp;LoginApp Configuration Options">LoginApp Configuration Options</a>.</p></li></ul></div><p><em class="emphasis">This feature is useful for testing during
        development.</em></p><p>See also <span class="literal">xref_externalLossRatio</span>,
        <span class="literal">xref_externalLatencyMax</span></p></li><li><p><em class="emphasis"><span class="literal">externalLossRatio</span>
        (Float)</em></p><p>Proportion of outgoing packets that will be dropped by this
        processes external nub to simulate loss on the external network. This
        is a value between 0.0 and 1.0 indicating what proportion of packets
        will be dropped.</p><p>This value can be overridden by a tag with the same name in the
        following sections:</p><div class="itemizedlist"><ul type="circle"><li><p><span class="literal">baseApp</span> <span class="symbol">&#8208;</span> For more details, see <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>.</p></li><li><p><span class="literal">loginApp</span> <span class="symbol">&#8208;</span> For more details, see <a href="#xref_LoginApp_Configuration_Options" title="2.15.&nbsp;LoginApp Configuration Options">LoginApp Configuration Options</a>.</p></li></ul></div><p><em class="emphasis">This feature is useful for testing during
        development.</em></p><p>See also <span class="literal">xref_externalLatencyMin</span>,
        <span class="literal">xref_externalLatencyMax</span></p></li><li><p><em class="emphasis"><span class="literal">gameUpdateHertz</span>
        (Integer)</em></p><p>Number of times per second that the server should send an update
        to the clients. This corresponds to the game tick frequency.</p></li><li><p><em class="emphasis"><span class="literal">hasDevelopmentAssertions</span>
        (Boolean)</em></p><p>Flag indicating whether server should be aggressive in its use
        of assertions.</p><p>This option should be set to true during development, and to
        false when running a production server.</p><p>For example, if this option is set to true, then a corrupted
        packet sent from a client can cause an assertion on the server, while
        if this is set to false, then only an error message is generated and
        the server component continues to run.</p></li><li><p><em class="emphasis"><span class="literal">internalInterface</span></em><em class="emphasis"> (String)</em></p><p><em class="emphasis">This tag is deprecated, and its use is not
        recommended. For details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>
        <span class="symbol">&#8594;</span> <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined" class="olink">BWMachined</a> <span class="symbol">&#8594;</span> <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined_Interface_Discovery" class="olink">BWMachined Interface Discovery</a>.</em></p><p>Network adapter interface to use for internal communication, if
        not explicitly set by the server component.</p><p>Accepted formats are:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">Adapter name</em> <span class="symbol">&#8208;</span> Examples: <span class="literal">eth0</span>,
            <span class="literal">eth1</span></p></li><li><p><em class="emphasis">IP<span class="literal">[/netmask]</span></em> <span class="symbol">&#8208;</span> Examples: <span class="literal">10.5.2.1,
            10.0.0.0/8</span>, <span class="literal">192.168.5.0/24</span></p></li><li><p><em class="emphasis">Domain name</em> <span class="symbol">&#8208;</span> Examples:
            <span class="literal">intern0.clust/24</span>,
            <span class="literal">extern5.clust/24</span></p></li></ul></div><p>This value can be overridden by a tag with the same name in the
        following sections:</p><div class="itemizedlist"><ul type="circle"><li><p><span class="literal">baseApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>.</p></li><li><p><span class="literal">baseAppMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_BaseAppMgr_Configuration_Options" title="2.10.&nbsp;BaseAppMgr Configuration Options">BaseAppMgr Configuration Options</a>.</p></li><li><p><span class="literal">cellApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_CellApp_Configuration_Options" title="2.12.&nbsp;CellApp Configuration Options">CellApp Configuration Options</a>.</p></li><li><p><span class="literal">cellAppMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_CellAppMgr_Configuration_Options" title="2.13.&nbsp;CellAppMgr Configuration Options">CellAppMgr Configuration Options</a>.</p></li><li><p><span class="literal">dbMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_DBMgr_Configuration_Options" title="2.14.&nbsp;DBMgr Configuration Options">DBMgr Configuration Options</a>.</p></li><li><p><span class="literal">loginApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_LoginApp_Configuration_Options" title="2.15.&nbsp;LoginApp Configuration Options">LoginApp Configuration Options</a>.</p></li></ul></div></li><li><p><em class="emphasis"><span class="literal">internalLatencyMax</span>
        (Float)</em></p><p>Maximum number of seconds by which packets sent from the
        application's internal nub will be delayed.</p><p>For more details, see
        <span class="literal">internalLatencyMin</span>.</p><p>See also <span class="literal">internalLossRatio</span>.</p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMin</span>
        (Float)</em></p><p>Minimum number of seconds by which packets sent from the
        application's internal nub will be delayed.</p><p>Each packet will be randomly delayed between this value and
        <span class="literal">internalLatencyMax</span>.</p><p><em class="emphasis">This feature is useful for testing during
        development.</em></p><p>This value can be overridden by a tag with the same name in the
        following sections:</p><div class="itemizedlist"><ul type="circle"><li><p><span class="literal">baseApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>.</p></li><li><p><span class="literal">baseAppMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_BaseAppMgr_Configuration_Options" title="2.10.&nbsp;BaseAppMgr Configuration Options">BaseAppMgr Configuration Options</a>.</p></li><li><p><span class="literal">cellApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_CellApp_Configuration_Options" title="2.12.&nbsp;CellApp Configuration Options">CellApp Configuration Options</a>.</p></li><li><p><span class="literal">cellAppMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_CellApp_Configuration_Options" title="2.12.&nbsp;CellApp Configuration Options">CellApp Configuration Options</a>.</p></li><li><p><span class="literal">dbMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_DBMgr_Configuration_Options" title="2.14.&nbsp;DBMgr Configuration Options">DBMgr Configuration Options</a>.</p></li><li><p><span class="literal">loginApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_LoginApp_Configuration_Options" title="2.15.&nbsp;LoginApp Configuration Options">LoginApp Configuration Options</a>.</p></li><li><p><span class="literal">reviver</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_Reviver_Configuration_Options" title="2.16.&nbsp;Reviver Configuration Options">Reviver Configuration Options</a>.</p></li></ul></div><p>See also options <span class="literal">internalLatencyMax</span> and
        <span class="literal">internalLossRatio</span>.</p></li><li><p><em class="emphasis"><span class="literal">internalLossRatio</span>
        (Float)</em></p><p>Proportion of packets on this application's internal nub that
        will be dropped to simulate loss on the internal network. This is a
        ratio between 0.0 and 1.0.</p><p><em class="emphasis">This feature is useful for testing during
        development.</em></p><p>This value can be overridden by a tag with the same name in the
        following sections:</p><div class="itemizedlist"><ul type="circle"><li><p><span class="literal">baseApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>.</p></li><li><p><span class="literal">baseAppMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_BaseAppMgr_Configuration_Options" title="2.10.&nbsp;BaseAppMgr Configuration Options">BaseAppMgr Configuration Options</a>.</p></li><li><p><span class="literal">cellApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_CellApp_Configuration_Options" title="2.12.&nbsp;CellApp Configuration Options">CellApp Configuration Options</a>.</p></li><li><p><span class="literal">cellAppMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_CellApp_Configuration_Options" title="2.12.&nbsp;CellApp Configuration Options">CellApp Configuration Options</a>.</p></li><li><p><span class="literal">dbMgr</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_DBMgr_Configuration_Options" title="2.14.&nbsp;DBMgr Configuration Options">DBMgr Configuration Options</a>.</p></li><li><p><span class="literal">loginApp</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_LoginApp_Configuration_Options" title="2.15.&nbsp;LoginApp Configuration Options">LoginApp Configuration Options</a>.</p></li><li><p><span class="literal">reviver</span> <span class="symbol">&#8208;</span> For details, see <a href="#xref_Reviver_Configuration_Options" title="2.16.&nbsp;Reviver Configuration Options">Reviver Configuration Options</a>.</p></li></ul></div><p>See also options <span class="literal">internalLatencyMax</span> and
        <span class="literal">internalLatencyMin</span>.</p></li><li><p><em class="emphasis"><span class="literal">loggerID</span>
        (String)</em></p><p>The ID used by the process when registering with MessageLoggers.
        If this ID does not match a MessageLogger's filter, the process will
        not log to that MessageLogger. (For details on MessageLogger, see
        <a href="#xref_MessageLogger" title="3.2.&nbsp;Message Logger">Message Logger</a>).</p><p>Multiple BigWorld servers can share the same logger process. If
        this behaviour is not desired, then you can use a unique loggerID per
        server instance <span class="symbol">&#8208;</span> this will
        cause MessageLogger to filter out all messages that do not match the
        loggerID it has been told to monitor.</p></li><li><p><em class="emphasis"><span class="literal">logSpamPatterns</span> (List
        of Strings)</em></p><p>A list of log message prefixes can be specified which will be
        suppressed on a per-second basis if the number sent to MessageLogger
        exceeds a certain threshold. Note that this is not intended a
        mechanism to sweep error messages "under the carpet"; it is designed
        to reduce the network load that can be generated by log traffic, which
        tests have indicated can be in excess of actual game traffic in some
        situations if suppression is disabled.</p><p>This option can be overridden by a tag with the same name in any
        app section. Note that the overriding does not merge the suppression
        lists, it simply replaces the global list with the one defined at the
        app level.</p><p>Additionally, the list of suppression patterns can be modified
        at runtime using the <code class="code">logger/addSpamSuppressionPattern</code> and
        <code class="code">logger/delSpamSuppressionPattern</code> watchers.</p><p>Please see
        <code class="filename">bigworld/res/server/production_defaults.xml</code> for
        an example of a suppression list.</p></li><li><p><em class="emphasis"><span class="literal">logSpamThreshold</span>
        (Integer)</em></p><p>The number of a particular log message that can be sent to
        MessageLogger in a single second before suppression will take place.
        Note that only messages matching one of the
        <code class="code">&lt;logSpamPatterns&gt;</code> (see above) will be
        suppressed.</p></li><li><p><em class="emphasis"><span class="literal">monitoringInterface</span>
        (String)</em></p><p>Network adapter interface to use for non-game communications,
        such as logging output, telnet sessions, and watcher requests. For
        example: <span class="literal">eth0</span>.</p><p>See the BaseApp's configuration option externalInterface for
        accepted formats.</p></li><li><p><em class="emphasis">networkCompression/external
        (String)</em></p><p>The type of compress to use on large some external messages sent
        over the network. The supported options are <span class="literal">NONE</span>
        and <span class="literal">ZIP</span>. For zip compression, a compression level
        can be set between 1 and 9 with 1 being the fastest and 9 being the
        best compression.</p><pre class="programlisting">&lt;networkCompression&gt;
  &lt;internal&gt; ZIP &lt;level&gt; 3 &lt;/level&gt; &lt;/internal&gt;
  &lt;external&gt; NONE &lt;/external&gt;
&lt;/networkCompression&gt;</pre><p>This setting can be overwritten entity type via
        <span class="literal">NetworkCompression/external</span> section of the entity
        type's <code class="filename">.def</code> file.</p></li><li><p><em class="emphasis">networkCompression/internal
        (String)</em></p><p>The type of compress to use on some large internal messages sent
        over the network.</p><p>This setting can be overwritten entity type via
        <span class="literal">NetworkCompression/internal</span> section of the entity
        type's <code class="filename">.def</code> file.</p><p>See <span class="literal">networkCompression/external</span> for more
        information.</p></li><li><p><em class="emphasis"><span class="literal">numStartupRetries</span>
        (Integer)</em></p><p>Number of times that CellApps and BaseApps will try to locate
        other components when starting up.</p><p>Each attempt is one second apart, so this value roughly
        indicates the number of seconds that these two components can be
        started before the other 'global' server components have
        started.</p></li><li><p><em class="emphasis"><span class="literal">outputFilterThreshold</span>
        (Integer)</em></p><p>Value used to filter the messages that are printed and sent to
        the logger.</p><p>All messages are tagged with an integer value. If the message
        number is greater than or equal to the filter value, then the message
        is allowed (the bigger the value, the more messages are filtered
        out).</p><p>For example, a threshold of 2 allows only INFO messages and
        higher (TRACE and DEBUG messages are filtered out).</p><p>The possible values and their message thresholds are described
        in the list below:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">0 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_TRACE</span></em></p></li><li><p><em class="emphasis">1 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_DEBUG</span></em></p></li><li><p><em class="emphasis">2 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_INFO</span></em></p></li><li><p><em class="emphasis">3 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_NOTICE</span></em></p></li><li><p><em class="emphasis">4 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_WARNING</span></em></p></li><li><p><em class="emphasis">5 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_ERROR</span></em></p></li><li><p><em class="emphasis">6 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_CRITICAL</span></em></p></li><li><p><em class="emphasis">7 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_HACK</span></em></p></li><li><p><em class="emphasis">8 <span class="symbol">&#8208;</span>
            <span class="literal">MESSAGE_PRIORITY_SCRIPT</span></em></p></li></ul></div></li><li><p><em class="emphasis"><span class="literal">personality</span>
        (String)</em></p><p>Name of the personality module for the server.</p><p>This module should contain things such as methods to be called
        back from the server (for example, when the server is ready). The
        personality module is usually named after your game.</p><p>If not specified, the module named <code class="code">BWPersonality</code> is
        used.</p></li><li><p><em class="emphasis"><span class="literal">production</span>
        (Boolean)</em></p><p>If set to <span class="literal">true</span>, enables the server processes
        to run in a production mode which makes a best attempt at emitting
        <span class="literal">ERROR</span> messages when encountering configuration
        settings that are considered detrimental for a production environment.
        In rare cases this may also prevent server processes from starting if
        the configuration options are seen to be completely unrealistic for a
        production environment.</p><p>Currently this is a global configuration option and cannot be
        set per server application type.</p></li><li><p><em class="emphasis"><span class="literal">shutDownServerOnBadState</span>
        (Boolean)</em></p><p>Flag indicating whether server should be shut down when in an
        unrecoverable state.</p><p>Currently, the following scenarios are handled:</p><div class="itemizedlist"><ul type="circle"><li><p>All CellApps are dead.</p></li><li><p>An attempt to restore Base entities after a BaseApp crash
            fails. This could happen if:</p><div class="itemizedlist"><ul type="square"><li><p>All BaseApps are dead.</p></li><li><p>Two BaseApps die in quick succession. This can cause the
                loss of base entities that were on the first BaseApp to crash
                and being backed up on the second BaseApp to crash.</p></li></ul></div></li></ul></div></li><li><p><em class="emphasis"><span class="literal">shutDownServerOnBaseAppDeath</span>
        (Boolean)</em></p><p>If set to true, the entire server will be shut down if a single
        BaseApp dies. Normally, the fault tolerance system would allow the
        server to continue running.</p></li><li><p><em class="emphasis"><span class="literal">shutDownServerOnCellAppDeath</span>
        (Boolean)</em></p><p>If set to true, the entire server will be shut down if a single
        CellApp dies. Normally, the fault tolerance system would allow the
        server to continue running.</p></li><li><p><em class="emphasis"><span class="literal">shouldUseChecksums</span>
        (Boolean)</em></p><p>If set to true, then all packets sent between server components
        will be checksummed to verify their correctness. This is in addition
        to the UDP checksum automatically provided by the Linux kernel and
        protects against packet corruption by buggy network drivers. If a
        corrupted packet is detected by Mercury (meaning that it has somehow
        passed the UDP checksum), you will see an error message like:</p><p><span class="literal">ERROR Packet::validateChecksum: Packet (flags 178, size
        1459) failed checksum (wanted 3dc56738, got 9fe7000a)</span></p><p>If after running servers for long enough and not seeing this
        error message you feel confident that the UDP checksum is reliable
        enough on your hardware, you can disable this option for a small
        performance improvement. The checksum is very simple and fast to
        calculate so this is likely to have only a small impact on
        performance.</p></li><li><p><em class="emphasis"><span class="literal">shuttingDownDelay</span>
        (Float)</em></p><p>Number of seconds that the server should wait before a requested
        controlled shutdown is actually performed.</p></li><li><p><em class="emphasis"><span class="literal">tickStatsPeriod</span>
        (Float)</em></p><p>Number of seconds between ticking statistics that keep a moving
        average. There can be a lot of statistics that need to be ticked. If
        too much time is spent maintaining these statistics, consider
        increasing this value. The time taken ticking statistics is measured
        by the tickStats profile. For example, see
        <code class="code">profiles/summaries/tickStats</code> watcher value.</p></li><li><p><em class="emphasis"><span class="literal">timeSyncPeriod</span>
        (Float)</em></p><p>Number of seconds between each synchronisation of game time
        between CellAppMgr and other applications.</p></li><li><p><em class="emphasis"><span class="literal">useDefaultSpace</span>
        (Boolean)</em></p><p>Flag indicating whether to automatically create an initial space
        when he server starts.</p><p>This option is ignored if spaces are loaded from the database
        during start-up.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e1179"></a>2.5.&nbsp;Billing System Configuration Options</h2></div></div></div><p>The configuration options specified in this section relate to user
    authentication and billing systems.</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">billingSystem/authenticateViaBaseEntity</span>
        (Boolean)</em></p><p>This option is used to indicate that user authentication and
        billing system integration will be done via base entity script.</p><p>If <span class="literal">true</span>, the usual user authentication done
        by DBMgr is bypassed and a base entity of type
        <span class="literal">entityTypeForUnknownUsers</span> is always created. The
        DBMgr attempts to load the entity with the username. If this does not
        exist, a new entity is created.</p><p>This new entity is not initially stored in the database. It is
        up to the base entity script to call <code class="code">Base.writeToDB()</code> if
        it wants the entity to persist.</p><p>See also option
        <span class="literal">entityTypeForUnknownUsers</span>.</p></li><li><p><em class="emphasis"><span class="literal">billingSystem/entityTypeForUnknownUsers</span>
        (String)</em></p><p>This specifies the type of the entity to create when
        <span class="literal">shouldAcceptUnknownUsers</span> or
        <span class="literal">authenticateViaBaseEntity</span> are used.</p><p>See also options <span class="literal">shouldAcceptUnknownUsers</span> and
        <span class="literal">shouldRememberUnknownUsers</span>.</p></li><li><p><em class="emphasis"><span class="literal">isPasswordHashed</span>
        (Boolean)</em></p><p>Flag indicating whether the password stored in the database's
        <span class="literal">bigworldLogOnMapping</span> table is hashed. Hashing is
        recommended for security reasons. With hashing, it is very difficult
        to determine the original password from the database. For more
        details, see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_bigworldLogOnMapping_Table" class="olink">Default Authentication via MySQL</a>.</p></li><li><p><em class="emphasis"><span class="literal">billingSystem/shouldAcceptUnknownUsers</span>
        (Boolean)</em></p><p>If <span class="literal">true</span>, a user can log in with an unknown
        login name and a new entity of type specified in
        <span class="literal">entityType</span>ForUnknownUsers will be created.</p><p>See also options <span class="literal">entityTypeForUnknownUsers</span>
        and <span class="literal">shouldRememberUnknownUsers</span>.</p></li><li><p><em class="emphasis"><span class="literal">billingSystem/shouldRememberUnknownUsers</span>
        (Boolean)</em></p><p>If <span class="literal">true</span>, the entity created for an unknown
        user will be stored in the database and an account record will be
        stored for this entity. This option is only used when
        <span class="literal">shouldAcceptUnknownUsers</span> is
        <span class="literal">true</span>.</p><p>See also option
        <span class="literal">shouldAcceptUnknownUsers</span>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Network_Configuration_Options"></a>2.6.&nbsp;Network Configuration Options</h2></div></div></div><p>The configuration options specified in this section relate to
    network communication and the behaviour of various aspects of
    communication channels.</p><p>The options specified in the following list are specifically related
    to the behaviour of channels when packets start overflowing. This can
    occur when the send window fills up and buffering of packets is required
    in order to handle packet resends.</p><p>The maximum packet options defines a per channel type threshold to
    assist in preventing channels from using indefinite amounts of memory
    while buffering overflow packets.</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">maxChannelOverflow/isAssert</span>
        (Boolean)</em></p><p>Specifies whether the offending channel should raise a program
        assertion, effectively terminating the process, when the maximum
        number of overflow packets has been reached. This only applies to
        internal channels and does not apply for channels to client
        applications.</p></li><li><p><em class="emphasis"><span class="literal">maxChannelOverflow/external</span>
        (Integer)</em></p><p>Number of packets to allow to overflow on an
        <em class="emphasis">external</em> channel before raising an
        <span class="literal">ERROR</span> message, or <span class="literal">ASSERT</span>'ing if
        <span class="literal">&lt;isAssert&gt;</span> has been set to
        <span class="literal">true</span>. A value of <span class="literal">0</span> disables any
        log messages and assertions from occurring.</p></li><li><p><em class="emphasis"><span class="literal">maxChannelOverflow/internal</span>
        (Integer)</em></p><p>Number of packets to allow to overflow on an
        <em class="emphasis">internal</em> channel before raising an
        <span class="literal">ERROR</span> message, or <span class="literal">ASSERT</span>'ing if
        <span class="literal">&lt;isAssert&gt;</span> has been set to
        <span class="literal">true</span>. A value of <span class="literal">0</span> disables any
        log messages and assertions from occurring.</p></li><li><p><em class="emphasis"><span class="literal">maxChannelOverflow/indexed</span>
        (Integer)</em></p><p>Number of packets to allow to overflow on an
        <em class="emphasis">indexed</em> channel before raising an
        <span class="literal">ERROR</span> message, or <span class="literal">ASSERT</span>'ing if
        <span class="literal">&lt;isAssert&gt;</span> has been set to
        <span class="literal">true</span>. A value of <span class="literal">0</span> disables any
        log messages and assertions from occurring.</p><p>An indexed channel is a channel that is used for communicating
        directly between the cell and base parts of an entity.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Network_Address_Translation_Configuration_Options"></a>2.7.&nbsp;Network Address Translation Configuration Options</h2></div></div></div><p>The configuration options specified in this section relate to
    running the server behind a NAT (Network Address Translator). This may be
    useful during development to allow a BigWorld server to run behind a
    NAT'ing firewall.</p><p>These configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the section <span class="literal">&lt;networkAddressTranslation&gt;</span>,
    and are described below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">externalAddress</span>
        (String)</em></p><p>Address to be returned to client if he is outside the server
        cluster LAN.</p><p>If the client is outside the server cluster LAN (the option
        localNetMask is used to determine that), then LoginApp will return the
        IP address set in this option, instead of the address that the BaseApp
        thinks it is on.</p><p>This option is intended for use only during development, when
        the machines that the BaseApps are running on do not have real IP
        addresses (<em class="emphasis">i.e.</em>, they are behind a NAT'ing
        firewall), but you still want clients to log in from the
        Internet.</p><p>See also option <span class="literal">localNetMask</span>.</p></li><li><p><em class="emphasis"><span class="literal">localNetMask</span>
        (String)</em></p><p>Mask to be used against the client's IP address in order to
        determine whether he is inside the server cluster LAN.</p><p>The net mask is an IP address followed by the number of bits to
        match. For example, <span class="literal">10.0.0.0/8</span> would match any IP
        starting with 10 (<em class="emphasis">i.e.</em>,
        <span class="literal">10.*.*.*</span>). The default is
        <span class="literal">0.0.0.0/0</span>, in which case no redirecting will be
        done.</p><p>If it is determined that the client is not on the server cluster
        LAN, the LoginApp will return the IP address set in option
        externalAddress.</p><p>See also option <span class="literal">externalAddress</span>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Load_Balancing_Configuration_Options"></a>2.8.&nbsp;Load Balancing Configuration Options</h2></div></div></div><p>The load balancing configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the section <span class="literal">&lt;balance&gt;</span>, and are described
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">maxCPUOffload</span>
        (Float)</em></p><p>Estimated amount of CPU processing that can be offloaded from a
        cell to another in one tick of load balancing.</p><p>A larger value should result in faster changes to the server's
        load balancing. This value is a fraction of 100% CPU usage, and its
        range is from 0.0 through 1.0, but is likely to always be less than
        0.1.</p></li><li><p><em class="emphasis"><span class="literal">minEntityOffload</span>
        (Integer)</em></p><p>Using the option maxCPUOffload, the load balancing algorithm may
        decide that less than one entity needs to be offloaded. Since this can
        get rounded down to zero, the load balancing can get restricted when
        small adjustments need to be made.</p><p>This option set a minimum value for this, so if it's set to 1
        (the default), then the load balancing will have the capacity to make
        small adjustments.</p></li><li><p><em class="emphasis"><span class="literal">minMovement</span>
        (Float)</em></p><p>Minimum number of metres that a partition line should move when
        load balancing.</p><p>A non-zero value can be useful to avoid the load balancing
        getting stuck.</p></li><li><p><em class="emphasis"><span class="literal">slowApproachFactor</span>
        (Float)</em></p><p>Aggressiveness of the load balancing when cells are close to
        being balanced.</p><p>The value range is from 0 through 1.</p><p>A smaller value will result in a slower approach to being
        balanced. Too high a value may result in some instability when the
        space is close to being balanced.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1509"></a>2.8.1.&nbsp;Entities Cardinality Configuration Options</h3></div></div></div><p>The configuration options for load balancing based on the number
      of entities are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;balance&gt;/&lt;demo&gt;</span>, and are
      described below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">enable</span>
          (Boolean)</em></p><p>Flag indicating whether the number of entities should be used
          to calculate load, rather than CPU load.</p><p>In normal situations, the server uses the CPU load on the
          CellApps to load balance. But sometimes it is desirable to use the
          number of entities per CellApp instead.</p><p>This may be useful, for example, when running multiple
          CellApps on a single machine for testing.</p><p>See also option
          <span class="literal">demo/numEntitiesPerCell</span>.</p></li><li><p><em class="emphasis"><span class="literal">numEntitiesPerCell</span>
          (Float)</em></p><p>If option <span class="literal">demo/enable</span> is
          <span class="literal">true</span>, then this option is used for calculating a
          CellApp's load.</p><p>The load is calculated as <span class="literal">numEntities /
          numEntitiesPerCell</span>.</p><p>See also option <span class="literal">demo/enable</span>.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_BaseApp_Configuration_Options"></a>2.9.&nbsp;BaseApp Configuration Options</h2></div></div></div><p>The BaseApp configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the section <span class="literal">&lt;baseApp&gt;</span>, and are described
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">archivePeriod</span>
        (Float)</em></p><p>Period length in seconds where each entity is written to the
        database for the purpose of disaster recovery. Each Entity is
        guaranteed to have an archive less than 2 x
        <span class="literal">archivePeriod</span> old. Setting it to zero switches off
        archiving.</p><p>A large value increases performance, but reduces the
        effectiveness of eventual disaster recovery. The opposite is true for
        a small value.</p><p>If secondary databases are disabled, this configuration option
        controls how often the entity is written to the primary database. In
        this case, this configuration option has a dramatic impact on the
        performance of the primary database when there are a large number of
        BaseApps. It is recommended to start with large values (a few
        minutes), and perform database testing and tuning before reducing
        it.</p><p>If secondary databases are enabled, this configuration option
        controls how often the entity is written to the secondary database. In
        this case, this configuration option can be set to a relatively small
        value (less than a minute) since it only impacts the BaseApp machine
        and the load is independent of number of BaseApps - unless the
        secondary database directory is on a shared network drive. For more
        details on secondary databases, see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Secondary_Databases" class="olink">Secondary Databases</a>.</p><p>This option is also available for CellAppMgr.</p></li><li><p><em class="emphasis"><span class="literal">backupPeriod</span>
        (Float)</em></p><p>Number of seconds between backups of each base entity to its
        backup BaseApp. This value is rounded to the nearest game tick.</p><p>As a first level of fault tolerance, base entities can be copied
        to a backup BaseApp (<em class="emphasis">i.e.</em>, backup to RAM), while
        cell entities are copied to their base entity. For more details on
        BaseApp and CellApp fault tolerance, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Fault_Tolerance" class="olink"><i>Fault Tolerance</i></a>.</p><p>The value for this option is very dependant on the game. A small
        value means frequent backups, and consequently less lost data in case
        a BaseApp fails. But backups cost bandwidth and CPU on the
        BaseApp.</p><p>In general this period can be much smaller than the one
        specified in option archivePeriod.</p><p>Setting this to 0 disables backups.</p><p>See also option <span class="literal">backupPeriod</span> on <a href="#xref_CellApp_Configuration_Options" title="2.12.&nbsp;CellApp Configuration Options">CellApp Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">backupTimeout</span>
        (Float)</em></p><p>Number of seconds for a BaseApp to respond to the watchdog
        messages from its backup BaseApp before it is considered dead and the
        backup BaseApp takes its place.</p></li><li><p><em class="emphasis"><span class="literal">backUpUndefinedProperties</span>
        (Boolean)</em></p><p>Flag indicating whether undefined properties should be backed
        up.</p><p>Properties of an entity are defined in the entity's definition
        file. However, it is possible to define additional properties for this
        entity in the base script of this entity. For example, an additional
        property can be defined by initialising it in the constructor of this
        entity class. These additional properties are referred to as undefined
        properties.</p><p>If this option is set to true, undefined properties will be
        backed up and an error will be emitted for each of the properties that
        cannot be pickled. If this option is set to false, undefined
        properties will not be backed up. Default value is true.</p></li><li><p><em class="emphasis"><span class="literal">clientOverflowLimit</span>
        (Integer)</em></p><p>If the send window for the channel to the client grows larger
        than this many packets, the client is disconnected.</p><p>Generally, it is better to rely on
        <span class="literal">inactivityTimeout</span> to detect an unresponsive client
        and so this option should be set to greater than
        <span class="literal">inactivityTimeout * gameUpdateHertz</span>.</p><p>See also option <span class="literal">inactivityTimeout</span> on <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a></p></li><li><p><em class="emphasis"><span class="literal">createBaseElsewhereThreshold</span>
        (Float)</em></p><p>Threshold of local BaseApp load below which calls to
        <span class="literal">BigWorld.createBaseAnywhere</span> cause the new base
        entity to be created locally.</p></li><li><p><em class="emphasis"><span class="literal">externalInterface</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">externalLatencyMax</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">externalLatencyMin</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">externalLossRatio</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">externalPorts/port</span>
        (Integer)</em></p><p>Port that may be used for the BaseApp's external socket <span class="symbol">&#8208;</span> the BaseApp can have more than one
        <span class="literal">externalPorts/port</span> definition.</p><p>This option is useful when BaseApp is running behind a firewall
        and NAT port mappings need to be set up.</p><p>If the BaseApps are run behind a firewall, then each BaseApp
        expected to run on a single machine should have an externalPort
        definition.</p><p>If this option is not specified, or all specified externalPorts
        are taken then the BaseApp will bind to any available port on the
        external interface.</p><pre class="programlisting">&lt;baseApp&gt;
  &lt;externalPorts&gt;
    &lt;port&gt; 40013 &lt;/port&gt;
    &lt;port&gt; 40014 &lt;/port&gt;
    &lt;port&gt; 40015 &lt;/port&gt;
  &lt;/externalPorts&gt;
&lt;/baseApp&gt;</pre></li><li><p><em class="emphasis"><span class="literal">inactivityTimeout</span>
        (Float)</em></p><p>Number of seconds that a proxy will proceed without
        communication from the client before it considers the connection to be
        dead.</p><p>See also option <span class="literal">clientOverflowLimit</span> on <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a></p></li><li><p><em class="emphasis"><span class="literal">internalInterface</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p><p><em class="emphasis">This tag is deprecated, and its use is not
        recommended. For details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>
        <span class="symbol">&#8594;</span> <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined" class="olink">BWMachined</a> <span class="symbol">&#8594;</span> <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined_Interface_Discovery" class="olink">BWMachined Interface Discovery</a>.</em></p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMax</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMin</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLossRatio</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">loadSmoothingBias</span>
        (Float)</em></p><p>Value to smooth the load changes on a component by when
        calculating new load.</p><p>The BigWorld server uses the load on a component to perform its
        load balancing. Unfiltered, the load can change too quickly to be
        useful. The option loadSmoothingBias is used to smooth out this
        value.</p><p>The filtered value is calculated at each game tick as
        follows:</p><p><span class="literal">newSmoothedLoad = (1 - loadSmoothingBias) *
        oldSmoothedLoad + loadSmoothingBias * load</span></p><p>This option is also available for CellApps and
        CellAppMgr.</p></li><li><p><em class="emphasis">
        <span class="literal">minClientInactivityResendDelay</span>
        (Float)</em></p><p>Minimum number of seconds that the BaseApp waits before
        resending unacknowledged packets to the client. BigWorld also uses
        other metrics like the round-trip-time to the client to adjust the
        resend timeout period. However, BigWorld will not set the resend
        timeout period to less than the value specified in this configuration
        option.</p><p>The BaseApp will resend packets to the client due various
        reasons like lost packets, network jitter or client delays in sending
        packet acknowledgements. Increasing the minimum resend delay will
        generally reduce the number of packet resends. However, increasing
        this value will also increase the impact of a lost packet on the end
        user experience. The client will only process packets in order.
        Therefore, a lost packet will cause the client to buffer subsequent
        packets from the server and wait for the lost packet to arrive. If the
        resend timeout is long, the user will notice a temporary halting of
        updates from the server.</p></li><li><p><em class="emphasis"><span class="literal">pythonPort</span>
        (Integer)</em></p><p>Port that the Python telnet session listener should listen
        on.</p><p>If set to zero, then a random port is chosen.</p><p>If the option is missing, then the port number will be set
        according to the formula:</p><p><span class="literal">40,000 + BaseApp ID</span></p><p>If the desired port is not available in any case, then a random
        one is used.</p><p>This option is also available for CellApps.</p></li><li><p><em class="emphasis"><span class="literal">reservedTickFraction</span>
        (Float)</em></p><p>Percentage of tick time that should be remaining on current tick
        so the next one is considered to be pending.</p><p>This value is expressed as fraction. For example, setting it to
        0.2 means that the next tick will be considered pending when there is
        still 20% of the current tick's time remaining.</p><p>Increasing this parameter will make the server more conservative
        in its CPU usage.</p><p>This affects how aggressive the method
        <span class="literal">BigWorld.fetchFromChunks</span> will be about yielding
        processing to the next tick.</p><p><em class="emphasis">Note</em>: This should rarely be
        changed from the default value.</p></li><li><p><em class="emphasis"><span class="literal">sendAuthToClient</span>
        (Boolean)</em></p><p>Flag indicating whether BaseApps must send authentication
        messages to clients (clients always send authentication to the
        server).</p><p>Use this feature to avoid hacking of clients, and prevent users
        from spoofing server messages to other clients.</p><p>Without this authentication, someone can send fake messages to
        clients, pretending to be the server (they will need the IP address of
        the client, and the port that the server is using, which can only be
        determined from the target client's data stream).</p><p>This option's value defaults to false, in order to save
        bandwidth.</p></li><li><p><em class="emphasis"><span class="literal">sendWindowCallbackThreshold</span>
        (Float)</em></p><p>The fraction of an entity channel's send window that needs to be
        used before the <span class="literal">onWindowOverflow</span> callback is called
        on the associated Base entity.</p></li><li><p><em class="emphasis"><span class="literal">shouldResolveMailBoxes</span>
        (Boolean)</em></p><p>Flag indicating whether a mailbox should be resolved to a Base
        entity, when possible. If a mailbox refers to a Base entity on the
        local BaseApp, the entity is used instead of the mailbox.</p><p>Although it is more efficient to have this option set, it is
        generally better to have it disabled. Having this enabled can lead to
        hard to find errors as behaviour changes depending on whether an
        entity happens to be local or not.</p></li><li><p><em class="emphasis"><span class="literal">verboseExternalInterface</span>
        (Boolean)</em></p><p>Flag indicating whether to generate verbose log output related
        to external network traffic.</p></li><li><p><em class="emphasis"><span class="literal">warnOnNoDef</span>
        (Boolean)</em></p><p>Flag indicating whether to generate a warning when Base entity
        properties are set that do not have a description in the entity's def
        file.</p></li><li><p><em class="emphasis"><span class="literal">watcherValues</span>
        (String)</em></p><p>This is not an actual configuration option, but instead a
        sub-section inside the section <span class="literal">&lt;baseApp&gt;</span>,
        used to set arbitrary watcher values for the BaseApp at initialisation
        time.</p><p>This might be useful when there is a watcher value with no
        corresponding entry on file
        <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>.</p><p>For example, to set value of
        <span class="literal">logger/cppThresholds/baseapp.cpp</span> to 2:</p><pre class="programlisting">&lt;baseApp&gt;
  &lt;watcherValues&gt;
    &lt;debug&gt;
      &lt;baseapp.cpp&gt; 2 &lt;/baseapp.cpp&gt;
      ...</pre><p>Do not use this feature if there is a parameter that can be set
        directly. Like all configuration options, this one is only evaluated
        once. It means that if there is an entry for watcherValues in
        <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/production_defaults.xml</code>,
        then all tags defined in it will be ignored if
        <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>
        also has an entry for <span class="literal">watcherValues</span> (even if
        different tags are specified in each one). This option is also
        available for CellApps.</p><div class="informalfigure"><div class="mediaobject"><img src="images/baseapp_configuration_option_watchervalues.png"><span class="caption"><p>File hierarchy</p></span></div></div></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_BaseApp_Secondary_Database_Configuration_Options"></a>2.9.1.&nbsp;Secondary Database Configuration Options</h3></div></div></div><p>The BaseApp secondary database configuration options are specified
      in file <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/
      bw.xml</span> under section
      <span class="literal">&lt;baseApp&gt;/&lt;secondaryDB&gt;</span>, and are
      described below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">enable</span>
          (Boolean)</em></p><p>Flag indicating whether to use secondary databases.</p><p>For more details about secondary databases, see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Secondary_Databases" class="olink">Secondary Databases</a>.</p></li><li><p><em class="emphasis"><span class="literal">maxCommitPeriod</span>
          (Float)</em></p><p>Maximum number of seconds between each commit. Higher values
          will result in better performance. Lower values will reduce the
          amount of data loss in case of a total system crash.</p><p>Explicit <code class="code">BigWorld.writeToDB</code> calls will always
          result in a commit. This option only affects the automatic archiving
          of entities.</p><p>If set to zero or this option is empty, the value defaults to
          5.</p></li><li><p><em class="emphasis"><span class="literal">directory</span>
          (String)</em></p><p>Directory where the secondary database files are stored.
          Secondary databases are SQLite files.</p><p>The secondary database files are cleaned up when the system
          shuts down. However, these files should not be treated as normal
          temporary files since they are crucial to the data recovery process
          in case of a complete system crash.</p><p>If the first character of the path is a <span class="literal">/</span>
          character, the path is treated as an absolute path. Otherwise, the
          path is treated as relative to the first
          <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em></span> path that
          contains the directory.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>It is not recommended to set the SQLite secondary database
        directory to reside on a network file-system. SQLite has specific
        requirements with regards to using file locking services from the
        file-system which may not be implemented properly for network
        file-systems.</p><p>It is recommended that each BaseApp machine has a dedicated
        space on a local file-system for storing secondary database
        files.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2042"></a>2.9.2.&nbsp;Packet Log Configuration Options</h3></div></div></div><p>The BaseApp packet logging configuration options are specified in
      file <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/
      bw.xml</span> under section
      <span class="literal">&lt;baseApp&gt;/&lt;packetLog&gt;</span>, and are described
      below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">addr</span>
          (String)</em></p><p>Client for which the packet's content should be logged.</p><p>The address is specified as dotted decimal format
          (<em class="emphasis">e.g.</em>, 10.40.1.1).</p><p>If this option is empty, then all packets will be
          logged.</p></li><li><p><em class="emphasis"><span class="literal">enable</span>
          (Boolean)</em></p><p>Flag indicating whether to write all packets to a local log
          file proxy.log.</p><p>This can be useful for debugging.</p></li><li><p><em class="emphasis"><span class="literal">flushMode</span>
          (Boolean)</em></p><p>Flag indicating whether the log file should be flushed after
          each write.</p><p>This option is useful to ensure all log writes are captured if
          the BaseApp is crashing.</p></li><li><p><em class="emphasis"><span class="literal">hexMode</span>
          (Boolean)</em></p><p>Flag indicating whether the logged packets' contents should be
          written in hexadecimal.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2099"></a>2.9.3.&nbsp;ID Configuration Options</h3></div></div></div><p>The BaseApp ID configuration options are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;baseApp&gt;/&lt;ids&gt;</span>, and are
      described below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">criticallyLowSize</span>
          (Integer)</em></p><p>Minimum number of IDs in the BaseApp's available ID pool
          before the other limits are automatically adjusted.</p><p>The adjustment aims to help avoid this from occurring
          again.</p></li><li><p><em class="emphasis"><span class="literal">desiredSize</span>
          (Integer)</em></p><p>Target number of IDs in the BaseApp's available ID pool when
          requesting IDs to the parent broker ID (in case it fell below
          <span class="literal">lowSize</span>), or returning IDs to it (in case it rose
          above highLevel) <span class="symbol">&#8208;</span> for
          CellApps and BaseApps, the parent ID broker is the CellAppMgr, while
          for CellAppMgr it is DBMgr.</p></li><li><p><em class="emphasis"><span class="literal">highSize</span>
          (Integer)</em></p><p>Maximum number of IDs in the BaseApp's available ID pool
          before IDs are returned to the parent ID broker <span class="symbol">&#8208;</span> for CellApps and BaseApps, the
          parent ID broker is the CellAppMgr, while for CellAppMgr it is
          DBMgr.</p><p>ID recycling is currently disabled, so this value is actually
          never used.</p></li><li><p><em class="emphasis"><span class="literal">lowSize</span>
          (Integer)</em></p><p>Minimum number of IDs that should be available in the
          BaseApp's available ID pool before a request is sent to the parent
          ID broker to restore it to the value specified in configuration
          option <span class="literal">desiredSize</span> <span class="symbol">&#8208;</span> for CellApps and BaseApps, the
          parent ID broker is the CellAppMgr, while for CellAppMgr it is
          DBMgr.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2164"></a>2.9.4.&nbsp;Client Upstream Limits</h3></div></div></div><p>The client upstream bandwidth can be limited so as to prevent
      denial-of-service attacks from malicious clients, or errant script code
      that cause messages from the client to be sent in high volume. This can
      lead to Mercury channels within the server to become heavily
      loaded.</p><p>To prevent this, limits can be specified on the count and size of
      incoming messages from clients to BaseApps. Once hard limits are reached
      on the count/size of incoming messages, messages are buffered and played
      back over time. Once the hard limits on buffering are reached, clients
      are disconnected.</p><p>The configuration parameters are specified in the file
      <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>
      in the <span class="literal">&lt;baseApp&gt;/&lt;clientUpstreamLimits&gt;</span>
      section. The available sub-elements are described in the following
      table.</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">warnMessagesPerSecond</span>
            (Integer)</em></p><p>This is a warning limit for the number of received messages
            from a client that are dispatched, measured in number of messages
            per second. When messages are received above this limit, a warning
            is emitted. No further warnings for this client of this type are
            emitted until the incoming message frequency drops below this
            limit.</p></li><li><p><em class="emphasis"><span class="literal">maxMessagesPerSecond</span>
            (Integer)</em></p><p>This is a hard limit for the number of received messages
            from a client that are dispatched, measured in number of messages
            per second. When messages are received above this limit, those and
            subsequent messages are buffered for later playback until the
            buffer is empty. The message queue for all clients are checked
            every tick to replay any eligible messages.</p></li><li><p><em class="emphasis"><span class="literal">warnBytesPerSecond</span>
            (Integer)</em></p><p>This is a warning limit for the throughput (in bytes) of
            received messages that are dispatched, measured in bytes per
            second. When this limit is exceeded, a warning is emitted. No
            further warnings for this client of this type are emitted until
            the incoming message data throughput drops below this
            limit.</p></li><li><p><em class="emphasis"><span class="literal">maxBytesPerSecond</span>
            (Integer)</em></p><p>This is a hard limit for the size of data (in bytes) in
            received messages that are dispatched per second. When messages
            are received above this limit, those and subsequent messages are
            buffered for later playback until the buffer is empty. The message
            queue for all clients are checked every tick to replay any
            eligible messages.</p></li><li><p><em class="emphasis"><span class="literal">warnMessagesBuffered</span>
            (Integer)</em></p><p>This is a warning limit for the number of received messages
            that may be buffered from the client. When this limit is exceeded,
            a warning is emitted. No further warnings for this client of this
            type are emitted until the number of queued messages drops below
            this threshold as a result of queue playback.</p></li><li><p><em class="emphasis"><span class="literal">maxMessagesBuffered</span>
            (Integer)</em></p><p>This is a maximum limit for the number of received messages
            that may be buffered from the client. When this limit is exceeded,
            the client is disconnected and any messages that are buffered are
            discarded and not dispatched.</p></li><li><p><em class="emphasis"><span class="literal">warnBytesBuffered</span>
            (Integer)</em></p><p>This is a warning limit for the total number of bytes that
            may be buffered for a client. When this limit is exceeded, a
            warning is emitted. No further warnings for this client of this
            type are emitted until the total size of buffered messages drops
            below this threshold as a result of queue playback.</p></li><li><p><em class="emphasis"><span class="literal">maxBytesBuffered</span>
            (Integer)</em></p><p>This is a maximum limit for the total number of bytes that
            may be buffered for a client. When this limit is exceeded, the
            client is disconnected and any messages that are buffered are
            discarded and not dispatched.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_BaseAppMgr_Configuration_Options"></a>2.10.&nbsp;BaseAppMgr Configuration Options</h2></div></div></div><p>The BaseAppMgr configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under section <span class="literal">baseAppMgr</span>, and are described
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">baseAppOverloadLevel</span>
        (Float)</em></p><p>Minimum load level that all BaseApps should reach for the system
        to be considered in overload, and thus reject new logins.</p><p>Similar overload levels are specified for for any CellApp (by
        option <span class="literal">&lt;cellAppOverloadLevel&gt;</span> <span class="symbol">&#8208;</span> for more details, see <a href="#xref_CellAppMgr_Configuration_Options" title="2.13.&nbsp;CellAppMgr Configuration Options">CellAppMgr Configuration Options</a>), and for DBMgr (by
        option <span class="literal">&lt;overloadLevel&gt;</span> <span class="symbol">&#8208;</span> for more details, see <a href="#xref_DBMgr_Configuration_Options" title="2.14.&nbsp;DBMgr Configuration Options">DBMgr Configuration Options</a>).</p></li><li><p><em class="emphasis"><span class="literal">baseAppTimeout</span>
        (Float)</em></p><p>Number of seconds for a BaseApp to respond before it is
        considered dead.</p></li><li><p><em class="emphasis"><span class="literal">createBaseRatio</span>
        (Float)</em></p><p>The number of BaseApps that a destination BaseApp will have
        pointing to it. For example, if <span class="literal">createBaseRatio</span> is
        4, the least loaded quarter of the machines will each have 4 BaseApps
        choosing them as the destination to create Base entities.</p><p>See also the option
        <span class="literal">updateCreateBaseInfoPeriod</span>.</p></li><li><p><em class="emphasis"><span class="literal">hardKillDeadBaseApps</span>
        (Boolean)</em></p><p>Determines if a non-responsive BaseApp will be terminated with a
        SIGQUIT signal.</p><p>Non-responsive BaseApps must be terminated in order for its
        backup to take over its IP address and ID. BaseApp non-responsiveness
        is determined by its backup, so a BaseApp running without a backup
        will never be reported as being non-responsive (see also configuration
        option baseApp/backupTimeout in <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>).</p><p>When this option is set to false, no signal is sent to the
        non-responsive BaseApp.</p><p>Only use this option for debugging, <em class="emphasis">e.g.</em>,
        to attach a debugger to the hung process.</p></li><li><p><em class="emphasis"><span class="literal">internalInterface</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p><p><em class="emphasis">This tag is deprecated, and its use is not
        recommended. For details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>
        <span class="symbol">&#8594;</span> <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined" class="olink">BWMachined</a> <span class="symbol">&#8594;</span> <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined_Interface_Discovery" class="olink">BWMachined Interface Discovery</a>.</em></p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMax</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMin</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLossRatio</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">overloadLogins</span>
        (Integer)</em></p><p>Maximum amount of logins that will be accepted during the
        overload tolerance period (see the
        <span class="literal">overloadTolerancePeriod</span> option) before rejecting
        any further logins.</p></li><li><p><em class="emphasis"><span class="literal">overloadTolerancePeriod</span>
        (Float)</em></p><p>Number of seconds that logins will be accepted during a
        situation where the BaseApps are overloaded (see the
        <span class="literal">baseAppOverloadLevel</span> option). After this period of
        time, any further logins will be rejected.</p></li><li><p><em class="emphasis"><span class="literal">updateCreateBaseInfoPeriod</span>
        (Float)</em></p><p>Time (in seconds) between updating all BaseApps with information
        to assist them in creating entities on other BaseApps when using
        <code class="classname">BigWorld</code><code class="methodname">.createBaseAnywhere()</code>.</p><p>See also the option <span class="literal">createBaseRatio</span>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Bots_Configuration_Options"></a>2.11.&nbsp;Bots Configuration Options</h2></div></div></div><p>The Bots configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the section <span class="literal">&lt;bots&gt;</span>, and are described
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">controllerData</span>
        (String)</em></p><p>Default data that the bot's controller will be created with
        (when bots are created, they get a controller associated with them to
        control their movement).</p><p>This may have different meanings for different controller types.
        For example, some controller types may interpret this as a filename to
        load data from.</p></li><li><p><em class="emphasis"><span class="literal">controllerType</span>
        (String)</em></p><p>Type of the controller to be created with bot.</p></li><li><p><em class="emphasis"><span class="literal">interface</span>
        (String)</em></p><p>Network adapter interface to use for game communication. For
        example: <span class="literal">eth0</span>. If not specified, the process will
        bind to all interfaces and report one of them. This should be
        appropriate in most situations.</p><p>See the BaseApp's configuration option externalInterface for
        accepted formats.</p></li><li><p><em class="emphasis"><span class="literal">password</span>
        (String)</em></p><p>Password that the bots should use when logging in to the
        server.</p></li><li><p><em class="emphasis"><span class="literal">port</span>
        (Integer)</em></p><p>Port on the server machine in which bots process will log to
        (only used if the option <span class="literal">&lt;serverName&gt;</span> is
        specified).</p><p>Ignored if bots automatically locates the LoginApp.</p></li><li><p><em class="emphasis"><span class="literal">pythonPort</span>
        (Integer)</em></p><p>Port that the Python telnet session listener should listen
        to.</p></li><li><p><em class="emphasis"><span class="literal">randomName</span>
        (Boolean)</em></p><p>Flag indicating whether a random suffix should be added to each
        bots name, in order to make them unique.</p><p>You should only set this option to false if you plan to use only
        a single bot. If you plan to use more than one bot, then you will need
        them to have different names <span class="symbol">&#8208;</span>
        otherwise only the first one will be able to log in.</p><p>See also option <span class="literal">username</span>.</p></li><li><p><em class="emphasis"><span class="literal">scripts</span>
        (Boolean)</em></p><p>Flag indicating whether the bots process should use Python
        scripting for received entities.</p><p>If set to <span class="literal">false</span>, then received entities are
        effectively ignored. Turning this option on has a significant
        performance penalty.</p></li><li><p><em class="emphasis"><span class="literal">serverName</span>
        (String)</em></p><p>Name of the server machine that the bots process should log in
        to (<em class="emphasis">i.e.</em>, the machine running LoginApp).</p><p>If this option is empty, then the bots process will attempt to
        find an appropriate LoginApp on the local network.</p></li><li><p><em class="emphasis"><span class="literal">shouldLog</span>
        (Boolean)</em></p><p>Flag indicating whether messages generated by the bots process
        should be sent to the central logger.</p></li><li><p><em class="emphasis"><span class="literal">standinEntity</span>
        (String)</em></p><p>Default entity script to be used when a specific Entity type
        does not have its corresponding game script.</p></li><li><p><em class="emphasis"><span class="literal">loginMD5Digest</span>
        (String)</em></p><p>MD5 digest string (in hex readable form) for server
        login.</p></li><li><p><em class="emphasis"><span class="literal">userName</span>
        (String)</em></p><p>Username that bots should use when logging in to the
        server.</p><p>When randomName is true, this is the prefix before the randomly
        generated part of the name.</p><p>See also option <span class="literal">randomName</span>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_CellApp_Configuration_Options"></a>2.12.&nbsp;CellApp Configuration Options</h2></div></div></div><p>The CellApp configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the section <span class="literal">&lt;cellApp&gt;</span>, and are described
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">aoiUpdateSchemes
        (Section)</em></p><p>This section contains a list of the different schemes that can
        be used when calculating the update rate of entities in an Area of
        Interest. The update rate of entities depends on their distance from
        the viewing client. The greater their update delta, the less frequent
        an entity's position is sent to the viewing client.</p><p>Each scheme contains the following values:</p><div class="itemizedlist"><ul type="circle"><li><p>name - The name of the scheme.</p></li><li><p>minDelta - The update delta when the distance to the entity
            is 0 metres.</p></li><li><p>maxDelta - The update delta when the distance to the entity
            is 500 metres.</p></li></ul></div><p>The delta value for distances between this is calculated by a
        linear interpolation between these two points.</p><p>Setting minDelta to 1 and maxDelta to 101 means the delta for a
        given distance would be:</p><pre class="programlisting">delta = 1 + 0.2 * distance</pre><p>This means that entities at 20 metres (with a delta of 5) would
        be updated roughly 4.2 times more frequently than entities at metres
        (with a delta of 21).</p><p>The scheme can be set for an entity with the
        <code class="property">Entity.aoiUpdateScheme</code> property or for an entity
        pair with the <code class="methodname">Entity.setAoIUpdateScheme()</code>
        method.</p><pre class="programlisting">&lt;cellApp&gt;
  ...
  &lt;aoiUpdateSchemes&gt;

    &lt;scheme&gt;
      &lt;name&gt; default &lt;/name&gt;
      &lt;minDelta&gt; 1 &lt;/minDelta&gt;
      &lt;maxDelta&gt; 101 &lt;/maxDelta&gt;
    &lt;/scheme&gt;

    &lt;!-- Update rate is not dependant on distance. This could be used on entities that are in sniper scope, for example. --&gt;
    &lt;scheme&gt;
      &lt;name&gt; sniper &lt;/name&gt;
      &lt;minDelta&gt; 10 &lt;/minDelta&gt;
      &lt;maxDelta&gt; 10 &lt;/maxDelta&gt;
    &lt;/scheme&gt;

    &lt;!-- Update twice as frequently as other entities at the same distance. Useful for large entities like dragons. --&gt;
    &lt;scheme&gt;
      &lt;name&gt; largeEntity &lt;/name&gt;
      &lt;minDelta&gt; 0.5 &lt;/minDelta&gt;
      &lt;maxDelta&gt; 50.5 &lt;/maxDelta&gt;
    &lt;/scheme&gt;

  &lt;/aoiUpdateSchemes&gt;
&lt;/cellApp&gt;
</pre></li><li><p><em class="emphasis"><span class="literal">backupPeriod</span>
        (Float)</em></p><p>Number of seconds between backups of each cell entity to its
        base entity. This value is rounded to the nearest game tick.</p><p>As a first level of fault tolerance, cell entities are copied to
        their base entities, while base entities can be copied to their backup
        BaseApps. For more details on BaseApp and CellApp fault tolerance, see
        the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Fault_Tolerance" class="olink"><i>Fault Tolerance</i></a>.</p><p>The value for this option is very dependant on the game. A small
        value means frequent backups, and consequently less lost data in case
        a CellApp fails. But backups cost bandwidth and CPU on the
        CellApp.</p><p>Setting this to 0 disables backups.</p><p>See also options <span class="literal">archivePeriod</span> and
        <span class="literal">backupPeriod</span> on <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">checkOffloadsPeriod</span>
        (Float)</em></p><p>Number of seconds between offload checks.</p><p>This is a periodic check if entities need to be offloaded, or
        new ghosts created.</p><p>Other options affected by this setting are:
        <span class="literal">ghostingMaxPerCheck</span> and
        <span class="literal">offloadMaxPerCheck</span>.</p></li><li><p><em class="emphasis"><span class="literal">chunkLoadingPeriod</span>
        (Float)</em></p><p>Number of seconds between checks on the progress of loading and
        unloading chunks.</p><p>Chunk loading occurs in a separate thread, but this check in the
        main thread queues up more chunks for the loading thread to load (or
        unload).</p></li><li><p><em class="emphasis"><span class="literal">defaultAoIRadius</span>
        (Float)</em></p><p>The default AoI radius of new cell entities for proxy entities
        when they are created. See also the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../..//api_python/cellapp/index.html#Client_Python_API" class="olink">Client Python API</a>'s entry <em class="emphasis">Main
        <span class="symbol">&#8594;</span> Cell <span class="symbol">&#8594;</span> BigWorld <span class="symbol">&#8594;</span> Classes <span class="symbol">&#8594;</span> Entity <span class="symbol">&#8594;</span>
        <span class="literal">setAoIRadius</span></em>.</p><p><em class="emphasis">Note</em>: If this is larger than
        the option <span class="literal">ghostDistance</span>, then the AoI radius of
        player entities is clamped to <span class="literal">ghostDistance</span> across
        cell boundaries.</p></li><li><p><em class="emphasis"><span class="literal">enforceGhostDecorators</span>
        (Boolean)</em></p><p>Specifies whether to enforce the requirement of adding a
        decorator to methods that can safely be called on ghost
        entities.</p><p>When enabled, methods that have not been labelled as safe and
        are called on an entity that could be a ghost will generate a Python
        exception. To be considered safe, the method must either be described
        in the <code class="filename">.def</code> file or be decorated with
        <code class="code">@bwdecorators.callableOnGhost</code>.</p><pre class="programlisting">import bwdecorators
class Table( BigWorld.Entity ):
	@bwdecorators.callableOnGhost
	def getArea( self ):
		return self.width * self.height</pre></li><li><p><em class="emphasis"><span class="literal">entitySpamSize</span>
        (Integer)</em></p><p>Number of bytes that an entity in a player's AoI can add to an
        update packet to that player before a warning message is
        displayed.</p><p>This can be useful to identify entities that are causing a lot
        of downstream network traffic.</p></li><li><p><em class="emphasis"><span class="literal">fastShutdown</span>
        (Boolean)</em></p><p>Specifies whether to avoid normal chunk unloading when the
        system is being shut down. This considerably speeds up the shutdown
        process.</p></li><li><p><em class="emphasis"><span class="literal">ghostDistance</span>
        (Float)</em></p><p>The distance in metres outside the active cell boundaries where
        entities will be ghosted.</p></li><li><p><em class="emphasis"><span class="literal">ghostingMaxPerCheck</span>
        (Integer)</em></p><p>Maximum number of ghost creation messages that can be sent per
        offload check.</p><p>The frequency of the offload check is determined by option
        <span class="literal">checkOffloadsPeriod</span>.</p></li><li><p><em class="emphasis"><span class="literal">ghostUpdateHertz</span>
        (Integer)</em></p><p>Number of times per second channels to neighbouring CellApps are
        flushed.</p><p>Channels are created between neighbouring CellApps. Messages
        (such as ghost data) sent over these channels are not sent
        immediately, but are instead flushed periodically. This is done to
        avoid the high overhead of sending a packet.</p><p>If the value of this option is decreased, then there will be
        more lag for cross-cell communications.</p><p><em class="emphasis">Note</em>: Bases always flush
        messages immediately.</p></li><li><p><em class="emphasis"><span class="literal">internalInterface</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p><p><em class="emphasis">This tag is deprecated, and its use is not
        recommended. For details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>,
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined" class="olink">BWMachined</a>,
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined_Interface_Discovery" class="olink">BWMachined Interface Discovery</a>.</em></p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMax</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMin</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLossRatio</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">loadDominantTextureMaps</span>
        (Boolean)</em></p><p>Specifies whether to load the terrain's dominant texture maps.
        By default, this flag is set to <span class="literal">false</span>.</p><p>Loading the dominant texture maps enables using features such as
        material kinds returned by <span class="literal">BigWorld.collide</span>.</p></li><li><p><em class="emphasis"><span class="literal">loadSmoothingBias</span>
        (Float)</em></p><p>Value to smooth the load changes on a component by when
        calculating new load.</p><p>The BigWorld server uses the load on a component to perform its
        load balancing. Unfiltered, the load can change too quickly to be
        useful. The option <span class="literal">loadSmoothingBias</span> is used to
        smooth out this value.</p><p>The filtered value is calculated at each game tick as
        follows:</p><div class="blockquote"><blockquote class="blockquote"><p>newSmoothedLoad = (1 - loadSmoothingBias) * oldSmoothedLoad +
          loadSmoothingBias * load</p></blockquote></div><p>This option is also available for CellAppMgr and
        BaseApps.</p></li><li><p><em class="emphasis"><span class="literal">maxControllersAbsolute</span>
        (Integer)</em></p><p>Number of controllers that an entity must have before an
        exception is raised on attempts to create a new controller on
        it.</p></li><li><p><em class="emphasis"><span class="literal">maxControllersExpected</span>
        (Integer)</em></p><p>Minimum number of controllers an entity must have before a
        warning is generated on attempts to create a new controller on
        it.</p></li><li><p><em class="emphasis"><span class="literal">maxGhostsToDelete</span>
        (Integer)</em></p><p>Maximum number of ghosts to be deleted from other cells on every
        offload check (the frequency of this check is set via
        checkOffloadsPeriod).</p><p>This option is useful for adding antihysteresis and for
        smoothing the load caused by ghost deletion.</p></li><li><p><em class="emphasis"><span class="literal">minGhostLifespan</span>
        (Float)</em></p><p>Minimum number of seconds for which a real entity will keep a
        ghost one.</p><p>This is useful for adding antihysteresis to the ghost creation
        and to the deletion process.</p></li><li><p><em class="emphasis"><span class="literal">maxPhysicsNetworkJitter</span>
        (Float)</em></p><p>Maximum number of seconds to allow for when network jitter when
        considering movement cheating.</p><p>The movement of a player may vary slightly due to variations in
        network latency. This value sets the level of tolerance for this
        jitter.</p></li><li><p><em class="emphasis"><span class="literal">navigatorUseGirthGrids</span>
        (Boolean)</em></p><p>Specifies if the waypoint search optimisation scheme should be
        used.</p><p>Girth grid is an optimisation scheme for waypoint search in a
        chunk. When this scheme is used, a chunk is divided up into a set of
        12x12 grids according to the girth provided (you can have a list of
        12x12 grid set for different girth sizes). Every grid square contains
        a subset of waypoints that overlap the covered area in a chunk.</p><p>During a (waypoint) search, only targeted grid squares
        (<em class="emphasis">i.e.</em>, subset of waypoints) are searched for the
        waypoint, instead of searching through the full set of waypoints. This
        scheme will generally improve the waypoint search performance.</p></li><li><p><em class="emphasis"><span class="literal">obstacleTreeDepth</span>
        (Integer)</em></p><p>Depth of the obstacle tree to create.</p><p>Higher numbers increase the speed of collision detection but use
        more memory.</p></li><li><p><em class="emphasis"><span class="literal">offloadHysteresis</span>
        (Float)</em></p><p>Number of metres that an entity has to be over a cell boundary
        before it is actually offloaded.</p><p>This helps avoid entities being offloaded back and forth between
        cells when standing very close to the border.</p></li><li><p><em class="emphasis"><span class="literal">offloadMaxPerCheck</span>
        (Integer)</em></p><p>Maximum number of entities that can be offloaded from a cell
        during an offload check.</p><p>The frequency of the offload check is determined by option
        checkOffloadsPeriod.</p></li><li><p><em class="emphasis"><span class="literal">pythonPort</span>
        (Integer)</em></p><p>Port that the Python telnet session listener should listen
        on.</p><p>If set to zero, then a random port is chosen.</p><p>If the option is missing, then the port number will be set
        according to the formula:</p><div class="blockquote"><blockquote class="blockquote"><p>50,000 + CellApp ID</p></blockquote></div><p>If the desired port is not available in any case, then a random
        one is used.</p><p>This option is also available for CellApps.</p></li><li><p><em class="emphasis"><span class="literal">reservedTickFraction</span>
        (Float)</em></p><p>Percentage of tick time that should be remaining on current tick
        so the next one is considered to be pending.</p><p>This value is expressed as fraction. For example, setting it to
        0.2 means that the next tick will be considered pending when there is
        still 20% of the current tick's time remaining.</p><p>Increasing this parameter will make the server more conservative
        in its CPU usage.</p><p>This affects how aggressive the method
        <span class="literal">BigWorld.fetchFromChunks</span> will be about yielding
        processing to the next tick.</p><p><em class="emphasis">Note</em>: This should rarely be
        changed from the default value.</p></li><li><p><em class="emphasis"><span class="literal">sendWindowCallbackThreshold</span>
        (Float)</em></p><p>The fraction of an entity channel's send window that needs to be
        used before the <span class="literal">onWindowOverflow</span> callback is called
        on the associated entity.</p></li><li><p><em class="emphasis"><span class="literal">shouldResolveMailBoxes</span>
        (Boolean)</em></p><p>Flag indicating whether a mailbox should be resolved to a Cell
        entity, when possible. If a mailbox refers to a Cell entity on the
        local CellApp, the entity is used instead of the mailbox.</p><p>Although it is more efficient to have this option set, it is
        generally better to have it disabled. Having this enabled can lead to
        hard to find errors as behaviour changes depending on whether an
        entity happens to be local or not.</p></li><li><p><em class="emphasis"><span class="literal">treatAllOtherEntitiesAsGhosts</span>
        (Boolean)</em></p><p>Puts the CellApp in a debugging mode in which a script running
        on it will see only its own entity as real <span class="symbol">&#8208;</span> all other entities will be treated as
        ghosts.</p><p>Method calls, property access, and other functions will operate
        as if the other entities really are ghosts. This mean that:</p><div class="itemizedlist"><ul type="circle"><li><p>Method calls will go via the network.</p></li><li><p>Property access will be read-only, and limited to
            <span class="literal">CELL_PUBLIC</span> (or more public)
            properties<sup>[<a name="d0e3057" href="#ftn.d0e3057">1</a>]</sup>.</p></li><li><p>Many internal functions will not work,
            <em class="emphasis">e.g.</em>, adding a new Controller.</p></li></ul></div><p>This is very useful for testing how your scripts work when
        dealing with ghost entities, especially if two interacting entities
        are nearby and would consequently rarely be ghosts.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">watcherValues</span>
        (String)</em></p><p>This is not an actual configuration option, but instead a
        sub-section inside the section <span class="literal">cellApp</span>, used to set
        arbitrary watcher values for the CellApp at initialisation
        time.</p><p>This might be useful when there is a watcher value with no
        corresponding entry on
        <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>.</p><p>For example, to set the watcher value
        <span class="literal">logger/cppThresholds/cellapp.cpp</span> to 2:</p><pre class="programlisting">&lt;cellApp&gt;
  &lt;watcherValues&gt;
    &lt;debug&gt;
      &lt;cellapp.cpp&gt; 2 &lt;/cellapp.cpp&gt;
      ...</pre><p>Do not use this feature if there is a parameter that can be set
        directly.</p><p>Like all configuration options, this one is only evaluated once.
        It means that if there is an entry for watcherValues in
        <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/production_defaults.xml</code>,
        then all tags defined in it will be ignored if
        <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
        also has an entry for <span class="literal">watcherValues</span> (even if
        different tags are specified in each one). This option is also
        available for BaseApps.</p><div class="informalfigure"><div class="mediaobject"><img src="images/cellapp_configuration_option_watchervalues.png"><span class="caption"><p>File hierarchy</p></span></div></div></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3128"></a>2.12.1.&nbsp;Noise Configuration Options</h3></div></div></div><p>The CellApp noise configuration options are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;cellApp&gt;/&lt;noise&gt;</span>, and are
      described below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">horizontalSpeed</span>
          (Float)</em></p><p>If an entity's horizontal speed exceeds this value (in metres
          per second), the entity makes a noise.</p><p>See <span class="literal">Entity.makeNoise</span> script method for more
          information. The event and info are 0 for noises generated this
          way.</p></li><li><p><em class="emphasis"><span class="literal">standardRange</span>
          (Float)</em></p><p>Distance in metres through which a noise is propagated.</p><p>This value is multiplied by the level of a noise. For details,
          see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../..//api_python/cellapp/index.html#Client_Python_API" class="olink">Client Python API</a>'s entry <em class="emphasis">Main <span class="symbol">&#8594;</span> Cell <span class="symbol">&#8594;</span> BigWorld <span class="symbol">&#8594;</span> Classes <span class="symbol">&#8594;</span> Entity <span class="symbol">&#8594;</span>
          <span class="literal">makeNoise</span></em>.</p></li><li><p><em class="emphasis"><span class="literal">verticalSpeed</span>
          (Float)</em></p><p>If an entity's falling speed exceeds this value (in metres per
          second), the entity makes a noise.</p><p>This is done via script method
          <span class="literal">Entity.makeNoise</span> <span class="symbol">&#8208;</span> for noises generated this way, the
          parameter event and info are set to 0. For details, see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../..//api_python/cellapp/index.html#Client_Python_API" class="olink">Client Python API</a>'s entry <em class="emphasis">Main
          <span class="symbol">&#8594;</span> Cell <span class="symbol">&#8594;</span> BigWorld <span class="symbol">&#8594;</span> Classes <span class="symbol">&#8594;</span> Entity <span class="symbol">&#8594;</span>
          <span class="literal">makeNoise</span></em>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3225"></a>2.12.2.&nbsp;ID Configuration Options</h3></div></div></div><p>The CellApp ID configuration options are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;cellApp&gt;/&lt;ids&gt;</span>, and are
      described below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">criticallyLowSize</span>
          (Integer)</em></p><p>Minimum number of IDs in the CellApp's available ID pool
          before the other limits are automatically adjusted.</p><p>The adjustment aims to help avoid this from occurring
          again.</p></li><li><p><em class="emphasis"><span class="literal">desiredSize</span>
          (Integer)</em></p><p>Target number of IDs in the CellApp's available ID pool when
          requesting IDs to the parent broker ID (in case it fell below
          <span class="literal">lowSize</span>), or returning IDs to it (in case it rose
          above <span class="literal">highSize</span>) <span class="symbol">&#8208;</span> for CellApps and BaseApps, the
          parent ID broker is the CellAppMgr, and for CellAppMgr it is
          DBMgr.</p></li><li><p><em class="emphasis"><span class="literal">highSize</span>
          (Integer)</em></p><p>Maximum number of IDs in the CellApp's available ID pool
          before IDs are returned to the parent ID broker <span class="symbol">&#8208;</span> for CellApps and BaseApps, the
          parent ID broker is the CellAppMgr, and for CellAppMgr it is
          DBMgr.</p><p>ID recycling is currently disabled, so this value is actually
          never used.</p></li><li><p><em class="emphasis"><span class="literal">lowSize</span>
          (Integer)</em></p><p>Minimum number of IDs that should be available in the
          CellApp's available ID pool before a request is sent to the parent
          ID broker to restore it to the value specified in configuration
          option desiredSize <span class="symbol">&#8208;</span> for
          CellApps and BaseApps, the parent ID broker is the CellAppMgr, and
          for CellAppMgr it is DBMgr.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3290"></a>2.12.3.&nbsp;CellApp Profiles Configuration Options</h3></div></div></div><p>The CellApp profiles configuration options are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;cellApp&gt;/&lt;profiles&gt;</span>. It
      contains sub-sections for enabling profiling of specific CellApp
      functionality. All the profiling options specified below can be modified
      after server startup on a per CellApp basis by using Watchers. The
      values are exposed in the CellApp watcher tree under
      <span class="literal">profilesConfigs/&lt;option&gt;</span>.</p><p>The list below details the available profiling sub-sections and
      options:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">initGhost</span></em></p><p>The <em class="emphasis"><span class="literal">initGhost</span></em> sub-options
          define profiling information relating to the initialisation of ghost
          entities. Specifically the maximum time taken and network stream
          size required to initialise ghost entities from their reals after
          which a <span class="literal">WARNING</span> message will be generated. The
          initialisation primarily consists of the streaming of ghosted entity
          properties.</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis"><span class="literal">sizeWarningLevel</span>
              (Integer)</em></p><p>The size (in bytes) that an
              <code class="methodname">initGhost</code>() method receives before a
              <span class="literal">WARNING</span> message is displayed.</p></li><li><p><em class="emphasis"><span class="literal">timeWarningLevel</span>
              (Float)</em></p><p>The amount of time (in seconds) that an
              <code class="methodname">initGhost</code>() method can take before a
              <span class="literal">WARNING</span> message is displayed. An example of
              the type of message generated is as follows.</p><pre class="programlisting">WARNING    Profile initGhost/timeWarningLevel exceeded (Creature 23 of size 12338 bytes took 0.00477 seconds)</pre></li></ul></div></li><li><p><em class="emphasis"><span class="literal">initReal</span></em></p><p>Similar to the <em class="emphasis"><span class="literal">initGhost</span></em> option, the
          <em class="emphasis"><span class="literal">initReal</span></em>
          sub-options define profiling information relating to the
          initialisation of real entities. Specifically the maximum time taken
          and network stream size required to initialise real entities from
          their reals after which a <span class="literal">WARNING</span> message will be
          generated. The initialisation primarily consists of the streaming of
          entity properties.</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis"><span class="literal">sizeWarningLevel</span>
              (Integer)</em></p><p>The size (in bytes) that an
              <code class="methodname">initReal</code>() method receives before a
              <span class="literal">WARNING</span> message is displayed. An example of
              the type of message generated is as follows.</p><pre class="programlisting">WARNING    Profile initReal/sizeWarningLevel exceeded (Creature 13 of size 68765 bytes took 0.3726 seconds)</pre></li><li><p><em class="emphasis"><span class="literal">timeWarningLevel</span>
              (Float)</em></p><p>The amount of time (in seconds) that an
              <code class="methodname">initReal</code>() method can take before a
              <span class="literal">WARNING</span> message is displayed.</p></li></ul></div></li><li><p><em class="emphasis"><span class="literal">onLoad</span></em></p><p>The <code class="methodname">onLoad</code>() operation is invoked
          when creating a real entity that had been offloaded from another
          CellApp.</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis"><span class="literal">sizeWarningLevel</span>
              (Integer)</em></p><p>The size (in bytes) that an
              <code class="methodname">onLoad</code>() method receives before a
              <span class="literal">WARNING</span> message is displayed. An example of
              the type of message generated is as follows. The size is
              considered as the total size of the real entity and which is
              comprised of non-ghosted (i.e. CELL_PRIVATE) properties and
              other state information such as entities in the AoI, controller
              state etc.</p></li><li><p><em class="emphasis"><span class="literal">timeWarningLevel</span>
              (Float)</em></p><p>The amount of time (in seconds) that an
              <code class="methodname">onLoad</code>() method can take before a
              <span class="literal">WARNING</span> message is displayed.</p></li></ul></div></li><li><p><em class="emphasis"><span class="literal">backup/sizeWarningLevel</span>
          (Integer)</em></p><p><em class="emphasis"><span class="literal">backup</span></em> is
          the operation of performing a fixed point in time copy of the cell
          entity to the database (via the base). The size (in bytes) is the
          maximum persistent size of the entity (<em class="emphasis">i.e.</em>
          only persistent properties) after which a <span class="literal">WARNING</span>
          message is displayed.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_CellAppMgr_Configuration_Options"></a>2.13.&nbsp;CellAppMgr Configuration Options</h2></div></div></div><p>The CellAppMgr configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the section <span class="literal">&lt;CellAppMgr&gt;</span>, and are described
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">archivePeriod</span>
        (Float)</em></p><p>Number of seconds between database writes of space configuration
        and space data, for the purpose of disaster recovery.</p><p>Setting it to zero switches off database writes.</p><p>A large value increases performance, but reduces the
        effectiveness of eventual disaster recovery. The opposite is true for
        a small value.</p><p>Please note that unlike the BaseApp configuration option of the
        same name, this configuration option is not affected by the use of
        secondary databases. The data is always written to the primary
        database. It is recommended to start with large values (a few
        minutes), and perform database testing and tuning before reducing
        it.</p><p>This option is also available for BaseApps.</p></li><li><p><em class="emphasis"><span class="literal">cellAppLoad/lowerBound</span>
        (Float)</em></p><p>Minimum average load that a CellApp must achieve before being
        retired.</p><p>This value is a fraction, and its range is 0.0 through
        1.0.</p><p>Together with <span class="literal">cellAppLoadUpperBound</span>, this
        option should be tuned as to conserve CPU, while still allowing for
        temporary overloads (which depend on game code characteristics, such
        as AI usage).</p><p>This value must be less than the
        <span class="literal">cellAppLoadUpperBound</span>.</p><p>See also option <span class="literal">cellAppLoadUpperBound</span>.</p></li><li><p><em class="emphasis"><span class="literal">cellAppLoad/safetyBound</span>
        (Float)</em></p><p>Limit that the load balancing can increase a cell's load
        to.</p><p>This value has to be greater than cellAppLoadUpperBound.</p><p>In some situations, such as adding a new cell, some cells may
        have their load temporarily increased.</p></li><li><p><em class="emphasis"><span class="literal">cellAppLoad/safetyRatio</span>
        (Float)</em></p><p>Cell's average load safety ratio.</p><p>When the average load of the cells in a space is high, the limit
        that the load balancing can safely increase a cell's load to is
        calculated by multiplying this value by the average load. The real
        boundary is calculated as:</p><div class="blockquote"><blockquote class="blockquote"><p>max( cellAppLoadSafetyBound, avgCellAppLoad *
          cellAppLoadSafetyRatio )</p></blockquote></div></li><li><p><em class="emphasis"><span class="literal">cellAppLoad/upperBound</span>
        (Float)</em></p><p>Minimum average load that a CellApp must achieve before a new
        cell is considered to be required.</p><p>This value is a fraction, and its range is 0.0 through
        1.0.</p><p>Too low an upper bound will waste CPU, but too high an upper
        bound could potentially allow a CPU spike to kill a CellApp.</p><p>This value must be greater than the
        <span class="literal">cellAppLoadLowerBound</span>.</p><p>See also option <span class="literal">cellAppLoadLowerBound</span>.</p></li><li><p><em class="emphasis"><span class="literal">cellAppLoad/warningLevel</span>
        (Float)</em></p><p>Minimum value that average load of CellApps must achieve (when
        there are no other CellApps available to share the load) before
        warning messages are sent to the log.</p></li><li><p><em class="emphasis"><span class="literal">cellAppLoad/overloadLevel</span>
        (Float)</em></p><p>Minimum load level that any CellApp should reach for the system
        to be considered in overload, and thus reject new logins.</p><p>Similar overload levels are specified for all BaseApps (by
        option <span class="literal">&lt;baseAppOverloadLevel&gt;</span> <span class="symbol">&#8208;</span> for details, see <a href="#xref_BaseAppMgr_Configuration_Options" title="2.10.&nbsp;BaseAppMgr Configuration Options">BaseAppMgr Configuration Options</a>), and for DBMgr (by
        option <span class="literal">&lt;overloadLevel&gt;</span> <span class="symbol">&#8208;</span> for details, see <a href="#xref_DBMgr_Configuration_Options" title="2.14.&nbsp;DBMgr Configuration Options">DBMgr Configuration Options</a>).</p></li><li><p><em class="emphasis"><span class="literal">cellAppTimeout</span>
        (Float)</em></p><p>Number of seconds for a CellApp to respond before it is
        considered dead.</p></li><li><p><em class="emphasis"><span class="literal">hardKillDeadCellApps</span>
        (Boolean)</em></p><p>Determines if a non-responsive CellApp will be terminated with a
        SIGQUIT signal.</p><p>CellApp non-responsiveness is determined by cellAppTimeout
        option.</p><p>It is important to terminate the non-responsive CellApp, in
        order to prevent duplicate entities, since some of the entities on the
        non-responsive CellApp will be recreated on neighbouring
        CellApps<sup>[<a name="d0e3615" href="#ftn.d0e3615">2</a>]</sup>.</p><p>When this option is set to false, no signal will be sent to the
        non-responsive CellApp. This option should only be used for debugging
        purposes, <em class="emphasis">e.g.</em>, to attach a debugger to the hung
        process.</p></li><li><p><em class="emphasis"><span class="literal">internalInterface</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p><p><em class="emphasis">This tag is deprecated, and its use is not
        recommended. For details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>,
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined" class="olink">BWMachined</a>,
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined_Interface_Discovery" class="olink">BWMachined Interface Discovery</a>.</em></p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMax</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMin</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLossRatio</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">loadBalancePeriod</span>
        (Float)</em></p><p>Number of seconds between adjustments of the cell boundaries to
        improve the load balance on CellApps.</p></li><li><p><em class="emphasis"><span class="literal">loadSmoothingBias</span>
        (Float)</em></p><p>Value to smooth the load changes on a component by when
        calculating new load.</p><p>The BigWorld server uses the load on a component to perform its
        load balancing. Unfiltered, the load can change too quickly to be
        useful. The option <span class="literal">loadSmoothingBias</span> is used to
        smooth out this value.</p><p>The filtered value is calculated at each game tick as
        follows:</p><div class="blockquote"><blockquote class="blockquote"><p>newSmoothedLoad = (1 - loadSmoothingBias) * oldSmoothedLoad +
          loadSmoothingBias * load</p></blockquote></div><p>The CellAppMgr further smooths the CellApp loads when it is
        informed of them.</p><p>This option is also available for BaseApps and CellApps.</p></li><li><p><em class="emphasis"><span class="literal">maxLoadingCells</span>
        (Integer)</em></p><p>Maximum number of cells that the meta-load balancing will try to
        add to a space to help it initially load its geometry.</p><p>To disable this feature, set this value to 0.</p><p>See also <span class="literal">minLoadingArea</span>.</p></li><li><p><em class="emphasis"><span class="literal">metaLoadBalanceScheme</span>
        (Integer)</em></p><p>The type of scheme that should be used to determine which Spaces
        should be a priority to meta load balanced. Current valid values
        are:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">0</em> - Largest Space
            First</p><p>The largest space contained in the most loaded group of
            connected CellApps will be chosen as the candidate for adding a
            new Cell into.</p></li><li><p><em class="emphasis">1</em> - Smallest Space
            First</p><p>The smallest space contained in the most loaded group of
            connected CellApps will be chosen as the candidate for adding a
            new Cell into. This will enable the space to migrate off onto
            another CellApp thus reducing the overall load of the heavily
            loaded group.</p></li></ul></div></li><li><p><em class="emphasis"><span class="literal">metaLoadBalancePeriod</span>
        (Float)</em></p><p>Number of seconds between checking whether any cells should be
        added to or removed from any spaces to improve the load balance on
        CellApps.</p></li><li><p><em class="emphasis"><span class="literal">minLoadingArea</span>
        (Integer)</em></p><p>Minimum average area (in square metres) that the cells in a
        space must have for it to be added by the meta-load balancing when
        attempting to initially load the geometry of a space.</p><p>If the average area is less than this value, then no more cells
        will be added to the meta-load balancing <span class="symbol">&#8208;</span> this is meant to prevent too many
        cells being allocated to small spaces.</p><p>The number of cells that will be used for loading a space can be
        thought of as:</p><div class="blockquote"><blockquote class="blockquote"><div class="equation"><a name="d0e3765"></a><p class="title"><b>Equation&nbsp;2..&nbsp;</b></p><div class="equation-contents"><span class="mathphrase">min( maxLoadingCells, spaceGeometrySize /
            minLoadingArea )</span></div></div><br class="equation-break"></blockquote></div><p>See also <span class="literal">maxLoadingCells</span>.</p></li><li><p><em class="emphasis"><span class="literal">overloadTolerancePeriod</span>
        (Float)</em></p><p>Number of seconds that logins will be accepted during a
        situation where the CellApps are overloaded (see the
        <span class="literal">cellAppOverloadLevel</span> option). After this period of
        time, any further logins will be rejected.</p></li><li><p><em class="emphasis"><span class="literal">shouldLimitBalanceToChunks</span>
        (Boolean)</em></p><p>Determines if the loaded chunks of cells should be considered
        when load balancing.</p><p>This is enabled by default, so that load balancing will not
        cause a cell to cover an area that has not yet been loaded.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_DBMgr_Configuration_Options"></a>2.14.&nbsp;DBMgr Configuration Options</h2></div></div></div><p>The DBMgr configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the section <span class="literal">&lt;dbMgr&gt;</span>, and are described
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">allowEmptyDigest</span>
        (Boolean)</em></p><p>Flag indicating whether DBMgr should allow clients to log in
        with an empty MD5 digest.</p><p>When a client logs in, an MD5 digest of the entity definitions
        is sent to the server. This is to ensure that the client is using
        resources consistent with the server's.</p><p>This should be true if you are using either an example client,
        as found in <code class="filename">bigworld/src/examples</code>, or bots to log in,
        since those programs do not read the entity definition files (named
        <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/entity_defs/<em class="replaceable"><code>&lt;entity&gt;</code></em>.def</span>).</p></li><li><p><em class="emphasis"><span class="literal">databaseName</span>
        (String)</em></p><p><em class="emphasis">Only valid when the MySQL database layer is
        used.</em></p><p>Name of the underlying database to use.</p></li><li><p><em class="emphasis"><span class="literal">dumpEntityDescription</span>
        (Integer)</em></p><p>Level of logging information generated when loading entity
        definition files (named
        <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/entity_defs/<em class="replaceable"><code>&lt;entity&gt;</code></em>.def</span>).</p><p>The possible values are described in the list below:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">0</em> <span class="symbol">&#8208;</span> No log is generated.</p></li><li><p><em class="emphasis">1</em> <span class="symbol">&#8208;</span> Brief details about the entity are
            generated.</p></li><li><p><em class="emphasis">2</em> <span class="symbol">&#8208;</span> Full listing of entity is
            generated.</p></li></ul></div></li><li><p><em class="emphasis"><span class="literal">host</span>
        (String)</em></p><p><em class="emphasis">Only valid when the MySQL database layer is
        used.</em></p><p>Machine where the database is running.</p><p>The localhost identified can be used to refer to the current
        machine.</p></li><li><p><em class="emphasis"><span class="literal">internalInterface</span>
        (String)</em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p><p><em class="emphasis">This tag is deprecated, and its use is not
        recommended. For details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>,
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined" class="olink">BWMachined</a>,
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined_Interface_Discovery" class="olink">BWMachined Interface Discovery</a>.</em></p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMax</span>
        (Float)</em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMin</span>
        (Float)</em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLossRatio</span>
        (Float)</em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">numConnections</span>
        (Integer)</em></p><p><em class="emphasis">Only valid when the MySQL database layer is
        used.</em></p><p>Number of connections to make to the underlying database.</p><p>This must be greater than or equal to 1. The default is
        5.</p></li><li><p><em class="emphasis"><span class="literal">overloadLevel</span>
        (Float)</em></p><p>Minimum load level that DBMgr should reach for the system to be
        considered in overload, and thus reject new logins.</p><p>Similar overload levels are specified for all BaseApp's (using
        <span class="literal">baseAppOverloadLevel</span> <span class="symbol">&#8208;</span> for details, see <a href="#xref_BaseAppMgr_Configuration_Options" title="2.10.&nbsp;BaseAppMgr Configuration Options">BaseAppMgr Configuration Options</a>), and for any
        CellApp (using <span class="literal">cellAppOverloadLevel</span> <span class="symbol">&#8208;</span> for details, see <a href="#xref_CellAppMgr_Configuration_Options" title="2.13.&nbsp;CellAppMgr Configuration Options">CellAppMgr Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">overloadTolerancePeriod</span>
        (Float)</em></p><p>Number of seconds that logins will be accepted during a
        situation where the CellApps are overloaded (see the
        <span class="literal">overloadLevel</span> option). After this period of time,
        any further logins will be rejected.</p></li><li><p><em class="emphasis"><span class="literal">password</span>
        (String)</em></p><p><em class="emphasis">Only valid when the MySQL database layer is
        used.</em></p><p>Password to be used when the DBMgr connects to the underlying
        database.</p></li><li><p><em class="emphasis"><span class="literal">port</span>
        (String)</em></p><p><em class="emphasis">Only valid when the MySQL database layer is
        used.</em></p><p>Port to be used when the DBMgr connects to the underlying
        database. Set it to 0 to use the MySQL default port.</p></li><li><p><em class="emphasis"><span class="literal">syncTablesToDefs</span>
        (Boolean)</em></p><p>Flag indicating whether changes to entity definition should be
        replicated to the MYSQL database.</p><p>The possible values are described below:</p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis"><span class="literal">false</span></em></p><p>No changes will be made to MySQL database structure.</p></li><li><p><em class="emphasis"><span class="literal">true</span></em></p><p>Make all necessary changes to the database structure to
            match the entity definitions. This includes deleting redundant
            columns and tables.</p></li></ul></div><p>DBMgr will fail to start if the database structure does not
        exactly match the entity definitions.</p><p>This option is convenient during development as entity
        definitions change frequently. During production it is recommended to
        set this option to a safe mode (<em class="emphasis">i.e.</em>, false),
        then manually update the MySQL database structure by running the
        <span class="literal">sync_db</span> tool.</p></li><li><p><em class="emphasis"><span class="literal">type</span>
        (String)</em></p><p>Type of database to use. Current options are:
        <span class="literal">xml</span> and <span class="literal">mysql</span>.</p></li><li><p><em class="emphasis"><span class="literal">unicodeString/characterSet</span>
        (String)</em></p><p>This is the character set that the database should use to store
        <span class="literal">UNICODE_STRING</span> properties in the database. This is
        set to <em class="emphasis">utf8</em> by default. It should be rare that
        this should ever be changed. For more details on the effects of
        setting this option please refer to the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>, chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Character_Set_Encodings" class="olink"><i>Character Sets and Encodings</i></a>, section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_DBMgr_MySQL_UNICODE_STRING" class="olink">UNICODE_STRING storage</a>.</p><p>See the option <span class="literal">dbMgr/unicodeString/collation</span>
        for for information on setting the collation type.</p></li><li><p><em class="emphasis"><span class="literal">unicodeString/collation</span>
        (String)</em></p><p>This is the default collation that the database associates with
        <span class="literal">UNICODE_STRING</span> properties. This is set to
        <em class="emphasis">utf8_bin</em> by default. This can be set to
        <em class="emphasis">utf8_general_ci</em>, for example, if case insensitive
        lookups on identifier fields are required. With this setting,
        identifiers need to be unique using a case-insensitive comparison. For
        more details on the effects of setting this option please refer to the
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>, chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Character_Set_Encodings" class="olink"><i>Character Sets and Encodings</i></a>, section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Encodings_Sorting_Search_Results" class="olink">Sorting search results</a>.</p><p>See <span class="literal">dbMgr/unicodeString/characterSet</span> for
        setting the character set.</p></li><li><p><em class="emphasis"><span class="literal">username</span>
        (String)</em></p><p><em class="emphasis">Only valid when the MySQL database layer is
        used.</em></p><p>Username used when the DBMgr connects to the underlying
        database.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4134"></a>2.14.1.&nbsp;Data Consolidation Options</h3></div></div></div><p>The options for data consolidation tool are located in the
      <code class="code">&lt;dbMgr&gt;/&lt;consolidation&gt;</code> section of the server
      configuration file <code class="code">&lt;res&gt;/server/bw.xml</code></p><p>For more detail about the data consolidation process, see <a href="#xref_Data_Consolidation_Tool" title="5.3.&nbsp;Data Consolidation Tool">Data Consolidation Tool</a>).</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">directory</span>
          (String)</em></p><p>Directory where the data consolidation tool puts temporary
          secondary database files copied from BaseApp machines. These files
          are automatically deleted when the data consolidation process
          completes.</p><p>If the first character of the path is a <span class="literal">/</span>
          character, the path is treated as an absolute path. Otherwise, the
          path is treated as relative to the first <code class="code">&lt;res&gt;</code>
          path that contains the directory.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>It is not recommended to set the SQLite secondary database
        directory to reside on a network file-system. SQLite has specific
        requirements with regards to using file locking services from the
        file-system which may not be implemented properly for network
        file-systems.</p><p>It is recommended that each BaseApp machine has a dedicated
        space on a local file-system for storing secondary database
        files.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4170"></a>2.14.2.&nbsp;XML Database Options</h3></div></div></div><p>The options specific to using XML as the database type are located
      in the <code class="code">&lt;dbMgr&gt;/&lt;xml&gt;</code> section of the server
      configuration file <code class="code">&lt;res&gt;/server/bw.xml</code></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The XML database is written in the main thread. If saving takes
        a long time, this can block any processing by DBMgr. To avoid this,
        disable archiving and automatic saving.</p></div><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">archivePeriod</span>
          (Float)</em></p><p>Number of seconds between making an archive of the XML
          database. The newest archive is
          <code class="filename">scripts/db.xml.1</code> then
          <code class="filename">scripts/db.xml.2</code> etc.</p><p>To disable archiving, set this value to
          <span class="literal">0.0</span>.</p></li><li><p><em class="emphasis"><span class="literal">numArchives</span>
          (Integer)</em></p><p>Number of archives to keep of the XML database.</p></li><li><p><em class="emphasis"><span class="literal">savePeriod</span>
          (Float)</em></p><p>Number of seconds between saving the XML database to disk. The
          previous file is <code class="filename">backed up as
          scripts/db.xml.bak</code>.</p><p>To disable backing up, set this value to
          <span class="literal">0.0</span>.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_LoginApp_Configuration_Options"></a>2.15.&nbsp;LoginApp Configuration Options</h2></div></div></div><p>The LoginApp configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the section <span class="literal">&lt;loginApp&gt;</span>, and are described
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">allowLogin</span>
        (Boolean)</em></p><p>Flag indicating whether login attempts should be
        accepted.</p><p>This is useful when the server needs to be started without
        accepting logins for a while (<em class="emphasis">e.g.</em>, to have the
        server load chunks before allowing logins).</p><p>Logins can be enabled by setting <span class="literal">allowLogin</span>
        watcher on each LoginApp to <span class="literal">true</span> <span class="symbol">&#8208;</span> for a simpler way to achieve this for
        all running LoginApps, see <span class="literal">control_cluster.py</span>'s
        <span class="literal">set</span> command<sup>[<a name="d0e4271" href="#ftn.d0e4271">3</a>]</sup>.</p></li><li><p><em class="emphasis"><span class="literal">allowProbe</span>
        (Boolean)</em></p><p>Flag indicating whether login probes should be accepted.</p><p>It is recommended to have this flag set to
        <span class="literal">false</span> for servers running on the public
        Internet.</p><p>This setting can be changed at runtime by settings the
        <span class="literal">allowProbe</span> watcher.</p><p>See also option <span class="literal">logProbes</span>.</p></li><li><p><em class="emphasis"><span class="literal">allowUnencryptedLogins</span>
        (Boolean)</em></p><p>Flag indicating whether a client sending a plaintext login
        request and/or a null session key should be allowed to connect.</p><p>This flag should only be used for testing purposes. Setting this
        flag to true on a production system is not recommended.</p></li><li><p><em class="emphasis"><span class="literal">externalInterface</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">externalLatencyMax</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">externalLatencyMin</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">externalLossRatio</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalInterface</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p><p><em class="emphasis">This tag is deprecated, and its use is not
        recommended. For details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>,
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined" class="olink">BWMachined</a>,
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined_Interface_Discovery" class="olink">BWMachined Interface Discovery</a>.</em></p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMax</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMin</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLossRatio</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">loginRateLimit</span>
        (Integer)</em></p><p>Specifies the number of allowed logins when rate-limiting. As
        many logins as this are allowed during each rate-limiting period as
        specified in option <span class="literal">rateLimitDuration</span>.</p><p>For example, if option <span class="literal">loginRateLimit</span> is set
        to 100, and option <span class="literal">rateLimitDuration</span> is set to 10,
        then 100 logins will be allowed every 10 seconds. If the login rate
        limit quota is exceeded during this period, no further logins are
        allowed until the start of the next 10 second period.</p><p>See also option <span class="literal">rateLimitDuration</span>.</p></li><li><p><em class="emphasis"><span class="literal">logProbes</span>
        (Boolean)</em></p><p>Flag indicating whether login probe attempts should generate a
        log message.</p><p>This might be useful for servers running on the public Internet,
        to verify users who are attempting to probe and/or hack the
        server.</p><p>See also option <span class="literal">allowProbe</span>.</p></li><li><p><em class="emphasis"><span class="literal">externalPorts/port</span>
        (Integer)</em></p><p>Port that the LoginApp should listen to for login
        requests.</p><p>If set to zero, then a random port is chosen, which is useful
        when running multiple BigWorld server instances in a LAN. The client
        would then need to auto-detect the available servers. For more
        details, see <a href="#xref_Auto_Detections_Of_LoginApps" title="10.3.&nbsp;Auto-Detection of LoginApps">Auto-Detection of LoginApps</a>.</p><p>Multiple port entries may be specified if necessary in order to
        provide a range of ports to use on a machine. This is useful if
        multiple LoginApps are intended to be used on the same machine, and
        would generally be used in conjunction with the option
        <span class="literal">shouldShutDownIfPortUsed</span>. For example:</p><pre class="programlisting">&lt;loginApp&gt;
  &lt;externalPorts&gt;
    &lt;port&gt; 20013 &lt;/port&gt;
    &lt;port&gt; 20014 &lt;/port&gt;
    &lt;port&gt; 20015 &lt;/port&gt;
  &lt;/externalPorts&gt;
  &lt;shouldShutDownIfPortUsed&gt; true &lt;/shouldShutDownIfPortUsed&gt;
&lt;/loginApp&gt;</pre></li><li><p><em class="emphasis">maxLoginDelay (Float)</em></p><p>If the response from the LoginApp to the client is lost, the
        successful login needs to be resent to the client. This setting is the
        number of seconds that a successful login attempt is kept.</p></li><li><p><em class="emphasis"><span class="literal">privateKey</span>
        (String)</em></p><p>This is the filename to read the LoginApp's RSA private key
        from. This is the key that is used to decrypt the client's login
        credentials.</p><p>Please see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Encrypting_Client_Server_Traffic" class="olink"><i>Encrypting Client-Server Traffic</i></a> for more
        information about the encryption support in BigWorld.</p></li><li><p><em class="emphasis"><span class="literal">rateLimitDuration</span>
        (Integer)</em></p><p>Specifies the rate-limiting time period in seconds. As many
        logins as is specified in option <span class="literal">loginRateLimit</span> are
        allowed during every one of these periods.</p><p>For example, if option <span class="literal">loginRateLimit</span> is set
        to 100, and option <span class="literal">rateLimitDuration</span> is set to 10,
        then 100 logins will be allowed every 10 seconds. If the login rate
        limit quota is exceeded during this period, no further logins are
        allowed until the start of the next 10 second period.</p><p>Setting this value to 0 disables login rate limiting.</p><p>See also option <span class="literal">loginRateLimit</span>.</p></li><li><p><em class="emphasis"><span class="literal">registerExternalInterface</span>
        (Boolean)</em></p><p>If set to true, the LoginApp's external interface will be
        registered with bwmachined. This may be useful during development to
        allow clients to discover running server. This should be set to false
        in a production environment.</p></li><li><p><em class="emphasis"><span class="literal">shouldShutDownIfPortUsed</span>
        (Boolean)</em></p><p>Flag indicating whether the LoginApp should shut down if the
        specified port to listen to is not available.</p><p>If set to true, the LoginApp will shut down if the specified
        ports to listen to is not available. If set to false, the LoginApp
        will find another port to listen to.</p><p>See also option <span class="literal">port</span>.</p></li><li><p><em class="emphasis"><span class="literal">shutDownSystemOnExit</span>
        (Boolean)</em></p><p>Flag indicating whether the server should be also shut down when
        LoginApp is shut down.</p><p>If set to <span class="literal">true</span>, then a controlled shutdown is
        performed on the server.</p></li><li><p><em class="emphasis"><span class="literal">verboseExternalInterface</span>
        (Boolean)</em></p><p>Flag indicating whether to generate verbose log output related
        to external network traffic.</p><p>What is verbose about it? what should they expect to see and why
        would they want to use it</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Reviver_Configuration_Options"></a>2.16.&nbsp;Reviver Configuration Options</h2></div></div></div><p>The Reviver configuration options are specified in file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
    under the reviver section, and are described below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">internalLatencyMax</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLatencyMin</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">internalLossRatio</span></em></p><p>For details, see <a href="#xref_General_Configuration_Options" title="2.4.&nbsp;General Configuration Options">General Configuration Options</a>.</p></li><li><p><em class="emphasis"><span class="literal">pingPeriod</span>
        (Float)</em></p><p>Number of seconds between pings sent to monitored processes for
        execution check purposes.</p><p>Reviver's monitor processes periodically by pinging them to
        check that they are still running and functioning normally.</p><p>See also option <span class="literal">subjectTimeout</span>.</p></li><li><p><em class="emphasis"><span class="literal">reattachPeriod</span>
        (Float)</em></p><p>Number of seconds between each time that Reviver checks
        processes to determine if it can monitor them.</p><p>If another Reviver stops monitoring a process, this option
        allows this Reviver to start monitoring that process.</p><p>See also option <span class="literal">subjectTimeout</span>.</p></li><li><p><em class="emphasis"><span class="literal">shutDownOnRevive</span>
        (Boolean)</em></p><p>Flag indicating whether the Reviver itself should be shut down
        after reviving a monitored process.</p><p>This is usually set to <span class="literal">true</span>, since once a
        Reviver has started a process, that machine should probably be
        considered busy.</p><p>See also option <span class="literal">subjectTimeout</span>.</p></li><li><p><em class="emphasis"><span class="literal">subjectTimeout</span>
        (Float)</em></p><p>Number of seconds that a monitored process will wait for a
        response from its current Reviver before accepting to be monitored by
        another one.</p><p>If a monitored process does not receive a response from its
        current Reviver, then it is assumed that the Reviver has been stopped
        after reviving another one of its monitored processes (this behaviour
        is set by option <span class="literal">shutDownOnRevive</span>).</p><p>See also options <span class="literal">pingPeriod</span>,
        <span class="literal">reattachPeriod</span> and
        <span class="literal">shutDownOnRevive</span>.</p></li><li><p><em class="emphasis"><span class="literal">timeoutInPings</span>
        (Integer)</em></p><p>Number of pings that can be missed by a monitored process before
        Reviver assumes it is dead.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4662"></a>2.16.1.&nbsp;Reviver's BaseAppMgr Configuration Options</h3></div></div></div><p>The BaseAppMgr configuration options are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;reviver&gt;/&lt;baseAppMgr&gt;</span>.
      These are the same as general Reviver options, but specific to
      BaseAppMgr. If the setting is not specified, then the general one is
      used. For details on these options, see <a href="#xref_Reviver_Configuration_Options" title="2.16.&nbsp;Reviver Configuration Options">Reviver Configuration Options</a>.</p><p>The options are listed below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">pingPeriod</span>
          (Float)</em></p></li><li><p><em class="emphasis"><span class="literal">subjectTimeout</span>
          (Float)</em></p></li><li><p><em class="emphasis"><span class="literal">timeoutInPings</span>
          (Integer)</em></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4698"></a>2.16.2.&nbsp;Reviver's CellAppMgr Configuration Options</h3></div></div></div><p>The CellAppMgr configuration options are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;reviver&gt;/&lt;cellAppMgr&gt;</span>.
      These are the same as general Reviver options, but specific to
      CellAppMgr. If the setting is not specified, then the general one is
      used. For details on these options, see <a href="#xref_Reviver_Configuration_Options" title="2.16.&nbsp;Reviver Configuration Options">Reviver Configuration Options</a>.</p><p>The options are listed below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">pingPeriod</span>
          (Float)</em></p></li><li><p><em class="emphasis"><span class="literal">subjectTimeout</span>
          (Float)</em></p></li><li><p><em class="emphasis"><span class="literal">timeoutInPings</span>
          (Integer)</em></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4734"></a>2.16.3.&nbsp;Reviver's DBMgr Configuration Options</h3></div></div></div><p>The DBMgr configuration options are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;reviver&gt;/&lt;dbMgr&gt;</span>. These
      are the same as general Reviver options, but specific to DBMgr. If the
      setting is not specified, then the general one is used. For details on
      these options, see <a href="#xref_Reviver_Configuration_Options" title="2.16.&nbsp;Reviver Configuration Options">Reviver Configuration Options</a>.</p><p>The options are listed below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">pingPeriod</span>
          (Float)</em></p></li><li><p><em class="emphasis"><span class="literal">subjectTimeout</span>
          (Float)</em></p></li><li><p><em class="emphasis"><span class="literal">timeoutInPings</span>
          (Integer)</em></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4770"></a>2.16.4.&nbsp;Reviver's LoginApp Configuration Options</h3></div></div></div><p>The LoginApp configuration options are specified in file
      <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>
      under section <span class="literal">&lt;reviver&gt;/&lt;loginApp&gt;</span>. These
      are the same as general Reviver options, but specific to LoginApp. If
      the setting is not specified, then the general one is used. For details
      on these options, see <a href="#xref_Reviver_Configuration_Options" title="2.16.&nbsp;Reviver Configuration Options">Reviver Configuration Options</a>.</p><p>The options are listed below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">pingPeriod</span>
          (Float)</em></p></li><li><p><em class="emphasis"><span class="literal">subjectTimeout</span>
          (Float)</em></p></li><li><p><em class="emphasis"><span class="literal">timeoutInPings</span>
          (Integer)</em></p></li></ul></div></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e3057" href="#d0e3057">1</a>] </sup>For more details, see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Properties" class="olink"><i>Properties</i></a> <span class="symbol">&#8594;</span> <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Data_Distribution" class="olink">Data Distribution</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e3615" href="#d0e3615">2</a>] </sup>For details, see <a href="#xref_CellApp_Fault_Tolerance" title="4.1.&nbsp;CellApp Fault Tolerance">CellApp Fault Tolerance</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e4271" href="#d0e4271">3</a>] </sup>For details on <span class="literal">control_cluster.py</span>, see
            <a href="#xref_control_cluster_py" title="3.4.1.&nbsp;Control Cluster">Control Cluster</a>.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Admin_Tools"></a>Chapter&nbsp;3.&nbsp;Cluster Administration Tools</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#xref_WebConsole">3.1. WebConsole</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e4878">3.1.1. Modules</a></span></dt><dt><span class="section"><a href="#xref_WebConsole_Installation_And_Configuration">3.1.2. Installation and Configuration</a></span></dt><dt><span class="section"><a href="#xref_WebConsole_User_Admin">3.1.3. User Administration</a></span></dt><dt><span class="section"><a href="#xref_WebConsole_Modes">3.1.4. Production Mode vs Development Mode</a></span></dt><dt><span class="section"><a href="#xref_WebConsole_Customising">3.1.5. Customising</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_MessageLogger">3.2. Message Logger</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5217">3.2.1. Configuration</a></span></dt><dt><span class="section"><a href="#d0e5275">3.2.2. File Format</a></span></dt><dt><span class="section"><a href="#xref_Command_Line_Utilities">3.2.3. Command Line Utilities</a></span></dt><dt><span class="section"><a href="#d0e5562">3.2.4. Automatic Log Archiving</a></span></dt><dt><span class="section"><a href="#xref_MessageLogger_Scalability">3.2.5. Production Scalability</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_StatLogger">3.3. StatLogger</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e5664">3.3.1. Requirements</a></span></dt><dt><span class="section"><a href="#d0e5715">3.3.2. Output</a></span></dt><dt><span class="section"><a href="#xref_StatLogger_Data_Collection_And_Aggregation">3.3.3. Data Collection and Aggregation</a></span></dt><dt><span class="section"><a href="#xref_StatLogger_Configuration">3.3.4. Configuration</a></span></dt><dt><span class="section"><a href="#d0e6167">3.3.5. Database</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Server_Command_Line_Utilities">3.4. Server Command-Line Utilities</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_control_cluster_py">3.4.1. Control Cluster</a></span></dt><dt><span class="section"><a href="#d0e6634">3.4.2. MessageLogger Related Utilities</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Space_Viewer">3.5. Space Viewer</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e6693">3.5.1. Selecting Spaces to View</a></span></dt><dt><span class="section"><a href="#d0e6711">3.5.2. Viewing Spaces</a></span></dt><dt><span class="section"><a href="#xref_Customising_Entity_And_Display_Colours">3.5.3. Customising Entity and Display Colours</a></span></dt><dt><span class="section"><a href="#xref_Running_Space_Viewer_Remotely">3.5.4. Running Space Viewer Remotely</a></span></dt></dl></dd></dl></div><p>A variety of tools are provided to assist in managing a BigWorld
  server. Broadly, these fall into four categories:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">WebConsole</em></p></li><li><p><em class="emphasis">Logging Processes</em></p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">Message Logger</em> (See <a href="#xref_MessageLogger" title="3.2.&nbsp;Message Logger">Message Logger</a>.)</p></li><li><p><em class="emphasis">Stat Logger</em> (See <a href="#xref_StatLogger" title="3.3.&nbsp;StatLogger">StatLogger</a>.)</p></li></ul></div></li><li><p><em class="emphasis">Server command-line utilities (e.g.,
      <span class="literal">control_cluster.py</span>) </em> (See <a href="#xref_Server_Command_Line_Utilities" title="3.4.&nbsp;Server Command-Line Utilities">Server Command-Line Utilities</a>.)</p></li><li><p><em class="emphasis">Space Viewer</em> (See <a href="#xref_Space_Viewer" title="3.5.&nbsp;Space Viewer">Space Viewer</a>.)</p></li></ul></div><p>The server tools are implemented almost entirely in Python, and can be
  easily extended, if additional functionality is desired.</p><p>Most of the server tools' functionality is available from WebConsole,
  an easy to use web interface which simplifies server administration for
  remote users and non-programmers (<em class="emphasis">e.g.</em>, artists, game
  designers, etc.) that may need to run and administer servers.</p><p>Almost all server tool functionality is also available via
  command-line utilities, which is useful when only system console access is
  available (<em class="emphasis">e.g.</em>, when remotely administering a server
  cluster via ssh).</p><p>Where possible, documentation for the server tools is maintained as
  online help. For WebConsole, this means the Help link displayed in the
  navigation menu for each module. For command-line utilities, help is
  available via the --help switch.</p><p>This chapter provides an overview of the suite of tools available. For
  detailed documentation, however, please refer to the online help.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_WebConsole"></a>3.1.&nbsp;WebConsole</h2></div></div></div><p>Located under <code class="filename">bigworld/tools/server/web_console</code> ,
    WebConsole provides a simple web interface to manage and monitor a
    BigWorld server. For details on how to install and run WebConsole, see the
    document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_tools_installation_guide/server_tools_installation_guide.html#Server_Tools_Installation_Guide" class="olink">Server Tools Installation Guide</a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e4878"></a>3.1.1.&nbsp;Modules</h3></div></div></div><p>WebConsole is functionally divided into units referred to as
      <em class="emphasis">Modules</em>. Each module in WebConsole has a separate
      top level menu item in the main navigation menu on the left hand side of
      the page.</p><p>Complete documentation for each WebConsole module is provided as
      online help, accessible as a link on the left hand side of the
      WebConsole page.</p><p>WebConsole is composed of the modules described below.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_WebConsole_ClusterControl"></a>3.1.1.1.&nbsp;ClusterControl</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Allows users to start, stop, and restart the game
            server.</p></li><li><p>Browse the active machines and users on the local
            network.</p></li><li><p>View and modify saved cluster configurations.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_WebConsole_Watchers"></a>3.1.1.2.&nbsp;Watchers</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Allows users to view and modify Watcher values of active
            server processes.</p></li><li><p>Generate pre-configured and user generated tabular reports
            of watcher values across sets of server processes in a
            cluster.</p></li><li><p>Define custom sets of watcher values for live
            monitoring.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_WebConsole_LogViewer"></a>3.1.1.3.&nbsp;LogViewer</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Allows users to view, filter, and search server message
            logs.</p></li><li><p>Provides a real time / live view of server output.</p></li><li><p>Summaries of per-user log usage.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_WebConsole_StatGrapher"></a>3.1.1.4.&nbsp;StatGrapher</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Provides live and historic graphic views of server
            statistics.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_WebConsole_PyConsole"></a>3.1.1.5.&nbsp;Python Console</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Allows users to connect to the Python server of any Python
            enabled process (<em class="emphasis">i.e.</em>, CellApp, BaseApp,
            Bots).</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_WebConsole_Commands"></a>3.1.1.6.&nbsp;Commands</h4></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>Provides access to a set of pre-defined functionality on
            server processes that can be run from WebConsole as
            required.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_WebConsole_Installation_And_Configuration"></a>3.1.2.&nbsp;Installation and Configuration</h3></div></div></div><p>For detailed instructions on installing and configuring WebConsole
      please refer to the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_tools_installation_guide/server_tools_installation_guide.html#Server_Tools_Installation_Guide" class="olink">Server Tools Installation Guide</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_WebConsole_User_Admin"></a>3.1.3.&nbsp;User Administration</h3></div></div></div><p>The first time WebConsole is started you will need to add at least
      one user in order to operate a BigWorld server. To achieve this, from
      the front page of WebConsole, login with a username / password of
      <span class="literal">admin</span>. If you have never loaded the WebConsole
      homepage before, it should be visible at the url
      <span class="literal">http://<em class="replaceable"><code>hostname</code></em>:8080</span>,
      where <em class="replaceable"><code>hostname</code></em> is the network name of the
      machine you install WebConsole on.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/webconsole_admin_title.png" align="middle"></div></div><p>Once logged in you should be presented with a webpage similar to
      the following.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/webconsole_admin_main.png" align="middle"></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_WebConsole_Admin_Add_New_User"></a>3.1.3.1.&nbsp;Adding A New User</h4></div></div></div><p>To add a new user, click on the "Add New User" menu item on the
        left hand side of the page. You will then be presented with a form to
        input as follows:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/webconsole_admin_add_user.png" align="middle"></div></div><p>The table below summarises the input fields providing sample
        input:</p><div class="altrow"><table border="1" width="75%"><colgroup><col width="33%"><col width="67%"></colgroup><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>Username</td><td>The username that for the new user.</td></tr><tr><td>Password</td><td>The password that the new user will login with.</td></tr><tr><td>Confirm Password</td><td>The password from the previous field, retyped to ensure
                no mistake was made on entry.</td></tr><tr><td>Server User</td><td><p>The Linux user this account will be associated
                with. This will be the Linux user that the BigWorld server
                processes will be run as.</p> <p>If you are uncertain of
                this field, please talk to your system administrator to find
                out what your Linux user account is.</p></td></tr></tbody></table></div><p>The following image shows a new user account
        <span class="literal">AliceB</span> being created and associated with the Linux
        user account <span class="literal">alice</span>.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/webconsole_admin_add_user_alice.png" align="middle"></div></div><p>Once all the user information has been input, simply click the
        <span class="guibutton">Add User</span> button and you will be returned to the
        main user listing with the new user in the list.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/webconsole_admin_main_alice.png" align="middle"></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_WebConsole_Admin_Flush_User_Mappings"></a>3.1.3.2.&nbsp;Flush User Mappings</h4></div></div></div><p>The Flush User Mappings menu option provides the ability for
        WebConsole to force all BWMachined instances in the network to forget
        their current cached user list. This feature is useful and sometimes
        necessary when adding users to a network information system such as
        LDAP which are sometimes used as account management systems.</p><p>If you are having problems detecting a newly added user in your
        network, or are seeing an old user appear in your cluster display,
        flushing the user mapping will quite often help resolve the
        issue.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_WebConsole_Modes"></a>3.1.4.&nbsp;Production Mode vs Development Mode</h3></div></div></div><p>WebConsole can be started using two methods, as a system wide
      service<sup>[<a name="d0e5068" href="#ftn.d0e5068">4</a>]</sup>, or from the command line.</p><p>Generally, only developers working on modifying the web page
      templates or underlying code will run WebConsole from the command line.
      In order to achieve this, make sure that the current directory is
      <code class="filename">bigworld/tools/server/web_console</code>, then
      issue the command:</p><pre class="programlisting">$ ./start-web_console.py</pre><p>There are some minor operational differences when running
      WebConsole in command line mode vs as a system service:</p><div class="itemizedlist"><ul type="disc"><li><p>When run as a system daemon, WebConsole uses the configuration
          file <code class="filename">prod.cfg</code>, which defines a production
          environment mode.</p></li><li><p>When run from the command line, WebConsole uses a development
          environment configuration file called
          <code class="filename">dev.cfg</code>.</p></li></ul></div><p>Running in development mode leaves the web server in a state where
      an automatic restart is triggered if there are any changes to the
      template files or Python code it is using.</p><p>The production configuration file does not exist by default in
      <code class="filename">bigworld/tools/server/web_console</code>, as it is
      partially generated during the installation process while using the
      <code class="filename">install_tools.py</code> script. The original production
      configuration file that the installation script uses is
      <code class="filename">bigworld/tools/server/install/web_console.cfg</code>.</p><p>Both configuration files need to specify the database to use.
      Before running WebConsole, make sure that the appropriate configuration
      file has a line that looks like this:</p><pre class="programlisting">sqlobject.dburi="notrans_mysql://username:password@localhost:3306/bw_web_console"</pre><p><span class="citetitle">Specifying the database</span></p><p>To modify the
      <code class="filename">bigworld/tools/server/install/web_console.cfg</code> file
      to a working configuration file, replace the line:</p><pre class="programlisting">###BW_SQLURI###</pre><p>with an <span class="literal">sqlobject.dburi</span> line as indicated
      above.</p><p>For information regarding TurboGears configuration files and
      content, we recommend the TurboGears documentation website <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://docs.turbogears.org/1.0/Configuration" target="_top">http://docs.turbogears.org/1.0/Configuration</a>.</p><p>If you have never run WebConsole before and choose to run it from
      the command line (as opposed to installing the system service), it is
      necessary to create a database for WebConsole within MySQL. To do this,
      connect to your MySQL database using the username and password that you
      have defined in <code class="filename">dev.cfg</code>, then issue the following
      command:</p><pre class="programlisting">CREATE DATABASE bw_web_console;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_WebConsole_Customising"></a>3.1.5.&nbsp;Customising</h3></div></div></div><p>As WebConsole is a convenient interface to your cluster
      environment, it may be useful to add new content to WebConsole that is
      unique to your companies requirements. To achieve this please refer to
      the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a> chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_WebConsole_Overview" class="olink"><i>Web Console</i></a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_MessageLogger"></a>3.2.&nbsp;Message Logger</h2></div></div></div><p>Message Logger is a process used for logging output from BigWorld
    processes within a network. This is primarily intended as a mechanism for
    logging output from server processes, however in a development environment
    it can be useful for game clients and other tools to send log messages as
    well. The source code for Message Logger can be located in <code class="filename">bigworld/src/server/tools/message_logger</code>,
    while its executable is found in <code class="filename">bigworld/tools/server/bin</code>. Message Logger is
    a stand alone Linux process that can be run on any machine in a BigWorld
    cluster that is running BWMachined.</p><p>A suite of Python tools and libraries is also provided for accessing
    and manipulating logs that have been generated by Message Logger. These
    tools can be found in <code class="filename">bigworld/tools/server/message_logger</code>.</p><p>Detailed documentation for the supported command line arguments is
    available as online help using the <code class="option">--help</code> option.</p><p>When a server process, such as a CellApp, is started it performs a
    search of the network cluster it is operating within for all active
    Message Logger processes. Any output that is generated as a result of
    script <code class="function">print</code> statements or C++ calls to the message
    handlers (<span class="literal">INFO_MSG</span>, <span class="literal">ERROR_MSG</span>,
    etc....) are sent to all known Message Logger instances. Message Logger
    processes that are started after a server process will notify all running
    server components of their existence and commence logging of all
    subsequent messages.</p><p>The BigWorld Client can also be configured to send messages to
    Message Logger. By default this is enabled in the Hybrid build and
    disabled in the Release build. The Consumer build logging options are
    controlled by a set of <span class="literal">#define</span>s in
    <code class="filename">src/lib/cstdmf/config.hpp</code>.</p><p>The following values should be defined in the Consumer build to
    enable the Client to send log messages to Message Logger instances:</p><pre class="programlisting">#define FORCE_ENABLE_MSG_LOGGING     1
#define FORCE_ENABLE_DPRINTF         1
#define FORCE_ENABLE_WATCHERS        1</pre><p>Messages from the client are by default sent as the
    <span class="literal">root</span> user (i.e., with a linux UID of 0). In order to
    associate logs generated from a Client with a specific user within a
    network, a Windows environment variable <code class="envar">UID</code> can be set.
    This variable should have a value corresponding with the user's Linux
    account user id. For example a developer Alice with a Linux account name
    of <span class="literal">aliceb</span> could discover her user id on Linux by
    logging in to her Linux account and typing the following command:</p><pre class="programlisting">$ id
uid=3592(aliceb) gid=501(UmbrellaCorp)</pre><p>Alice can then set a Windows environment variable of
    <code class="envar">UID</code> with the value <span class="literal">3592</span>. Any logs
    generated by Alice running the BigWorld Client will now be associated with
    her.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5217"></a>3.2.1.&nbsp;Configuration</h3></div></div></div><p>Except where overridden by the corresponding command line option,
      Message Logger reads its configuration from the file
      <code class="filename">bigworld/tools/server/message_logger/message_logger.conf</code>.</p><p>The configuration file is in standard Windows INI file format, and
      supports the following options:</p><div class="altrow"><table border="1" width="90%"><colgroup><col width="33%"><col width="67%"></colgroup><thead><tr><th>Option Name</th><th>Description</th></tr></thead><tbody><tr><td>logdir</td><td>The location of the top level directory to which Message
              Logger will write its logs. This option can be either a relative
              or an absolute path. If a relative path is specified, then it is
              calculated relative to the location of the configuration
              file.</td></tr><tr><td>segment_size</td><td>Size (in bytes) at which the logger will automatically
              roll the current log segment for a particular user.</td></tr><tr><td>default_archive</td><td>File used by <code class="filename">mltar.py</code> when the
              <code class="option">--default_archive</code> option is used. This file is
              also inserted into Message Logger's logrotate script during
              installation.</td></tr><tr><td>groups</td><td>A comma separated list of machine group names. When
              specified MessageLogger will only accept log messages
              originating from machines that have a matching group name listed
              in the <span class="literal">[Groups]</span> section of
              <code class="filename">/etc/bwmachined.conf</code>. For more details see
              <a href="#xref_MessageLogger_Scalability" title="3.2.5.&nbsp;Production Scalability">Production Scalability</a>.</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5275"></a>3.2.2.&nbsp;File Format</h3></div></div></div><p>Message Logger generates log files in a binary format in order to
      make the best use of disk space as possible. In order to access the
      binary logs, two Python modules are provided:</p><div class="altrow"><table border="1" width="90%"><colgroup><col width="25%"><col width="75%"></colgroup><thead><tr><th>Python Module</th><th>Description</th></tr></thead><tbody><tr><td><code class="filename">bwlog.so</code></td><td><p>Location: <code class="filename">bigworld/tools/server/bin/Hybrid<em class="replaceable"><code>64</code></em></code></p>
              <p>A binary Python extension compiled from Message Logger
              source code.</p></td></tr><tr><td><code class="filename">message_log.py</code></td><td><p>Location: <code class="filename">bigworld/tools/server/message_logger</code></p>
              <p>Python classes that simplify and extend the functionality
              exposed from <code class="filename">bwlog.so</code>.</p></td></tr></tbody></table></div><p>For examples on how to use these modules, browse the source code
      of the command-line message logger utilities described in <a href="#xref_Command_Line_Utilities" title="3.2.3.&nbsp;Command Line Utilities">Command Line Utilities</a>.</p><p>Message Logger generates logs in a two level directory structure.
      The top level directory contains files that are common to all users, and
      contains one sub directory per user. The files in the top level
      directory are:</p><div class="altrow"><table border="1" width="90%"><colgroup><col width="28%"><col width="72%"></colgroup><thead><tr><th>Filename</th><th>Description</th></tr></thead><tbody><tr><td><code class="filename">component_names</code></td><td>List of all distinct component names
              (<em class="emphasis">i.e.</em>, CellApp, BaseApp, etc...) that have
              sent messages to this logger. This is used to resolve numeric
              component type IDs to names, when displaying log output.</td></tr><tr><td><code class="filename">hostnames</code></td><td>Mapping from IP addresses to hostnames. This is used for
              resolving hostnames when displaying log output.</td></tr><tr><td><code class="filename">strings</code></td><td>List of all unique format strings that have been sent by
              logging components, along with parser data for interpreting
              arguments to each. This is used to reconstruct the log messages
              from format string IDs and binary argument blobs.</td></tr><tr><td><code class="filename">version</code></td><td>Log format version. This is used to prevent accidentally
              mixing two log formats.</td></tr><tr><td><code class="filename">pid</code></td><td>Process id of the active Message Logger process writing
              logs to this directory. This is used by both the tools and
              Message Logger to identify the process (if any) currently
              generating logs.</td></tr></tbody></table></div><p>Each user's sub directory has a file containing its UID, as well
      as the following files:</p><div class="altrow"><table border="1" width="90%"><colgroup><col width="28%"><col width="72%"></colgroup><thead><tr><th>Filename</th><th>Description</th></tr></thead><tbody><tr><td><code class="filename">components</code></td><td>A record of each individual process instance registered
              with this logger.</td></tr><tr><td><code class="filename">entries.<em class="replaceable"><code>&lt;timestamp&gt;</code></em></code>,
              <code class="filename">args.<em class="replaceable"><code>&lt;timestamp&gt;</code></em></code></td><td><p>A collection of log messages.</p> <p>The
              fixed length portion of each log message (time, component ID,
              etc...) is stored in the
              <code class="filename">entries.<em class="replaceable"><code>&lt;timestamp&gt;</code></em></code>
              file, while the variable-length portion of the entry
              (<em class="emphasis">i.e.</em>, arguments to printf) is stored in
              the corresponding
              <code class="filename">args.<em class="replaceable"><code>&lt;timestamp&gt;</code></em></code>
              file.</p> <p>The variable length section data corresponds
              to an entry in the format string file
              <code class="filename">strings</code>.</p></td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Command_Line_Utilities"></a>3.2.3.&nbsp;Command Line Utilities</h3></div></div></div><p>The <code class="filename">bigworld/tools/server/message_logger</code>
      directory contains a variety of command line utilities providing the
      functionality of standard UNIX shell utilities for BigWorld message
      logs. Using these utilities you can operate on the binary logs using
      standard UNIX shell utilities and pipelines in the same way you can with
      ordinary text files.</p><p>The following tools are provided:</p><div class="altrow"><table border="1" width="75%"><colgroup><col width="25%"><col width="75%"></colgroup><thead><tr><th>Utility</th><th>Description</th></tr></thead><tbody><tr><td><span><strong class="command">mlcat.py</strong></span></td><td>Provides both <span><strong class="command">cat</strong></span> and <span><strong class="command">tail
              -f</strong></span> style of text log outputting.</td></tr><tr><td><span><strong class="command">mlls.py</strong></span></td><td>Displays information about log segments, such as start
              and end times, entry counts, and sizes; for individual users or
              all of them.</td></tr><tr><td><span><strong class="command">mltar.py</strong></span></td><td>Provides an easy way to select log segments from a user's
              log and archive them, as well as all the required shared files
              for viewing on another machine.</td></tr><tr><td><span><strong class="command">mlrm.py</strong></span></td><td>Provides an easy way to clean up unwanted log
              segments.</td></tr></tbody></table></div><p>The detailed documentation for each utility is maintained as
      online help, which can be accessed via the <code class="option">--help</code>
      option.</p><p>The following list provides some common examples of tasks you
      might wish to achieve using the Message Logger tools:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">mlcat.py
          -f</span></em></p><p>Watches live server logs.</p></li><li><p><em class="emphasis"><span class="literal">mlcat.py --around="Mon 22 Jan
          2007 19:00:00" -u devuser</span></em></p><p>Views output surrounding a log entry of interest for user
          devuser.</p></li><li><p><em class="emphasis"><span class="literal">mltar.py -zcf bwsupport.tar.gz
          --active-segment</span></em></p><p>Collects logs to email to support.</p></li><li><p><em class="emphasis"><span class="literal">mltar.py -u &lt;uid&gt; -zcf
          bwsupport.tar.gz --active-segment</span></em></p><p>Collects logs for the Unix user whose uid is <span class="literal">uid
          </span>to email to support.</p></li><li><p><em class="emphasis"><span class="literal">mlls.py -u
          gameuser</span></em></p><p>Displays all log segments for user gameuser, to determine the
          segment with entries of interest.</p></li><li><p><em class="emphasis"><span class="literal">mlrm.py
          --days=30</span></em></p><p>Removes logs over a month old.</p></li><li><p><em class="emphasis"><span class="literal">mltar.py -xf lastweek.tar.gz -o
          samplelogs</span></em></p><p>Extracts the archive <code class="filename">lastweek.tar.gz</code> to
          the directory <code class="filename">samplelogs</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Since the archives are compressed tar files, you can use tar
            to achieve the same results if you find that easier, as
            illustrated below:</p><pre class="programlisting">$ mkdir samplelogs
$ tar -zxf lastweek.tar.gz -C samplelogs</pre></div></li><li><p><em class="emphasis"><span class="literal">mltar.py
          -xd</span></em></p><p>Extracts the latest archive back to the default logdir.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5562"></a>3.2.4.&nbsp;Automatic Log Archiving</h3></div></div></div><p><span class="literal">The Linux logrotate scripts </span>are used to rotate
      (stop writing an old log file and start writing to a new file), archive
      (backup the old log file), and delete (log files deemed to be past an
      expiry time) log files on a daily basis, which can assist in conserving
      disk space. A logrotate configuration file,
      <code class="filename">/etc/logrotate.d/bw_message_logger</code>, is set up as
      part of the Server Tools installation. For more information about
      <span class="literal">logrotate</span>, please see the
      <span class="literal">logrotate</span> manpage:</p><pre class="programlisting">$ man 8 logrotate</pre><p>There are two issues to consider when customising the
      <span class="literal">logrotate</span>:</p><div class="itemizedlist"><ul type="disc"><li><p>Log rotation can put a load on the logging machine.</p></li><li><p>If rotation is configured to occur more frequently, for
          example the rotation is changed to occur on hourly basis, then in
          this case the <code class="code">rotate</code> option should be updated to 168
          (i.e. 7 x 24) to ensure that the log files cover the same period of
          time.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_MessageLogger_Scalability"></a>3.2.5.&nbsp;Production Scalability</h3></div></div></div><p>In order to assist Message Logger coping with heavy network and
      disk load in production environments, Message Logger supports logging
      subsets of machines within a server cluster. This is achieved by
      assigning a Message Logger process a list of machine groups that it
      should accept logs from, as well as assigning every machine in the
      cluster to a machine group. Both Message Logger and cluster machines may
      be assigned to multiple machine groups. In order to enable this feature
      both MessageLogger and BWMachined will need to be configured correctly
      throughout your cluster environment.</p><p>To limit a Message Logger process to only accept logs from a set
      of machine groups requires adding a comma separated list of group names
      to a <span class="literal">groups</span> entry in the file
      <code class="filename">bigworld/tools/server/message_logger/message_logger.conf</code>.
      For example, to assign a MessageLogger process to only accept logs from
      the machine groups <span class="literal">QA_Cluster1</span> and
      <span class="literal">QA_Cluster2</span> the following entry would be placed in
      <code class="filename">message_logger.conf</code>:</p><pre class="programlisting">[message_logger]
...
groups = QA_Cluster1, QA_Cluster2</pre><p>MessageLogger needs to be restarted in order to detect these
      changes, however once restarted an entry should appear in the
      MessageLogger log file
      <code class="filename">/var/log/bigworld/message_logger.log</code> similar to the
      following:</p><pre class="programlisting">2008-11-12 11:37:20: INFO: Logger::init: MessageLogger machine groups specified. Only accepting logs from: QA_Cluster1, QA_Cluster2</pre><p>For details on configuring BWMachined see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_installation_guide/server_installation_guide.html#Server_Installation_Guide" class="olink">Server Installation Guide</a> section <span xmlns:xlink="http://www.w3.org/1999/xlink" class="olink">????</span>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Currently in order to view the logs generated when using the
        machine group log separation will require either separate
        installations of WebConsole, or manual searching of the files with the
        <code class="filename">mlcat.py</code> tool on the host where MessageLogger is
        running. This limitation will be addressed in a future release of
        BigWorld.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_StatLogger"></a>3.3.&nbsp;StatLogger</h2></div></div></div><p>Written in Python, StatLogger is a daemon process that runs in the
    background, polling all servers on the network at regular intervals (by
    default, every 2 seconds). Any computer running BWMachined will be
    automatically discovered, along with any BigWorld components running on
    that machine. StatLogger collects and logs information for every server
    component discovered, regardless of which user is running them.</p><p>Statistics for machines and processes are collected in 2
    ways:</p><div class="itemizedlist"><ul type="disc"><li><p>Communication with BWMachined daemons running on each
        computer.</p></li><li><p>Requests made directly to the processes via the Watcher
        mechanism.</p></li></ul></div><p>Once collected, StatLogger logs this data to a MySQL database. For
    details on the structure of the database, see <a href="#xref_Statistics_Database_Structure" title="3.3.5.1.&nbsp;Database Structure">Database Structure</a>.</p><p>The main objective of StatLogger is to collect and store data in a
    format that can be used by StatGrapher<sup>[<a name="d0e5658" href="#ftn.d0e5658">5</a>]</sup>, which is the visualisation counterpart to StatLogger, and
    presents the data in a graphical format.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5664"></a>3.3.1.&nbsp;Requirements</h3></div></div></div><p>The list below describes the requirement for running
      StatLogger:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">CPU</em></p><p>On an Athlon 2700+, monitoring 230 processes (which includes
          200 CellApps) with StatLogger consumes roughly a constant 15% of
          available CPU time. The MySQL daemon also experienced a constant
          load increase of 5.5% due to the large amount of database queries
          being generated.</p></li><li><p><em class="emphasis">Disk</em></p><p>Due to the amount of data being collected, StatLogger can
          potentially consume a lot of disk space. The rate at which disk
          space is consumed depends on the amount of machines and server
          process for which statistics are collected. 4GB is recommended for a
          large amount of processes (around 250) and machines over a month.
          The disk space consumption rate of a single log gets smaller the
          longer a log is run, since StatLogger stores older data in lower
          detail than newer data.</p></li><li><p><em class="emphasis">Network</em></p><p>StatLogger's network requirements depend on the number of
          server machines and components present. It can potentially require a
          large amount of network throughput. For example, 230 processes and 9
          server machines require 100Kb/s of downstream traffic, and 20kb/s of
          upstream traffic, while 6 processes (<em class="emphasis">i.e.</em>, for
          a minimal server) and 9 server machines require 4kb/s of downstream
          and 2kb/s of upstream traffic.</p></li><li><p><em class="emphasis">RAM</em></p><p>Memory requirements are low, as statistics are immediately
          logged to the database, rather than being kept in memory. Tests
          indicate an average usage of memory between 7MB to 10MB, regardless
          of the amount of processes running.</p></li><li><p><em class="emphasis">Software</em></p><p>MySQL 4.1+ and Python 2.4 with MySQLdb.</p></li></ul></div><p>StatLogger must be run on the same local network as the BigWorld
      server processes that it is intended to monitor due to the manner in
      which machine and server component discovery occurs.</p><p>StatLogger requires a valid MySQL user with access to create
      databases. Normally the creation and configuration of this MySQL user is
      handled during the tools installation process<sup>[<a name="d0e5707" href="#ftn.d0e5707">6</a>]</sup>, but an existing database user can be can used instead, by
      manually editing the configuration file. For details, see <a href="#xref_StatLogger_Configuration" title="3.3.4.&nbsp;Configuration">Configuration</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e5715"></a>3.3.2.&nbsp;Output</h3></div></div></div><p>StatLogger outputs various status messages describing which
      machines and processes it discovers or loses (<em class="emphasis">i.e.</em>,
      from the process or machine shutting down) from the network, each
      prefixed with a timestamp.</p><p>When running StatLogger manually from the command line the default
      is to display this information to the terminal on which it is run unless
      the <code class="option">-o</code> option is specified.</p><p>When installed as a daemon, these messages output to the log file
      <code class="filename">/var/log/bigworld/stat_logger.log</code> by default. This
      log file is specified by the <code class="envar">LOG_FILE</code> variable in
      <code class="filename">/etc/init.d/bw_stat_logger</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_StatLogger_Data_Collection_And_Aggregation"></a>3.3.3.&nbsp;Data Collection and Aggregation</h3></div></div></div><p>As Stat Logger is responsible for collecting a constant stream of
      data from an arbitrarily large BigWorld server cluster for historical
      tracking it is necessary to prevent the database size from growing out
      of proportion. In order to achieve this Stat Logger implements a
      mechanism of aggregating and merging data from high resolution time
      periods into lower resolution time scales the older the data becomes.
      This approach allows high resolution data to be maintained for recent
      events when diagnostics are most likely to occur but allows a broad view
      of server performance over a long scale to be maintained. More
      information on customising how StatLogger aggregates data can be found
      below in <a href="#xref_Aggregation_Window_Configuration" title="3.3.4.2.&nbsp;Aggregation Window Configuration">Aggregation Window Configuration</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_StatLogger_Configuration"></a>3.3.4.&nbsp;Configuration</h3></div></div></div><p>Located in StatLogger's directory, the preference file
      <code class="filename">preferences.xml</code> is used to configure the script.
      The preference file can be used to configure:</p><div class="itemizedlist"><ul type="disc"><li><p>Database connection details.</p></li><li><p>Watcher values to collect from processes.</p></li><li><p>Aggregation preferences.</p></li></ul></div><p>Apart from the database user configuration, in most cases the
      provided standard settings should be sufficient for development and
      production environments.</p><p>The preferences.xml file configures database setup options, as
      well as what data StatLogger should collect from the server components
      and machines.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_Option_Configuration"></a>3.3.4.1.&nbsp;Database Connection Details</h4></div></div></div><p>The <span class="literal">&lt;options&gt;</span> section of the
        preferences file contains the following tags:</p><div class="altrow"><table border="1" width="90%"><colgroup><col width="28%"><col width="72%"></colgroup><thead><tr><th>Option Name</th><th>Description</th></tr></thead><tbody><tr><td>dbHost</td><td>Hostname or IP address of the MySQL database server
                that will contain the log databases.</td></tr><tr><td>dbUser</td><td>Database user with which StatLogger (and StatGrapher)
                will access the database. For details on StatGrapher, see
                <a href="#xref_WebConsole_StatGrapher" title="3.1.1.4.&nbsp;StatGrapher">StatGrapher</a>.</td></tr><tr><td>dbPass</td><td>Database user's password.</td></tr><tr><td>dbPort</td><td>Port on which the MySQL server is listening for
                connections.</td></tr><tr><td>dbPrefix</td><td>Prefix of database names which StatLogger can
                accesses.</td></tr><tr><td>sampleTickInterval</td><td>Interval in seconds at which StatLogger will poll the
                components and store statistics (decimals are supported).
                Generally this value does not need to be changed, however if
                it does, then it should not be any smaller than 2 seconds (the
                default recommended value).</td></tr></tbody></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_Aggregation_Window_Configuration"></a>3.3.4.2.&nbsp;Aggregation Window Configuration</h4></div></div></div><p>The <span class="literal">&lt;collect/aggregation/window&gt;</span>
        section configures the aggregation windows that will be stored in the
        database.</p><p>As outlined in <a href="#xref_StatLogger_Data_Collection_And_Aggregation" title="3.3.3.&nbsp;Data Collection and Aggregation">Data Collection and Aggregation</a>,
        StatLogger has been designed to stores multiple versions of data at
        varying levels of detail with the idea is that long term data does not
        need to be stored at the same level of detail as the more recent
        data.</p><p>StatLogger requires at least one aggregation window setting in
        this section with a <span class="literal">samplePeriodTicks</span> value of
        1.</p><p>Multiple aggregation window setting takes the form of:</p><pre class="programlisting">&lt;preferences&gt;
  ...
  &lt;collect&gt;
    &lt;aggregation&gt;
      *&lt;window&gt;
         &lt;samples&gt;           &lt;num_samples_in_this_win&gt;   &lt;/samples&gt;
         &lt;samplePeriodTicks&gt; &lt;num_of_ticks_per_sec&gt;      &lt;/samplePeriodTicks&gt;
       &lt;/window&gt;
      ...</pre><p><span class="citetitle">Multiple aggregation window settings
        (Grammar)</span></p><p>There are some constraints that must be adhered to when creating
        this list of aggregation window settings:</p><div class="itemizedlist"><ul type="disc"><li><p>There must always be an aggregation window with
            samplePeriodTicks value of 1.</p></li><li><p>Aggregation window settings must be ordered in ascending
            order by their samplePeriodTicks value, with the smallest values
            first.</p></li><li><p>Each successive aggregation window should cover a larger
            range of ticks than the previous one. The tick range is calculated
            by multiplying samples value by the samplePeriodTicks value
            (<em class="emphasis">i.e.</em>, number of samples x ticks consolidated
            into one sample).</p></li><li><p>Each successive samplePeriodTicks value must be a multiple
            of the samplePeriodTicks value from the previous window.</p></li></ul></div><p>These aggregation windows are used directly by StatGrapher, so
        it is advised not to have large discrepancies between the
        <span class="literal">samplePeriodTick</span> values of successive aggregation
        windows. Furthermore, the final aggregation window setting should not
        have a large samples value, as this may place a heavy load on both
        StatLogger and StatGrapher.</p><p>An example aggregation section is shown below, with a samples
        value of 365:</p><pre class="programlisting">&lt;preferences&gt;
  ...
  &lt;collect&gt;
    &lt;aggregation&gt;

      &lt;!-- Every sample (2secs) in most recent 24hrs. 43200 samples --&gt;
      &lt;window&gt;
        &lt;samples&gt;           43200 &lt;/samples&gt;
        &lt;samplePeriodTicks&gt; 1     &lt;/samplePeriodTicks&gt;
      &lt;/window&gt;

      &lt;!-- Every 10th sample (20secs) in most recent 48hrs. 8760samples --&gt;
      &lt;window&gt;
        &lt;samples&gt;           8760  &lt;/samples&gt;
        &lt;samplePeriodTicks&gt; 10    &lt;/samplePeriodTicks&gt;
      &lt;/window&gt;

      &lt;!-- Every 150th sample (5mins) in most recent 30 days. 8760 samples --&gt;
      &lt;window&gt;
        &lt;samples&gt;           8760  &lt;/samples&gt;
        &lt;samplePeriodTicks&gt; 150   &lt;/samplePeriodTicks&gt;
      &lt;/window&gt;

      &lt;!-- Every 1800th sample (60mins) in most recent 365 days. 8760 samples --&gt;
      &lt;window&gt;
        &lt;samples&gt;           8760  &lt;/samples&gt;
        &lt;samplePeriodTicks&gt; 1800  &lt;/samplePeriodTicks&gt;
      &lt;/window&gt;

      &lt;!-- Every 43200th sample (1day) in most recent 365 days. 365 samples --&gt;
      &lt;window&gt;
        &lt;samples&gt;           365   &lt;/samples&gt;
        &lt;samplePeriodTicks&gt; 43200 &lt;/samplePeriodTicks&gt;
      &lt;/window&gt;
    &lt;/aggregation&gt;
   ...</pre><p><span class="citetitle">Multiple aggregation window settings
        (Example)</span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e5875"></a>3.3.4.3.&nbsp;Machine Statistic Configuration</h4></div></div></div><p>The <span class="literal">&lt;collect/machineStatisticList&gt;</span>
        section is similar to the <span class="literal">statisticList</span><sup>[<a name="d0e5885" href="#ftn.d0e5885">7</a>]</sup> and <span class="literal">allProcessStatisticList</span><sup>[<a name="d0e5893" href="#ftn.d0e5893">8</a>]</sup> sections, except in that watcher values are not
        supported since machines do not have a Watcher interface. The
        <span class="literal">&lt;valueAt&gt;</span> settings only support strings
        representing members of the <code class="classname">Machine</code> class
        defined in
        <code class="filename">bigworld/tools/server/pycommon/machine.py</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_Generic_Process_Statistic_Configuration"></a>3.3.4.4.&nbsp;Generic Process Statistic Configuration</h4></div></div></div><p>The <span class="literal">&lt;collect/allProcessStatisticList&gt;</span>
        section is similar to the <span class="literal">statisticList</span><sup>[<a name="d0e5918" href="#ftn.d0e5918">9</a>]</sup> section, except that its statistics are regarded as
        common to all processes being monitored <em class="emphasis">i.e.</em>,
        those specified in the <span class="literal">&lt;processList&gt;</span><sup>[<a name="d0e5929" href="#ftn.d0e5929">10</a>]</sup> section.</p><p>It is recommended that any watcher values used in this section
        are supported by all processes being monitored, although StatLogger
        will store empty values for processes that do not support a watcher
        value.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_Process_Configuration"></a>3.3.4.5.&nbsp;Process Configuration</h4></div></div></div><p>The <span class="literal">&lt;collect/processList/process&gt;</span>
        section configures the statistics that will be collected for each
        process. There must be one process section for each server component
        to be monitored.</p><p>The process section contains the following tags:</p><div class="altrow"><table border="1" width="75%"><colgroup><col width="25%"><col width="75%"></colgroup><thead><tr><th>Tag Name</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>Display name for the process type.</td></tr><tr><td>matchtext</td><td>Name of the component type's executable. Value must be
                in lowercase, like the executable names.</td></tr><tr><td>statisticList</td><td>List of statistics to be collected for this process by
                StatLogger<sup>[<a name="d0e5975" href="#ftn.d0e5975">a</a>]</sup>.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="2"><div class="footnote"><p><sup>[<a name="ftn.d0e5975" href="#d0e5975">a</a>] </sup>For details see <a href="#xref_Process_Statistic_Configuration" title="3.3.4.6.&nbsp;Process Statistic Configuration">Process Statistic Configuration</a>.</p></div></td></tr></tbody></table></div><p>An example process section is shown below:</p><pre class="programlisting">&lt;preferences&gt;
  ...
  &lt;collect&gt;
    ...
    &lt;processList&gt;
      &lt;process&gt;
        &lt;name&gt;      CellApp &lt;/name&gt;
        &lt;matchtext&gt; cellapp &lt;/name&gt;
        &lt;statisticList&gt;
          ...
        &lt;/statisticList&gt;
      &lt;/process&gt;
      ...</pre><p><span class="citetitle">Example process configuration</span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_Process_Statistic_Configuration"></a>3.3.4.6.&nbsp;Process Statistic Configuration</h4></div></div></div><p>The
        <span class="literal">&lt;collect/processList/process/statisticList/statistic&gt;</span>
        section specifies the statistics that must be collected for each
        process.</p><p>The statistic section contains the following tags:</p><div class="altrow"><table border="1"><colgroup><col width="25%"><col width="75%"></colgroup><thead><tr><th>Tag Name</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>Display name for the statistic type.</td></tr><tr><td>valueAt</td><td>Where to retrieve the values from. There are two
                distinct sources of information, depending on the first
                character of this tag's value, see the section <a href="#xref_StatLogger_valueAt" title="3.3.4.6.1.&nbsp;valueAt Properties">valueAt Properties</a> for details.</td></tr><tr><td>maxAt</td><td>This value is not explicitly used in StatLogger,
                however it is used by StatGrapher to determine the scale of
                the graph.</td></tr><tr><td>type</td><td>Current unused.</td></tr><tr><td>consolidate</td><td><p>Consolidation function to use when moving data up
                an aggregation window.</p> <p>Possible values are:
                <span class="literal">MAX</span>, <span class="literal">MIN</span>, and
                <span class="literal">AVG</span>.</p> <p><em class="emphasis">Example</em>: We consolidate four data
                samples at 4 seconds per sample into the next aggregation
                window, which stores data at 16 seconds per sample. The data
                represents CPU load consumed by a process. The
                <span class="literal">consolidate</span> value is specified as
                <span class="literal">AVG</span>, so StatLogger averages the four data
                samples, then store this value as a single value in the higher
                aggregation window.</p></td></tr><tr><td>display</td><td>Contains properties that influence the StatGrapher
                display of this statistics.</td></tr></tbody></table></div><p>An example statisticList section is shown below:</p><pre class="programlisting">&lt;preferences&gt;
  ...
  &lt;collect&gt;
    ...
    &lt;processList&gt;
      &lt;process&gt;
        &lt;name&gt;      CellApp &lt;/name&gt;
        &lt;matchtext&gt; cellapp &lt;/name&gt;
        &lt;statisticList&gt;
          &lt;statistic&gt;
            &lt;name&gt;        Cell Load                &lt;/name&gt;
            &lt;valueAt&gt;     /load                    &lt;/valueAt&gt;
            &lt;maxAt&gt;       1.0                      &lt;/maxAt&gt;
            &lt;logicalMax&gt;  None                     &lt;/logicalMax&gt;
            &lt;type&gt;        FLOAT                    &lt;/type&gt;
            &lt;consolidate&gt; AVG                      &lt;/consolidate&gt;
            &lt;display&gt;
              &lt;colour&gt;    #FF6600                  &lt;/colour&gt;
              &lt;show&gt;      true                     &lt;/show&gt;
              &lt;description&gt;      
                  The load of this CellApp.
              &lt;/description&gt;
            &lt;/display&gt;
          &lt;/statistic&gt;
          &lt;statistic&gt;
            &lt;name&gt;        Num Entities Ever        &lt;/name&gt;
            &lt;valueAt&gt;     /stats/totalEntitiesEver &lt;/valueAt&gt;
            &lt;maxAt&gt;       10000.0                  &lt;/maxAt&gt;
            &lt;type&gt;        FLOAT                    &lt;/type&gt;
            &lt;consolidate&gt; MAX                      &lt;/consolidate&gt;
            &lt;display&gt;
              &lt;colour&gt;    #663366                  &lt;/colour&gt;
              &lt;show&gt;      false                    &lt;/show&gt;
              &lt;description&gt;      
                  The number of entities created on the CellApp since server startup.
              &lt;/description&gt;
            &lt;/display&gt;
          &lt;/statistic&gt;
          ...</pre><p><span class="citetitle">Process statistic configuration &#8212;
        Example</span></p><div class="section" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="xref_StatLogger_valueAt"></a>3.3.4.6.1.&nbsp;valueAt Properties</h5></div></div></div><p>The behaviour of the <span class="literal">valueAt</span> tag changes
          based on the first character of the string. If first character is a
          slash '<span class="literal">/</span>' <span class="literal">valueAt</span> will be
          interpreted as a watcher path. The best way to list the watchers
          that can be graphed is via the WebConsole's ClusterControl
          module<sup>[<a name="d0e6086" href="#ftn.d0e6086">11</a>]</sup>.</p><p>Any single scalar value present in ClusterControl can be added
          to StatGrapher, including any customer watcher values added within
          your own game code.</p><p>If the first character is not a slash, the
          <span class="literal">valueAt</span> string is treated as referring to a
          member a <code class="classname">Process</code> class instance as found in
          <code class="filename">bigworld/tools/server/pycommon/process.py</code>.
          Strictly speaking, <span class="literal">valueAt</span> is
          <code class="function">eval</code>'ed against the
          <code class="classname">Process</code> object which enables slightly more
          flexibility than just being able to reference class members.</p><p><em class="emphasis">Examples</em>:</p><div class="altrow"><table border="1" width="80%"><colgroup><col width="28%"><col width="72%"></colgroup><thead><tr><th>valueAt</th><th>Interpretation</th></tr></thead><tbody><tr><td><span class="literal">/stats/numInAoI</span></td><td>Watcher path of <em class="replaceable"><code>&lt;process
                  type&gt;</code></em>:<span class="literal">/stats/numInAoI</span></td></tr><tr><td><span class="literal">mem</span></td><td>Evaluated to
                  <code class="classname">Process</code><code class="varname">.mem</code>, which
                  retrieves the value of memory usage of a process.</td></tr></tbody></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Caution is required with this type of value as it is
            possible to use a function call that changes the state of the
            process (<em class="emphasis">e.g.</em>, causing a process to
            shutdown). It is highly unlikely that this will occur by accident,
            unless the exact function call is entered in the
            <span class="literal">valueAt</span> setting.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6162"></a>3.3.4.7.&nbsp;Further Notes on Configuration</h4></div></div></div><p>The configuration file directly affects the database structure
        used for storing the statistics. If the collect section of the
        configuration file is changed, then StatLogger will detect the change
        when it is next run, and will subsequently create a new statistics
        database from scratch, in order to accommodate the new
        structure.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6167"></a>3.3.5.&nbsp;Database</h3></div></div></div><p>StatLogger uses two active databases during its operation, however
      over an installation's life multiple databases may be created as
      StatLogger options are modified.</p><p>The two active databases required by StatLogger are:</p><div class="orderedlist"><ol type="1"><li><p>Statistics database associated with a unique preference
          configuration.</p></li><li><p>Meta database for tracking all statistic databases known by
          StatLogger.</p></li></ol></div><p>By default, the meta database is named
      <span class="literal">bw_stat_log_info</span> and contains a single table called
      <span class="literal">bw_stat_log_databases</span>. The
      <span class="literal">bw_stat_log_databases</span> table stores the names of all
      the known statistics databases. The meta database is always created if
      it does not exist in the MySQL server.</p><p>The statistics databases by default are named
      <span class="literal">bw_stat_log_data<em class="replaceable"><code>&lt;n&gt;</code></em></span>,
      where <span class="literal"><em class="replaceable"><code>&lt;n&gt;</code></em></span> is the
      incremental database number. Users can choose to create statistics
      databases with specific names using the <code class="option">-n</code> option when
      running StatLogger.</p><p>New statistics databases are created in the following
      situations:</p><div class="itemizedlist"><ul type="disc"><li><p>There are no statistics databases in the MySQL server.</p></li><li><p>The preferences file was structurally changed, which causes a
          new statistic database to be created. For details on the
          <code class="filename">preferences.xml</code> file, see <a href="#xref_StatLogger_Configuration" title="3.3.4.&nbsp;Configuration">Configuration</a>.</p></li><li><p>StatLogger was started with the <code class="option">-n
          <em class="replaceable"><code>&lt;database_name&gt;</code></em></code>
          command-line option, and there was no statistic database with that
          name in the MySQL server.</p></li></ul></div><p>There is typically no need to create new statistics databases
      unless isolated sets of statistics are needed. This may occur when
      performing tests with the BigWorld server. Once StatLogger has been
      configured to suit your environment only one statistics database should
      be needed.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_Statistics_Database_Structure"></a>3.3.5.1.&nbsp;Database Structure</h4></div></div></div><p>Below is an overview of the tables in a statistics database.
        This is intended as a quick reference for locating data within the
        database. For a comprehensive understanding of how the data is used
        the source code is considered to be the best reference.</p><div class="altrow"><table border="1" width="95%"><colgroup><col width="33%"><col width="67%"></colgroup><thead><tr><th>Table Name</th><th>Description</th></tr></thead><tbody><tr><td><span class="literal">pref_processes</span></td><td><p>Process preferences as specified in the
                configuration file's
                <span class="literal">&lt;collect/processList&gt;</span> section. For
                details, see <a href="#xref_Process_Configuration" title="3.3.4.5.&nbsp;Process Configuration">Process Configuration</a>.</p></td></tr><tr><td><span class="literal">pref_statistics</span></td><td>Statistic preferences specified in configuration
                file.</td></tr><tr><td><span class="literal">seen_machines</span></td><td>Machines observed while StatLogger was running.</td></tr><tr><td><span class="literal">seen_processes</span></td><td>Processes observed while StatLogger was
                running.</td></tr><tr><td><span class="literal">seen_users</span></td><td>Users observed while StatLogger was running.</td></tr><tr><td><span class="literal">stat_<em class="replaceable"><code>&lt;proc&gt;</code></em>_lvl_<em class="replaceable"><code>&lt;lvl&gt;</code></em></span></td><td>Statistics collected for processes of type
                <span class="literal"><em class="replaceable"><code>&lt;proc&gt;</code></em></span>,
                with <span class="literal"><em class="replaceable"><code>&lt;lvl&gt;</code></em></span>
                index of aggregation.</td></tr><tr><td><span class="literal">stat_machines_level_<em class="replaceable"><code>&lt;lvl&gt;</code></em></span></td><td>Statistics collected for machines with
                <span class="literal"><em class="replaceable"><code>&lt;lvl&gt;</code></em></span>
                index of aggregation. The higher the aggregation level, the
                lower the resolution of the data being stored in that
                table.</td></tr><tr><td><span class="literal">std_aggregation_windows</span></td><td>Aggregation level details specified in configuration
                file's collect/aggregation section.</td></tr><tr><td><span class="literal">std_info</span></td><td><p><span class="literal">sampleTickInterval</span> specified
                in the configuration file's <span class="literal">&lt;options&gt;</span>
                section. For details, see <a href="#xref_Option_Configuration" title="3.3.4.1.&nbsp;Database Connection Details">Database Connection Details</a>.</p> <p>Database
                structure version (Used internally by
                StatLogger).</p></td></tr><tr><td><span class="literal">std_session_times</span></td><td>Start and end times of when StatLogger was run.</td></tr><tr><td><span class="literal">std_tick_times</span></td><td>Timestamps of the start of each interval.</td></tr><tr><td><span class="literal">std_touch_time</span></td><td><p>The last time the database was written to, in
                database local time.</p> <p>This value is only used by
                StatGrapher regardless of whether StatLogger is currently
                logging to this database or not.</p></td></tr></tbody></table></div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Server_Command_Line_Utilities"></a>3.4.&nbsp;Server Command-Line Utilities</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_control_cluster_py"></a>3.4.1.&nbsp;Control Cluster</h3></div></div></div><p>Location:
      <code class="filename">bigworld/tools/server/control_cluster.py</code></p><p>Control Cluster is a command line tool for managing a BigWorld
      cluster from a text only interface.</p><p>For detailed information on all the available commands, please
      refer to the Control Cluster help by using the <code class="option">--help</code>
      option.</p><pre class="programlisting">$ ./control_cluster.py --help</pre><p>For detailed help information on a specific command simply provide
      the command name after the <code class="option">--help</code> option. For
      example:</p><pre class="programlisting">$ ./control_cluster.py --help getmany
getmany &lt;processes&gt; [watcher-path]

   Queries the specified watcher path on all processes of the specified type
   currently active in the cluster. The path can contain '*' wildcards.</pre><p>Control Cluster provides functionality through a number of
      commands that can be used to interact within a BigWorld server
      environment. The commands can be discussed in terms of four functional
      areas.</p><div class="variablelist"><dl><dt><span class="term">Server Commands</span></dt><dd><p>Commands that operate on an entire server configuration to
            either modify or report its current state. This includes starting
            and stopping a server, saving the current server layout for reuse
            and displaying the current server configuration on the command
            line.</p><p>As server commands require interacting with a specific
            server instance, there is an implied user for performing these
            commands. Unless otherwise specified the user is taken as the
            username of the person running the Control Cluster command. The
            user to perform a command as can be changed if required by using
            the option <code class="option">--user</code>. For example:</p><pre class="programlisting">$ ./control_cluster.py --user bob start</pre></dd><dt><span class="term">Process Commands</span></dt><dd><p>These commands operation on specific server process
            instances. They are used for starting and stopping server
            processes when there is already an active server, as well as
            interacting with an active server process, for example retrieving
            watcher values.</p><p>As with the server commands, the process commands have an
            implied user as they operate on server processes that have an
            associated user ID at runtime. The user you run a command as can
            be modified at any stage by using the <code class="option">--user</code>
            option.</p></dd><dt><span class="term">Profiling Commands</span></dt><dd><p>Profiling commands are used for diagnosing problems on
            server processes. While technically operating in the same way that
            process commands do, they are separated into a unique category to
            highlight their availability and encourage their usage.</p><p>Profiling commands can be used for extracting all manner of
            performance information from server processes including C++
            performance, Python game script performance, client traffic
            performance and intra-process network statistics.</p></dd><dt><span class="term">Cluster Commands</span></dt><dd><p>The cluster commands are different to the server and process
            commands in that there is no implied user for them. These commands
            operate on the entire cluster as represented by every machine in
            the network that has a BWMachined instance running and is
            reachable through broadcasting. Operations such as querying all
            machines in the cluster for their current load and checking the
            validity of the BWMachined ring are included in these
            commands.</p></dd></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6427"></a>3.4.1.1.&nbsp;Machine Selection</h4></div></div></div><p>Many commands require a machine or machines to be provided to
        perform a command on. As commands quite often need to be performed
        across large sets of machines at the same time, Control Cluster
        provide a number of different shorthand notations which can be used
        anywhere a <span class="literal">&lt;machine&gt;</span> or
        <span class="literal">&lt;machines&gt;</span> is requested.</p><p>For example the <code class="option">start</code> command requires a
        machine set to operate on as seen by the <code class="option">help</code>
        output.</p><pre class="programlisting">$ ./control_cluster.py help start
start &lt;machines&gt;

   Start the server on the specified set of machines.  To start the server on
   all machines, you must explicitly pass 'all' for machine selection.</pre><p>The following list outlines the different machine selection
        approaches that can be used.</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">All machines</em></p><p>All machines in the network can be referred to using the
            syntax <span class="literal">all</span>.</p></li><li><p><em class="emphasis">Hostname</em></p><p>An exact hostname such as <span class="literal">bw01</span>,
            <span class="literal">dmz-qa-10</span>.</p></li><li><p><em class="emphasis">IP Address</em></p><p>An exact IPv4 address such as
            <span class="literal">192.168.1.34</span>.</p></li><li><p><em class="emphasis">Hostname Wildcard</em></p><p>A hostname containing a wildcard such as
            <span class="literal">dmz-qa-*</span>. Be aware that depending on the unix
            shell you use (<em class="emphasis">e.g.</em>, bash or zsh) you may
            have to quote the wildcard <span class="literal">*</span>.</p></li><li><p><em class="emphasis">BWMachined Version</em></p><p>BWMachined has a protocol version associated with each
            instance. If you are running multiple versions of BWMachined
            within your network (a practice discouraged by BigWorld), you can
            specify all hosts using a particular BWMachined version using the
            following syntax:
            <span class="literal">version:<em class="replaceable"><code>42</code></em></span> where 42
            in this case refers to protocol version 42.</p></li><li><p><em class="emphasis">BWMachined Groups</em></p><p>Using the <span class="literal">[Groups]</span> tag in
            <code class="filename">/etc/bwmachined.conf</code> to specify different
            groups of machines within your server cluster, it is then possible
            to refer to these groups using the syntax
            <span class="literal">group:<em class="replaceable"><code>groupname</code></em></span>.</p></li></ul></div><p>This information is also available from the command line help by
        using the <code class="option">help</code> command
        <code class="option">machine-selection</code>.</p><pre class="programlisting">$ ./control_cluster.py help machine-selection</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6534"></a>3.4.1.2.&nbsp;Process Selection</h4></div></div></div><p>Similar to machine selection, many commands can operate on
        numerous processes at the same time. For example the
        <code class="option">getmany</code> command can select watcher values from many
        processes to provide a tabular report. In most cases whenever
        <span class="literal">&lt;processes&gt;</span> is seen in the
        <code class="option">help</code> output of a command, you can use one of the
        following approaches for supplying sets of processes.</p><p>The following list outlines the different process naming schemes
        that can be used with commands.</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">All processes</em></p><p>All processes in a server cluster can be referred to using
            the statement <span class="literal">all</span>. This is especially useful in
            relation to watcher commands.</p></li><li><p><em class="emphasis">Process name</em></p><p>An exact process name such as <span class="literal">cellapp01</span>
            or <span class="literal">cellappmgr</span>.</p></li><li><p><em class="emphasis">All processes of a
            type</em></p><p>A set of all process types such as
            <span class="literal">cellapps</span> or <span class="literal">baseapps</span>.</p></li><li><p><em class="emphasis">Single process of a
            type</em></p><p>A process type name such as <span class="literal">cellapp</span> or
            <span class="literal">baseapp</span>. This can be useful when a command can
            be run on any process of the provided type but there may be many
            processes running within the server cluster.</p><p>When using this method of process selection, if there are
            multiple processes of the specified type running, a random process
            of the provided type will be selected.</p></li><li><p><em class="emphasis">Non-zero numbering</em></p><p>An exact process name that would otherwise have zero's
            padding the process id, such as <span class="literal">cellapp1</span> or
            <span class="literal">baseapp9</span>.</p><p>The advantage of this approach is that it allows the user to
            take advantage of shell expansion approaches that are already
            available in different shells such as bash and zsh. For example in
            both bash and zsh using the syntax
            <span class="literal">cellapp{1..3}</span> would expand to <span class="literal">cellapp1
            cellapp2 cellapp3</span>, while <span class="literal">baseapp{1,7}</span>
            would expand to <span class="literal">baseapp1 baseapp7</span>.</p></li></ul></div><p>This information is also available from the command line help by
        using the <code class="option">help</code> command
        <code class="option">process-selection</code>.</p><pre class="programlisting">$ ./control_cluster.py help process-selection</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6634"></a>3.4.2.&nbsp;MessageLogger Related Utilities</h3></div></div></div><p>For details on the tools available for interacting with server
      message logs, see <a href="#xref_Command_Line_Utilities" title="3.2.3.&nbsp;Command Line Utilities">Command Line Utilities</a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Space_Viewer"></a>3.5.&nbsp;Space Viewer</h2></div></div></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/space_viewer_simple_space.png" align="middle"></div></div><p>Location: <code class="filename">bigworld/tools/server/space_viewer</code></p><p>Space Viewer is a program that is used for displaying a dynamic
    graphic representation of spaces. This includes the distribution of cells
    in a space, as well as the entities within each of the cells.</p><p>Space Viewer uses a client / server architecture, and is therefore
    composed of two distinct parts which may be used simultaneously or
    separately. The server component (SVLogger) either communicates with an
    active BigWorld server to collect and log information about a space, or is
    used to read a previously collected log. The client component
    (SpaceViewer) connects to the server process and uses a GUI to display the
    space information provided to it.</p><p>For comprehensive documentation on Space Viewer's options and
    contextual help, please refer to the <code class="option">--help</code> output along
    with the application help available from the <span class="guimenu">Help</span>
    menu.</p><p>Since the two halves of Space Viewer communicate via TCP, they can
    be run on different machines, although the client is most responsive when
    both components are run on the same machine.</p><p>The most common use of Space Viewer is to monitor the state of a
    live BigWorld server, and as such, both the client and server components
    are run in tandem. This can be achieved by simply running the SpaceViewer
    script (<code class="filename">space_viewer.py</code>) when logged in to a GUI
    session on either Windows or Linux.</p><p>Other scenarios such as during scalability testing require running
    the server component as a separate process. This allows collecting space
    data over long periods of time without requiring an attached GUI session.
	In order to achieve this simply run the SVLogger script
    (<code class="filename">svlogger.py</code>) from a Linux command line console. The
    SpaceViewer GUI can be attached to the server process at any stage by
    using the <code class="option">--connect</code> option of SpaceViewer. For more
    information on remote monitoring using Space Viewer, see <a href="#xref_Running_Space_Viewer_Remotely" title="3.5.4.&nbsp;Running Space Viewer Remotely">Running Space Viewer Remotely</a>.</p><p>The following image illustrates a number of users with active
    servers within the same network cluster. The <span class="literal">dominicw</span>
    user has been expanded to show all spaces that are active within that
    server.</p><div class="informalfigure"><div class="mediaobject"><img src="images/space_viewer_window.png"><span class="caption"><p>Space Viewer window</p></span></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6693"></a>3.5.1.&nbsp;Selecting Spaces to View</h3></div></div></div><p>When running SpaceViewer if you do not see your username listed in
      the main Space Viewer window, select the <em class="emphasis">File
      <span class="symbol">&#8594;</span> Refresh</em> menu item. This
      is sometimes required as the list is not automatically updated.</p><p>Clicking the arrow icon to the left of user name expands the list
      to display all spaces available for that server instance.</p><p>In the example above, the <span class="literal">dominicw</span> server has 4
      spaces. To view the top down map of a space, double click its entry on
      the list. This will start an SVLogger process which will log data from
      the selected space as well as a new client window that attaches itself
      to the logger. Closing the client window will cause the logger to
      terminate.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6711"></a>3.5.2.&nbsp;Viewing Spaces</h3></div></div></div><p>Multiple spaces can be viewed simultaneously, each in their own
      window. To view a space, double-click its entry on the space list
      displayed in Space Viewer.</p><p>The image below shows a space being managed by five cells. Cell 2
      is currently selected as can be seen by the thick blue border and
      coloured circles representing all the entities within the cell. Entities
      that are being ghosted on cell 2 are displayed as greyed out
      circles.</p><p>Upon first loading the space window no cell is selected for
      viewing. The cell boundaries and the cell information (cell number, IP
      address, load) will always be shown, however to see the entities within
      a particular cell, as with cell 2 in the screenshot below, it must be
      selected with a single click.</p><div class="informalfigure"><div class="mediaobject"><img src="images/space_viewer_window_explained.png"><span class="caption"><p>Space window</p></span></div></div><p>In order to facilitate identification of entities, tooltip
      information is available for all non-ghosted entities. This information
      will appear if the cursor hovers over an entity marker for a
      sufficiently long time.</p><div class="informalfigure"><div class="mediaobject"><img src="images/entity_tooltip.png"><span class="caption"><p>Entity tooltip</p></span></div></div><p>The entity type name is retrieved from file
      <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/entities.xml</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Customising_Entity_And_Display_Colours"></a>3.5.3.&nbsp;Customising Entity and Display Colours</h3></div></div></div><p>Space Viewer allows you to customise the colours to be used when
      drawing the elements in the Space window. Any customisation is not saved
      and thus will not be in effect the next time the application is started.
      If you desire to permanently change the colours, this can be achieved by
      customising the Space Viewer source code.</p><p>Entities in the current cell are displayed with a coloured circle.
      The colour can be customised in the file
      <code class="filename">bigworld/tools/server/space_viewer/style.py</code>. The
      simplest way to modify the colours is to update the dictionary colours
      which contain RGB colour definitions for each entity type.</p><p>The code fragment below illustrates the definition of permanent
      entity colours:</p><pre class="programlisting"># specify colour for specific entity types.
ENTITY_COLOURS = {
    "Avatar"  : ((111, 114, 247), 2.0), <img src="images/rgb_111_114_247.png">
    "Guard"   : ((244, 111, 247), 1.0), <img src="images/rgb_244_111_247.png">
    "Creature": ((124, 247, 111), 1.0), <img src="images/rgb_124_247_111.png">
    "Merchant": ((114, 241, 244), 1.0)  <img src="images/rgb_114_241_244.png">
}</pre><p><span class="citetitle">Example local file
      <code class="filename">style.py</code></span></p><p>An alternate approach would be to replace the entire function
      <code class="methodname">getColourForEntity( entityID, entityTypeID )</code>,
      using your own algorithm to colour the entities.</p><p>All other colours are defined by the dictionary
      <code class="varname">colourOptions</code>. This dictionary can be modified to any
      of the colours defined by the colours array.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Running_Space_Viewer_Remotely"></a>3.5.4.&nbsp;Running Space Viewer Remotely</h3></div></div></div><p>As described at the start of this section, Space Viewer's two
      components can be run separately if required. This would usually take
      the form of running SVLogger over an extended period of time, connecting
      clients to it to monitor live state as necessary, then eventually
      shutting down the logger. Later, SVLogger can be connected to its
      previously recorded log (instead of a live server) and client windows
      can be attached to it to replay the log data.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e6793"></a>3.5.4.1.&nbsp;SVLogger</h4></div></div></div><p>Location:
        <code class="filename">bigworld/tools/server/space_viewer/svlogger.py</code></p><p>The SVLogger script provides log writing and reading
        functionality for Space Viewer. In writing mode it is responsible for
        gathering the space data from a running BigWorld server which is
        achieved by polling the CellAppMgr approximately every second. In
        reading mode a previously recorded log is opened for replay using any
        client connections.</p><p>When run without any options SVLogger will default to placing
        logs into <code class="filename">/tmp/svlog-<em class="replaceable"><code>username</code></em></code>.
        This location can be changed for keeping a more permanent archive of
        logs by using the <code class="option">-o</code> option. For example:</p><pre class="programlisting">$ ./svlogger -o /home/alice/space_logs</pre><p>For a comprehensive list of options available for SVLogger
        please refer to the command line help available from the
        <code class="option">--help</code> option.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="xref_Connecting_A_Client_Window_To_svlogger"></a>3.5.4.2.&nbsp;Connecting a Space Viewer Window to SVLogger</h4></div></div></div><p>Once you have started SVLogger manually, you will need to
        manually connect Space Viewer client windows to the logger if you wish
        to view its space data. This is easily done by running Space Viewer
        with the <code class="option">--connect
        <em class="replaceable"><code>&lt;ip:port&gt;</code></em></code> option. For
        example:</p><pre class="programlisting">$ ./space_viewer --connect 192.168.1.24:20110</pre><p>The address passed to this option should be the address that
        SVLogger is listening for connections on, which should be displayed in
        the initial output from after SVLogger starts.</p></div></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e5068" href="#d0e5068">4</a>] </sup>For details see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_tools_installation_guide/server_tools_installation_guide.html#Server_Tools_Installation_Guide" class="olink">Server Tools Installation Guide</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_tools_installation_guide/server_tools_installation_guide.html#xref_ServerTools_Post_Installation" class="olink"><i>Post-installation</i></a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e5658" href="#d0e5658">5</a>] </sup>For details, see <a href="#xref_WebConsole_StatGrapher" title="3.1.1.4.&nbsp;StatGrapher">StatGrapher</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e5707" href="#d0e5707">6</a>] </sup>For details, see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_tools_installation_guide/server_tools_installation_guide.html#Server_Tools_Installation_Guide" class="olink">Server Tools Installation Guide</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e5885" href="#d0e5885">7</a>] </sup>For details see <a href="#xref_Process_Statistic_Configuration" title="3.3.4.6.&nbsp;Process Statistic Configuration">Process Statistic Configuration</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e5893" href="#d0e5893">8</a>] </sup>For details see <a href="#xref_Generic_Process_Statistic_Configuration" title="3.3.4.4.&nbsp;Generic Process Statistic Configuration">Generic Process Statistic Configuration</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e5918" href="#d0e5918">9</a>] </sup>For details see <a href="#xref_Process_Statistic_Configuration" title="3.3.4.6.&nbsp;Process Statistic Configuration">Process Statistic Configuration</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e5929" href="#d0e5929">10</a>] </sup>For details see <a href="#xref_Process_Configuration" title="3.3.4.5.&nbsp;Process Configuration">Process Configuration</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e6086" href="#d0e6086">11</a>] </sup>For details see <a href="#xref_WebConsole_ClusterControl" title="3.1.1.1.&nbsp;ClusterControl">ClusterControl</a>.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Fault_Tolerance"></a>Chapter&nbsp;4.&nbsp;Fault Tolerance</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#xref_CellApp_Fault_Tolerance">4.1. CellApp Fault Tolerance</a></span></dt><dt><span class="section"><a href="#xref_BaseApp_Fault_Tolerance">4.2. BaseApp Fault Tolerance</a></span></dt><dt><span class="section"><a href="#xref_Fault_Tolerance_With_Reviver">4.3. Fault Tolerance with Reviver</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_Specifying_Components_To_Support">4.3.1. Specifying Components to Support</a></span></dt><dt><span class="section"><a href="#xref_Reviver_Layout">4.3.2. Recommended Reviver Layout</a></span></dt><dt><span class="section"><a href="#xref_Command_Line_Options">4.3.3. Command-Line Options</a></span></dt></dl></dd></dl></div><p>The Fault Tolerance system in BigWorld Technology is designed to
  transparently cope with the loss of a machine due to physical, electrical,
  or logical fault.</p><p>The game systems in general should not be affected, and the game
  experience will continue normally for most clients, with possibly a brief
  interruption for clients closest to the faulty machine.</p><p>The loss of any single machine (running a single process) is always
  handled. The loss of multiple machines in a short time frame may not always
  be adequately handled. In such extreme cases &#8212; for example, a complete
  power outage affecting all machines &#8212; the Disaster Recovery system
  will be invoked. For more details, see <a href="#xref_Disaster_Recovery" title="5.1.&nbsp;Disaster Recovery">Disaster Recovery</a>.</p><p>Note that, in spite of handling failures, the Fault Tolerance system
  should not be relied upon to cover up a software bug that causes a component
  to crash. All such bugs should be found and fixed in the source code. If the
  bug is believed to be in BigWorld Technology code (and not in a customer's
  extension), then contact BigWorld Support with details of the problem. For
  more details, see <a href="#xref_First_Aid_After_Crash" title="Chapter&nbsp;13.&nbsp;First Aid After a Crash"><i xmlns:xlink="http://www.w3.org/1999/xlink">First Aid After a Crash</i></a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_CellApp_Fault_Tolerance"></a>4.1.&nbsp;CellApp Fault Tolerance</h2></div></div></div><p>CellApp fault tolerance works by backing up the cell entities to
    their base entities.</p><p>As long as a backup period is specified for the cell entities, the
    fault tolerance for the CellApp processes is automatic. An operator should
    ensure that there is enough spare capacity in available CellApps to take
    up the load of a lost process.</p><p>For details on how to specify the CellApp backup period, see <a href="#xref_CellApp_Configuration_Options" title="2.12.&nbsp;CellApp Configuration Options">CellApp Configuration Options</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Cell entities without a base entity are not backed up, and
      therefore will not be restored if their process is lost.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Since cell entities back up to base entities, running CellApp and
      BaseApp processes on the same machine should be avoided. If the entire
      machine is lost, this level of fault tolerance will not work.</p></div><p>For more details on the implementation of CellApp fault tolerance on
    code level, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Fault_Tolerance" class="olink"><i>Fault Tolerance</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_BaseApp_Fault_Tolerance"></a>4.2.&nbsp;BaseApp Fault Tolerance</h2></div></div></div><p>The BaseApp supports a BaseApp level fault-tolerance by backing each
    base entity to another BaseApp via a hashing scheme.</p><p>For more details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a><span class="symbol">&#8594;</span>
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components_BaseApp" class="olink">BaseApp</a><span class="symbol">&#8594;</span><a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components_BaseApp" class="olink">BaseApp</a>. For details on the
    implementation of BaseApp fault tolerance on code level, see the document
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Fault_Tolerance" class="olink"><i>Fault Tolerance</i></a>.</p><p>Each BaseApp is assigned a set of other BaseApps and a hash function
    from an entity's ID to one of these backups. Over a period of time, all
    entities are backed up. This is then repeated. If a BaseApp dies, then the
    entities are restored on to the appropriate backup.</p><p>There is a possibility of base entities that were previously on the
    same BaseApp ending up on different BaseApps (which places limits on
    scripting).</p><p>In addition, any attached clients will be disconnected on an
    unexpected BaseApp failure, requiring a re-login. However, if BaseApps are
    retired, attached clients will be migrated to another running
    BaseApp.</p><div class="informalfigure"><div class="mediaobject"><img src="images/distributed_baseapp_backup.png"><span class="caption"><p>Distributed BaseApp Backup &#8212; Dead BaseApp's
        entities can be restored to Backup BaseApp</p></span></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Fault_Tolerance_With_Reviver"></a>4.3.&nbsp;Fault Tolerance with Reviver</h2></div></div></div><p>Fault tolerance for BaseAppMgr, CellAppMgr, DBMgr, and LoginApp is
    provided by the Reviver, by starting a new instance of the process to
    replace the unavailable one.</p><p>Although it is possible for one Reviver to watch all processes, it
    is recommended to run a multiple Reviver instances on different machines
    as Revivers normally stop after reviving a process.</p><p>For more details on Reviver, see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s chapters <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Design_Introduction" class="olink"><i>Design Introduction</i></a> and
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Specifying_Components_To_Support"></a>4.3.1.&nbsp;Specifying Components to Support</h3></div></div></div><p>When the Reviver starts, it queries the local BWMachined process,
      and will only support the components that have an entry in a special
      category called <span class="literal">Components</span> in the machine's
      configuration file <code class="filename">/etc/bwmachined.conf</code>.</p><p>An example <code class="filename">/etc/bwmachined.conf</code> specifying
      that the Reviver should support all singleton server components would
      contain a section as below:</p><pre class="programlisting">[Components]
baseApp
baseAppMgr
cellApp
cellAppMgr
dbMgr
loginApp</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If the <span class="literal">[Components]</span> category does not contain
        any entries, then Reviver will support all singleton server
        components.</p><p>BaseApp and CellApp will not be restarted by Reviver &#8212; the
        <span class="literal">[Components]</span> entries are used by WebConsole and
        <span class="literal">control_cluster.py</span> to determine which processes
        should be started by BWMachined on that host.</p></div><p>Be aware that the configuration file is only read when BWMachined
      starts. As such if you many any changes to the configuration file, you
      will need to restart BWMachined before the changes are recognised. To
      restart BWMachined run the following command as the root user:</p><pre class="programlisting"># /etc/init.t/bwmachined2 restart</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Reviver_Layout"></a>4.3.2.&nbsp;Recommended Reviver Layout</h3></div></div></div><p>As a Reviver process is responsible for restarting a dead server
      process as a once off task before shutting down, a mis-configured
      Reviver layout may result in a situation where your cluster can suffer a
      process outage that is not handled by the available Revivers.</p><p>As a worst case scenario consider a server cluster that hosts the
      BaseAppMgr and CellAppMgr processes on a machine with the hostname
      <span class="literal">gameworld</span> and a single Reviver process on a backup
      machine with the hostname <span class="literal">gamereviver</span>. If the machine
      <span class="literal">gamereviver</span> has been configured to revive both the
      BaseAppMgr and CellAppMgr processes and <span class="literal">gameworld</span>
      suffers a power failure, only one process will be revived on
      <span class="literal">gamereviver</span>.</p><p>For this reason BigWorld recommends that you run enough Reviver
      instances so that each process is responsible for one singleton process.
      Using this approach should result in fault tolerance layout that avoids
      gaps in your cluster revival plan.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Command_Line_Options"></a>4.3.3.&nbsp;Command-Line Options</h3></div></div></div><p>The supported components can also be specified via command-line
      (even though we recommend that you use
      <span class="literal">/etc/bwmachined.conf</span> for that), as below:</p><pre class="programlisting">reviver [--add|--del {baseAppMgr|cellAppMgr|dbMgr|loginApp} ]</pre><p>If reviver is invoked with no options, then it will try to monitor
      all singleton processes specified in category
      <span class="literal">Components</span> of
      <span class="literal">/etc/bwmachined.conf</span>.</p><p>The options for invoking reviver are described in the list
      below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">--add { baseAppMgr | cellAppMgr
          | dbMgr | loginApp }</span></em></p><p>Starts the Reviver, trying to monitor only the components
          specified in this option. That means that the components list in
          <span class="literal">/etc/bwmachined.conf</span> will be ignored.</p></li><li><p><em class="emphasis"><span class="literal">--del { baseAppMgr | cellAppMgr
          | dbMgr | loginApp }</span></em></p><p>Starts the Reviver, trying to monitor all components specified
          in the list in <span class="literal">/etc/bwmachined.conf</span>, except the
          ones specified in this option.</p></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">To start Reviver trying to monitor all
          processes specified in Components in
          /etc/bwmachined.conf:</em></p><pre class="programlisting">reviver</pre></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">To start Reviver trying to monitor only
          DBMgr and LoginApp:</em></p><pre class="programlisting">reviver --add dbMgr --add loginApp</pre></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">To start Reviver trying to monitor all
          processes specified in Components in
          <code class="filename">/etc/bwmachined.conf</code>, except DBMgr and
          LoginApp:</em></p><pre class="programlisting">reviver -del dbMgr -del loginApp</pre></li></ul></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Backups_And_Disaster_Recovery"></a>Chapter&nbsp;5.&nbsp;Backups and Disaster Recovery</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#xref_Disaster_Recovery">5.1. Disaster Recovery</a></span></dt><dt><span class="section"><a href="#xref_Database_Snapshot_Tool">5.2. Database Snapshot Tool</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7097">5.2.1. Operational Behaviour</a></span></dt><dt><span class="section"><a href="#d0e7130">5.2.2. Usage</a></span></dt><dt><span class="section"><a href="#xref_Snapshot_Tool_Requirements">5.2.3. Requirements</a></span></dt><dt><span class="section"><a href="#xref_Partitioning">5.2.4. Partitioning</a></span></dt><dt><span class="section"><a href="#xref_Snapshot_Tool_Configuration">5.2.5. Configuration</a></span></dt><dt><span class="section"><a href="#d0e7540">5.2.6. Restoring From a Snapshot</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Data_Consolidation_Tool">5.3. Data Consolidation Tool</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_Skipping_Data_Consolidation">5.3.1. Skipping Data Consolidation</a></span></dt><dt><span class="section"><a href="#xref_Ignoring_SQLite_Errors">5.3.2. Ignoring SQLite Errors</a></span></dt></dl></dd></dl></div><p>BigWorld Technology's fault tolerance ensures that the server
  continues to operate if a single process is lost. The server also provides a
  second level of fault tolerance known as disaster recovery that comes into
  play when multiple server components fail at once and the server needs to be
  shut down.</p><p>For additional protection against exploits or bugs the database should
  be backed up regularly. The snapshot tool facilitates making backups of the
  database.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Disaster_Recovery"></a>5.1.&nbsp;Disaster Recovery</h2></div></div></div><p>The server's state can be written periodically to the database. In
    case the entire server fails, then it can be restarted using this
    information. To enable the periodic archiving of entities, an archive
    period needs to be set via the configuration option
    <code class="property">&lt;archivePeriod&gt;</code> for BaseApp and CellAppMgr
    processes. For more details, see <a href="#xref_BaseApp_Configuration_Options" title="2.9.&nbsp;BaseApp Configuration Options">BaseApp Configuration Options</a>, and <a href="#xref_CellAppMgr_Configuration_Options" title="2.13.&nbsp;CellAppMgr Configuration Options">CellAppMgr Configuration Options</a>.</p><p>Disaster recovery only works when the underlying database being used
    is MySQL, the XML database should not be used in mission critical
    environments. See <a href="#xref_DBMgr_MySQL_Support" title="Chapter&nbsp;11.&nbsp;MySQL Support"><i xmlns:xlink="http://www.w3.org/1999/xlink">MySQL Support</i></a> for more
    information on how to enable MySQL database support in BigWorld.</p><p>Starting the server using recovery information from the database is
    the same as starting it from a controlled shutdown. For more details on
    controlled shutdowns see <a href="#xref_Controlled_Startup_And_Shutdown" title="Chapter&nbsp;6.&nbsp;Controlled Startup and Shutdown"><i xmlns:xlink="http://www.w3.org/1999/xlink">Controlled Startup and Shutdown</i></a>.</p><p>For details on the scripting API related to disaster recovery, see
    the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Disaster_Recovery" class="olink"><i>Disaster Recovery</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Database_Snapshot_Tool"></a>5.2.&nbsp;Database Snapshot Tool</h2></div></div></div><p>When using <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Secondary_Databases" class="olink">Secondary Databases</a>, it is necessary to snapshot all
    data sources at the same time to attempt to provide a cohesive data set
    that can be restored from. For background information on the need for the
    snapshot tool see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Database_Snapshot" class="olink">Database Snapshot</a>.</p><p>The snapshot tool is a Python script that facilitates making a
    backup copy of the database that combines information from the primary
    database and secondary databases. The script itself is located in
    <code class="filename">bigworld/tools/server/snapshot/</code>.</p><p>When running the snapshot tool a separate machine should be used to
    invoke the script to avoid interfering with the normal operation of the
    server. The snapshot tool can use a significant amount of CPU and disk
    resources and does so erratically. Henceforth the machine running the
    snapshot tool will be referred to as the snapshot machine.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7097"></a>5.2.1.&nbsp;Operational Behaviour</h3></div></div></div><p>The snapshot tool performs the following sequence of
      operations:</p><div class="orderedlist"><ol type="1"><li><p>TransferDB
          (<code class="filename">bigworld/bin/Hybrid64/commands/transfer_db</code>) is
          executed on each BaseApp.</p><p>TransferDB performs a snapshot of the secondary database and
          sends the newly created snapshot back to the snapshot machine using
          Rsync.</p></li><li><p>TransferDB is executed on the primary database's MySQL
          server.</p><p>TransferDB performs an LVM snapshot of the primary database
          and sends the newly created snapshot back to the snapshot machine
          using Rsync.</p></li><li><p>A MySQL server is started on the snapshot machine and
          specifies its data directory to be the copy of the primary
          database.</p></li><li><p>Data consolidation is performed on the snapshot copies of the
          primary and secondary databases.</p></li><li><p>An archive is created of the consolidated snapshot.</p></li></ol></div><p>The snapshot tool logs all messages to MessageLogger.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>A snapshot should be considered invalid if an error occurs
        during any phase of the snapshot procedure.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7130"></a>5.2.2.&nbsp;Usage</h3></div></div></div><p>The snapshot tool requires a single command-line argument
      specifying the directory the snapshot will be written to, and may also
      be provided options if required. Options available to the snapshot tool
      are described in the <code class="option">--help</code> as listed below:</p><pre class="programlisting">Usage: snapshot.py [<span class="optional">[options]</span>] <em class="replaceable"><code>SNAPSHOT_DIR</code></em>

Options:
  -h, --help            show this help message and exit
  -b BWLIMIT_KBPS, --bwlimit-kbps=BWLIMIT_KBPS
                        file transfer bandwidth limit in kbps, default is unlimited
  -n, --no-consolidate  skip consolidation, default is false</pre><p>The list below provides some common examples of using the snapshot
      tool:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span><strong class="command">snapshot.py
          /home/bwtools/snapshots</strong></span></em></p><p>Takes a snapshot. The snapshot is archived to<code class="filename">/home/bwtools/snapshots</code>.</p></li><li><p><em class="emphasis"><span><strong class="command">snapshot.py
          /home/bwtools/snapshots
          --bwlimit-kbps=5000</strong></span></em></p><p>Takes a snapshot. The snapshot is archived to<code class="filename">/home/bwtools/snapshots</code>. Each secondary
          and primary database is transferred with a 5000 kbps bandwidth
          limit.</p></li><li><p><em class="emphasis"><span><strong class="command">snapshot.py
          /home/bwtools/snapshots --no-consolidate</strong></span></em></p><p>Takes a snapshot. The unconsolidated snapshot is archived
          to<code class="filename">/home/bwtools/snapshots</code>.</p></li><li><p><em class="emphasis"><span><strong class="command">snapshot.py
          /home/bwtools/snapshots -n -b5000</strong></span></em></p><p>Takes a snapshot. The unconsolidated snapshot is archived
          to<code class="filename">/home/bwtools/snapshots</code>.
          Each secondary and primary database is transferred with a 5000 kbps
          bandwidth limit.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Snapshot_Tool_Requirements"></a>5.2.3.&nbsp;Requirements</h3></div></div></div><p>For the snapshot tool to work, the following conditions must be
      met:</p><div class="itemizedlist"><ul type="disc"><li><p>Secondary databases must be enabled.</p><p>To enable secondary databases set the
          <code class="property">baseApp/secondaryDB/enable</code> property to
          <span class="literal">true</span>. See <a href="#xref_BaseApp_Secondary_Database_Configuration_Options" title="2.9.1.&nbsp;Secondary Database Configuration Options">Secondary Database Configuration Options</a>
          for details.</p></li><li><p>The primary database is stored on an LVM volume and there is
          sufficient unpartitioned space on the primary database machine to
          perform an LVM snapshot. Note that, for the purposes of database
          snapshotting, no other cluster machine is required to have spare
          unpartitioned space on a LVM partition. See also <a xmlns:xlink="http://www.w3.org/1999/xlink" href="server_operations_guide.html#xref_Partitioning" class="olink">Partitioning</a>.</p></li><li><p>BWMachined must be running on the primary database
          machine.</p><p>For background information see <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#Server_Overview" class="olink">Server Overview</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_Server_Components" class="olink"><i>Server Components</i></a><span class="symbol">&#8594;</span><a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_overview/server_overview.html#xref_BWMachined" class="olink">BWMachined</a>.</p></li><li><p>All the entity scripts and entity definition files must be
          present and locatable on the snapshot machine.</p><p>In order for the resource tree to be found the BWMachined
          configuration file (<code class="filename">.bwmachined.conf</code>) must be
          configured correctly for the user running the snapshot tool.</p></li><li><p>The snapshot section in
          <code class="filename">/etc/bigworld.conf</code> must be configured correctly
          on the primary database machine.</p><p>See <a href="#xref_Snapshot_Tool_Configuration" title="5.2.5.&nbsp;Configuration">Configuration</a>.</p></li><li><p>The directory the LVM volume is to be mounted to exists and
          has no other devices mounted to it.</p></li><li><p>The user performing the snapshot must be able to connect to
          the snapshot machine using <span><strong class="command">ssh</strong></span> from the primary
          database machine and BaseApp machines without a password.</p><p>For a user whose <code class="envar">$HOME</code> directory is shared
          between machines (e.g, using NFS) this can be done using the
          following commands:</p><pre class="programlisting">$ ssh-keygen -t dsa
$ cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</pre></li><li><p>The LVM userland program suite must be installed and
          accessible by the snapshot user on the primary database
          machine.</p><p>The LVM userland applications can be installed under CentOS
          using the command:</p><pre class="programlisting"># yum install lvm2</pre><p>By default the tools are installed into
          <code class="filename">/usr/sbin</code>, so it might be necessary to modify
          the snapshot user's environment settings to at this directory to the
          <code class="envar">$PATH</code>.</p><p>You can do this by adding to the PATH environment variable in
          the
          <code class="filename"><em class="replaceable"><code>$(HOME)</code></em>/.bash_profile</code>
          file, by adding a line such as this:</p><pre class="programlisting">export PATH=$PATH:/usr/sbin</pre><p>You will need to logout and log back in for this change to
          take effect.</p></li><li><p>The following standard system applications must also be
          accessible by the snapshot user. <span><strong class="command">mount</strong></span>,
          <span><strong class="command">umount</strong></span> and <span><strong class="command">chmod</strong></span>.</p></li><li><p>MySQL server must be installed on the snapshot machine.
          Specifically <span><strong class="command">mysqld_multi</strong></span> must be
          accessible.</p><p>To install the MySQL server binaries, run the following
          command as root:</p><pre class="programlisting"># yum install mysql-server</pre></li><li><p>Rsync must be installed and be on the path of all machines
          being used, i.e, the snapshot machine, the primary database machine
          as well as all the BaseApp machines.</p><p>To install Rsync run the following command as root:</p><pre class="programlisting"># yum install rsync</pre></li><li><p>The SnapshotHelper utility must be built.</p><p>To build the SnapshotHelper binary, MySQL development files
          must be installed. See <a href="#xref_Compiling_DBMgr_With_MySQL_Support" title="11.1.&nbsp;Compiling DBMgr with MySQL Support">Compiling DBMgr with MySQL Support</a> for details on
          how to install MySQL development files.</p><p>After installing MySQL development files, issue the
          <span><strong class="command">make</strong></span> command from within the <code class="filename">bigworld/src/server/tools/snapshot_helper/</code>
          directory.</p><pre class="programlisting">$ cd bigworld/src/server/tools/snapshot_helper
$ make</pre></li><li><p>The SnapshotHelper binary must have its setuid attribute set
          so user ID is root upon execution on the primary database
          machine.</p><p>To make the SnapshotHelper binary setuid root run the
          following commands as the root user:</p><pre class="programlisting"># chown root:root $MF_ROOT/bigworld/tools/server/bin/Hybrid[<span class="optional">64</span>]/snapshot_helper
# chmod 4511 $MF_ROOT/bigworld/tools/server/bin/Hybrid[<span class="optional">64</span>]/snapshot_helper</pre></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For security purposes all privileged commands
        (<span><strong class="command">lvcreate</strong></span>, <span><strong class="command">lvremove</strong></span>,
        <span><strong class="command">mount</strong></span>, <span><strong class="command">unmount</strong></span> and
        <span><strong class="command">chmod</strong></span>) are invoked via
        <span><strong class="command">snapshot_helper</strong></span> which reads command arguments from
        the trusted file <code class="filename">/etc/bigworld.conf</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Partitioning"></a>5.2.4.&nbsp;Partitioning</h3></div></div></div><p>The snapshot tool requires that you have unallocated space on the
      LVM logical disk that your MySQL database resides on. As a
      rule-of-thumb, we recommend that the size of the unallocated space be
      15-20% of the overall volume's size. Having too little space will cause
      the snapshot tool to fail.</p><p>Unallocated space can be added when partitioning the disks of a
      machine hosting MySQL. The steps below illustrate how to add a region of
      unallocated space for snapshotting, in addition to a swap partition and
      a file system partition.</p><div class="itemizedlist"><ul type="disc"><li><p>In the disk partitioning step, choose <span class="literal">Create custom
          layout</span>.</p></li><li><p>Select the LVM <span class="literal">group VolGroup00</span> that is
          created by default, and click on the <span class="literal">Edit</span>
          button.</p></li><li><p>Select each of the <span class="literal">LogVol00</span> and
          <span class="literal">LogVol01</span>, and delete them. You may wish to take
          note of the size of the swap partition
          (<span class="literal">LogVol01</span>), and reuse this size when recreating
          the swap partition.</p></li><li><p>Add a new logical volume by clicking on the
          <span class="literal">Add</span> button. The mount point should be
          <code class="code">/</code>, and we recommend you leave the default filesystem as
          <span class="literal">ext3</span>. The size should be 80-85% of the overall
          size of the volume group, less the space allocated for swap. In the
          example illustrated in the image below, we have allocated split a
          12160MB drive into 1984MB to be unallocated, 1024MB for swap, and
          9152MB for the <span class="literal">/</span> mount which will hold the file
          system.</p></li></ul></div><div class="informalfigure"><div class="mediaobject"><img src="images/lvm_partitioning.png"><span class="caption"><p>LVM partitioning setup</p></span></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Snapshot_Tool_Configuration"></a>5.2.5.&nbsp;Configuration</h3></div></div></div><p>The snapshot tool behaviour can be be configured using the file
      <code class="filename">/etc/bigworld.conf</code>.</p><p>Options for the snapshot tool must be placed within a [snapshot]
      section. Below is a list of valid keywords that can be used in the
      configuration file:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><code class="property">datadir</code></em></p><p>The primary database's data directory. By default for CentOS
          distributions this is <code class="filename">/var/lib/mysql</code>.</p><p>This should be the same value as found in the MySQL
          configuration file <code class="filename">/etc/my.cnf</code>.</p><pre class="programlisting">$ cat /etc/my.cnf
[mysqld]
datadir=/var/lib/mysql
...</pre></li><li><p><em class="emphasis"><code class="property">lvgroup</code></em></p><p>The name of the LVM volume group in which the primary database
          belongs to.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The LVM snapshot that is created will belong to this LVM
            group.</p></div></li><li><p><em class="emphasis"><code class="property">lvorigin</code></em></p><p>The name of the origin LVM volume snapshotted. The MySQL data
          directory should be on this volume.</p></li><li><p><em class="emphasis"><code class="property">lvsnapshot</code></em></p><p>The name of the LVM snapshot volume that will be created and
          deleted by the snapshot tool.</p><p>For example, if <em class="replaceable"><code>lvgroup</code></em> is
          <span class="literal">VolGroup00</span> and
          <em class="replaceable"><code>lvsnapshot</code></em> is
          <span class="literal">ExampleSnapshotVolume</span>, a new volume device will
          be created called <code class="filename">/dev/VolGroup00/ExampleSnapshotVolume</code>.</p><p>The snapshot name is also used to mount the snapshot volume
          device onto the active filesystem. Using the previous example the
          following mount command will be issued:</p><pre class="programlisting">mount /dev/VolGroup00/ExampleSnapshotVolume  /mnt/ExampleSnapshotVolume</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The mount point
            <code class="filename">/mnt/<em class="replaceable"><code>lvsnapshot</code></em></code> is
            assumed to already exist on the system prior to snapshots being
            created.</p></div></li><li><p><em class="emphasis"><code class="property">lvsizegb</code></em></p><p>The size of the LVM snapshot volume in gigabytes. The snapshot
          does not need the same amount of storage the origin has as only the
          modified files are copied, in a typical scenario, 15-20% might be
          enough. If the LVM snapshot volume becomes full it will be dropped,
          so it is important to allocate enough space.</p></li></ul></div><p>Below is an example <code class="filename">/etc/bigworld.conf</code>
      configuration file:</p><pre class="programlisting">[snapshot]
datadir = /var/lib/mysql
lvgroup = VolGroup00
lvorigin = LogVol00
lvsnapshot = bwsnapshot
lvsizegb = 2</pre><p><em class="emphasis">Note</em>: The snapshot tool also
      reads
      <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>
      for the <code class="property">dbMgr/host</code>,
      <code class="property">dbMgr/username</code>, <code class="property">dbMgr/password</code>
      and <code class="property">dbMgr/databaseName.</code></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7540"></a>5.2.6.&nbsp;Restoring From a Snapshot</h3></div></div></div><p>The snapshot tool will take a copy of a MySQL data directory
      consolidated with a copy of the secondary databases. To restore from a
      snapshotted MySQL data directory, perform the following steps on the
      machine hosting MySQL:</p><div class="orderedlist"><ol type="1"><li><p>Stop the BigWorld server if it is running.</p></li><li><p>Stop the MySQL server if it is running, you can do this by
          running as root:</p><pre class="programlisting"># /etc/init.d/mysqld stop</pre></li><li><p>Move the existing <code class="filename">/var/lib/mysql</code> to a temporary location.
          You may choose to remove it after the restoration process is
          complete. For example:</p><pre class="programlisting"># mv /var/lib/mysql /tmp/mysql-backup</pre></li><li><p>Copy the snapshot directory's <code class="filename">mysql</code> directory to <code class="filename">/var/lib/mysql</code> (you will generally need
          to be root to do this) Note that snapshots are identified by date
          and time of the snapshot, and that the colons used in the time need
          to be escaped by a backslash. For example:</p><pre class="programlisting"># cp -r snapshots/20100924_152642/mysql /var/lib</pre></li><li><p>Change the ownership and permissions:</p><pre class="programlisting"># chown -R mysql:mysql /var/lib/mysql
# find /var/lib/mysql -type d | xargs chmod 700
# find /var/lib/mysql -type f | xargs chmod 660</pre></li><li><p>Restore the SELinux contexts for these files:</p><pre class="programlisting"># /sbin/restorecon -r /var/lib/mysql</pre></li><li><p>Start the MySQL server, verify it is running.</p><pre class="programlisting"># /etc/init.d/mysqld start</pre></li><li><p>Start the BigWorld server.</p></li></ol></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Data_Consolidation_Tool"></a>5.3.&nbsp;Data Consolidation Tool</h2></div></div></div><p>The data consolidation tool is used to incorporate data from
    secondary databases into the primary database. The application binary is
    located in
    <code class="filename">bigworld/bin/Hybrid[<span class="optional">64</span>]/commands/consolidate_dbs</code>.
    This tool is only provided in source code form and must be built before
    use. See <a href="#xref_Enabling_Secondary_Databases" title="11.4.&nbsp;Enabling Secondary Databases">Enabling Secondary Databases</a> for details
    on how to build the data consolidation tool.</p><p>Once this tool has been compiled, providing DBMgr is using MySQL the
    data consolidation tool will be automatically run during system shutdown
    or during system startup if the server was not shutdown correctly. There
    should be no need to manually run this tool except for consolidating
    backups created by the snapshot tool. For details on the snapshot tool see
    <a href="#xref_Database_Snapshot_Tool" title="5.2.&nbsp;Database Snapshot Tool">Database Snapshot Tool</a>. The data consolidation tool
    sends log messages to MessageLogger which can be viewed using the
    LogViewer tool in WebConsole.</p><p>This tool accepts two command line arguments:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"> Primary Database</em></p><p>The parameters required to connect to the primary
        database.</p><p>This argument should be specified in the form
        <code class="option"><em class="replaceable"><code>host</code></em>;<em class="replaceable"><code>username</code></em>;<em class="replaceable"><code>password</code></em>;<em class="replaceable"><code>database_name</code></em></code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When specifying this argument on the command line, it is
          necessary to quote the entire argument in order to prevent the shell
          from treating it as multiple commands.</p><p>For example:</p><pre class="programlisting">./consolidate_dbs "qa_host_03;bigworld_user;bigworld_password;fantasydemo"</pre></div></li><li><p><em class="emphasis">Secondary Databases </em></p><p>A file containing a newline separated list of fully qualified
        paths to secondary database files.</p></li></ul></div><p>When run without command line arguments, it will use DBMgr's
    configuration options located in
    <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>
    to connect to the primary database. It will use the data in the
    <span class="literal">bigworldSecondaryDatabase</span> table to retrieve the
    secondary databases.</p><p>The data consolidation tool uses the <span><strong class="command">transfer_db</strong></span>
    utility located in located in <code class="filename">bigworld/bin/Hybrid[<span class="optional">64</span>]/command</code>
    to transfer the secondary database files from the BaseApp machines to the
    machine where the data consolidation tool is running. The
    <span><strong class="command">transfer_db</strong></span> utility will be launched (via
    <span><strong class="command">bwmachined</strong></span>) on each machine that contains a secondary
    database file. The <span><strong class="command">transfer_db</strong></span> utility then opens a TCP
    connection to the data consolidation tool through which it will send the
    secondary database file.</p><p>The data consolidation tool will store the secondary databases
    locally in the directory specified by the
    <code class="property">&lt;dbMgr&gt;/&lt;consolidation&gt;/&lt;directory&gt;</code>
    configuration option. It will incorporate the data from the secondary
    databases into the primary database once all the secondary database files
    have been transferred to its local machine. If the data consolidation
    process is successful, both the local and remote copies of the secondary
    databases will be deleted, and the
    <span class="literal">bigworldSecondaryDatabase</span> table will be cleared. If the
    data consolidation process is unsuccessful, only the local copy of
    secondary database files are deleted.</p><p>The data consolidation tool logs to Message Logger under the
    <span class="literal">ConsolidateDBs</span> process. Under most circumstances, the
    data consolidation tool will log errors from
    <span><strong class="command">transfer_db</strong></span> as well. However, under some circumstances,
    <span><strong class="command">transfer_db</strong></span> errors will appear under the
    <span class="literal">Tools</span> process. The <span><strong class="command">bwmachined</strong></span> logs,
    in <code class="filename">/var/log/messages</code> on each
    machine where secondary databases are located, can help to diagnose
    problems, especially those related to the failure to run
    <span><strong class="command">transfer_db</strong></span>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Skipping_Data_Consolidation"></a>5.3.1.&nbsp;Skipping Data Consolidation</h3></div></div></div><p>If, for some reason, there is a problem with the data
      consolidation tool and the server refuses to start, the
      <span class="literal">bigworldSecondaryDatabase</span> table can be manually
      cleared to skip the data consolidation process. Alternatively,
      <span><strong class="command">consolidate_dbs</strong></span> can be run with the command-line
      parameter <code class="option">--clear</code> to achieve the same result.</p><p>While skipping the data consolidation process may allow the server
      to start again, the data in the secondary databases that were not
      consolidated is essentially lost. Though the secondary database files
      still exists, it is not recommended to try to consolidate the data after
      the server has been restarted since the data in the primary database may
      be more recent than the data in the left over secondary
      databases.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Ignoring_SQLite_Errors"></a>5.3.2.&nbsp;Ignoring SQLite Errors</h3></div></div></div><p>When <span><strong class="command">consolidate_dbs</strong></span> encounters an error in
      reading a secondary database file, it will abort the entire data
      consolidation process. Such errors should be investigated and corrected.
      If a secondary database file is genuinely corrupted and cannot be
      repaired, then it may be preferable for
      <span><strong class="command">consolidate_dbs</strong></span> to read as much data as possible from
      the corrupted secondary database and then proceed to consolidate the
      rest of the secondary databases. When the
      <code class="option">--ignore-sqlite-errors</code> command-line option is
      specified, <span><strong class="command">consolidate_dbs</strong></span> will proceed to
      consolidating the next secondary database when it encounters an error
      instead of aborting the consolidation process.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Controlled_Startup_And_Shutdown"></a>Chapter&nbsp;6.&nbsp;Controlled Startup and Shutdown</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e7751">6.1. Server-wide Shutdown</a></span></dt><dt><span class="section"><a href="#d0e7836">6.2. Individual Application Retirement</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e7841">6.2.1. BaseApp Retirement</a></span></dt><dt><span class="section"><a href="#d0e7852">6.2.2. CellApp Retirement</a></span></dt><dt><span class="section"><a href="#d0e7857">6.2.3. Retirement via WebConsole</a></span></dt><dt><span class="section"><a href="#d0e7867">6.2.4. Retirement via <span class="literal">control_cluster.py</span></a></span></dt></dl></dd></dl></div><p>For maintenance and upgrade reasons, the server or some part of it may
  be required to shutdown. There are two typical scenarios:</p><div class="orderedlist"><ol type="1"><li><p>Server-wide shutdown, where the entire server needs to be
      restarted.</p></li><li><p>Individual application retirement that does not cause the server
      to stop running.</p></li></ol></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7751"></a>6.1.&nbsp;Server-wide Shutdown</h2></div></div></div><p>There are times when the entire server might need to be shut down,
    and restarted later in a similar state.</p><p>To tell the server to shut down in a controlled way, a message must
    be sent to all LoginApps. This may be in the form of a Watcher message or
    a USR1 signal. The easiest way to do this is to use the script
    <span class="literal">control_cluster.py</span> with the option stop or via
    WebConsole. For more details, see <a href="#xref_control_cluster_py" title="3.4.1.&nbsp;Control Cluster">Control Cluster</a>.</p><p>Controlled startup and shutdown only work when the underlying
    database is MySQL &#8212; it does not work when the XML version is used.</p><p>If the <span class="literal">bw.xml</span>'s
    <span class="literal">dbMgr</span>/<span class="literal">clearRecoveryData</span>
    configuration option is set to <span class="literal">false</span>, then the server
    is automatically started using information written during the controlled
    shutdown. If the server had failed unexpectedly, then it is started using
    the disaster recovery information. Setting that configuration option to
    <span class="literal">true</span> will cause the server to be started in its initial
    state, <em class="emphasis">i.e.</em>, an empty space with no entities. For
    more details, see <a href="#xref_DBMgr_Configuration_Options" title="2.14.&nbsp;DBMgr Configuration Options">DBMgr Configuration Options</a>.</p><p>The main information that is restored from the database is:</p><div class="itemizedlist"><ul type="disc"><li><p>Spaces and their data</p></li><li><p>Game time</p></li><li><p>Which entities should be in each space.</p></li></ul></div><p>When using MySQL as the underlying database, this information is
    stored in the following tables:</p><div class="itemizedlist"><ul type="disc"><li><p>Spaces and their data &#8212; <span class="literal">bigworldSpaces</span>,
        <span class="literal">bigworldSpaceData</span></p></li><li><p>Game time &#8212; <span class="literal">bigworldGameTime</span></p></li><li><p>Which entities should be in each space &#8212;
        <span class="literal">bigworldLogOns</span></p></li></ul></div><p>For details on these tables, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_MySQL_Database_Schema" class="olink"><i>MySQL Database Schema</i></a> <span class="symbol">&#8594;</span> <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Non_Entity_Tables" class="olink">Non-Entity Tables</a></p><p>For details on related scripting, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Controlled_Startup_And_Shutdown" class="olink"><i>Controlled Startup and Shutdown</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7836"></a>6.2.&nbsp;Individual Application Retirement</h2></div></div></div><p>Individual BaseApps and CellApps can be retired. This can be useful
    if maintenance is required on a single machine where only BaseApps and
    CellApps are running.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7841"></a>6.2.1.&nbsp;BaseApp Retirement</h3></div></div></div><p>When BaseApps retire, base entities and proxy entities are
      offloaded to other BaseApps, and connected clients will be reconnected
      with another BaseApp transparently.</p><p>It may take some time for the base entities and proxy entities to
      be offloaded from the retiring BaseApp to other BaseApps. The retiring
      BaseApp will shutdown once these entities have been successfully
      offloaded and a new backup cycle has completed, ensuring no data
      loss.</p><p>If another BaseApp terminates unexpectedly while the retirement is
      in progress, any entities that were offloaded to the dead BaseApp will
      be re-offloaded on to another BaseApp.</p><p>For redundancy reasons, it is recommended that retirement only be
      done if there are at least two other BaseApps running. This ensures that
      in the event of a unexpected BaseApp termination while retirement
      occurs, every base entity in the system is adequately backed up.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7852"></a>6.2.2.&nbsp;CellApp Retirement</h3></div></div></div><p>CellApps can also be retired. Each cell administered by the
      retiring CellApp will shrink in size gradually, each cell disappearing
      once the area reaches zero. Once there are no more cells, the CellApp
      will shut itself down.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7857"></a>6.2.3.&nbsp;Retirement via WebConsole</h3></div></div></div><p>A BaseApp or a CellApp can be individually retired by using the
      WebConsole in the ClusterControl module, by selecting<em class="emphasis"> Retire
      App</em> from the action menu for the particular CellApp or
      BaseApp to be retired. Refer to the section on <a href="#xref_WebConsole" title="3.1.&nbsp;WebConsole">WebConsole</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7867"></a>6.2.4.&nbsp;Retirement via <span class="literal">control_cluster.py</span></h3></div></div></div><p>A BaseApp or a CellApp can be individually retired by using the
      ControlCluster command line tool (see <a href="#xref_Server_Command_Line_Utilities" title="3.4.&nbsp;Server Command-Line Utilities">Server Command-Line Utilities</a>), using the
      <span><strong class="command">retireproc</strong></span> command. For example:</p><pre class="programlisting">$ ./control_cluster.py retireproc cellapp01
$ ./control_cluster.py retireproc baseapp03</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Stress_Testing_With_Bots"></a>Chapter&nbsp;7.&nbsp;Stress Testing with Bots</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e7886">7.1. The Login Process</a></span></dt><dt><span class="section"><a href="#d0e8009">7.2. Python Interface</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8021">7.2.1. Python Controller (<span class="literal">bot_op.py</span>)</a></span></dt><dt><span class="section"><a href="#d0e8127">7.2.2. Methods and Attributes</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Controlling_Movement">7.3. Controlling Movement</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_NodeProperties_Section">7.3.1. NodeProperties Section</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8646">7.4. Extending Bots</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8649">7.4.1. Creating New Movement Controllers</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Bots_Misc">7.5. Miscellaneous Bots Issues</a></span></dt><dd><dl><dt><span class="section"><a href="#xref_Bots_Misc_File_Descriptor_Limit">7.5.1. Running out of File Descriptors</a></span></dt></dl></dd></dl></div><p>The Bots application is a process that can command arbitrary numbers
  of simulated clients to log into the server and perform activities. It is
  written in C++, but controlled through Python, like the BigWorld
  Client.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7886"></a>7.1.&nbsp;The Login Process</h2></div></div></div><p>The bots are designed to log in a server just like a real client. By
    default, the Bots process locates a LoginApp by broadcasting a message
    requesting all LoginApps to respond, and then using the first one to
    reply. This is the simplest method to log in if there is only one instance
    of a BigWorld server running.</p><p>The script is located in folder
    <span class="literal">bigworld/bin/$MF_CONFIG</span>, and has the following
    syntax:</p><pre class="programlisting">bots [-serverName &lt;srv&gt; [-port &lt;port&gt;]]
     [-username &lt;user&gt; [-password &lt;pwd&gt;] [-randomName]] [-scripts]</pre><p>The options for invoking bots are described in the list
    below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">-serverName
        <em class="replaceable"><code>&lt;srv&gt;</code></em></span></em></p><p>Server that the bot clients will login to (overrides the
        auto-locate method).</p></li><li><p><em class="emphasis"><span class="literal">-port
        <em class="replaceable"><code>&lt;port&gt;</code></em></span></em></p><p>Login port. Ignored if Bots is using auto-locate method.</p></li><li><p><em class="emphasis"><span class="literal">-username
        <em class="replaceable"><code>&lt;user&gt;</code></em></span></em></p><p>Username that the bot clients will log in as.</p></li><li><p><em class="emphasis"><span class="literal">-password
        <em class="replaceable"><code>&lt;pwd&gt;</code></em></span></em></p><p>Password for bot clients' login.</p></li><li><p><em class="emphasis"><span class="literal">-randomName</span></em></p><p>Randomises the login name based on the specified
        &lt;username&gt;.</p></li><li><p><em class="emphasis"><span class="literal">-scripts</span></em></p><p>Enables Bots to run scripts. This has a considerable performance
        cost.</p></li></ul></div><p>The auto-locate procedure can be overridden by specifying the option
    <span class="literal">-serverName
    <em class="replaceable"><code>&lt;serverName&gt;</code></em></span> on the command
    line. If both methods fail, then the Bots process requests the server name
    on stdin (if attached to a terminal). If all these methods fail, then the
    process starts, but cannot create new bots until the server is set (via
    the Python method <span class="literal">setDefaultServer</span>).</p><p>If the option <span class="literal">-scripts</span> is specified then Bots
    looks for the entity definition files under folder
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/entity_defs</span>,
    and for scripts under folder
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/bot</span>.</p><p>Specific scripts can be created for Bots, but if a client script
    does not reference the client's C++ modules, then it can be reused. Note
    that the bots process does not support the BigWorld Client APIs, since it
    is intended to be lightweight.</p><p>In many operation scenarios the entity definition file for Bots
    could be either missing or different from the definition files for the
    server. The Bots would use an incorrect message digest for login; and
    hence the login will fail because LoginApp relies on the digest for
    verifying entity definition consistency. Previously, only way around this
    problem is turn the digest checking on the server off in
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>'s
    <span class="literal">dbMgr</span> options section<sup>[<a name="d0e7988" href="#ftn.d0e7988">12</a>]</sup>. This option can also be changed on the fly via a watcher,
    using WebConsole's ClusterControl module; see <a href="#xref_WebConsole_ClusterControl" title="3.1.1.1.&nbsp;ClusterControl">ClusterControl</a>). However, this is not a viable
    option, if you want to use Bots on production servers. You can now set
    custom MD5 digest in the
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>'s
    <span class="literal">bots</span> section under option loginMD5Digest. This option
    can also be modified on the fly through WebConsole.</p><p>Bots can now realistically simulate general Internet networking
    environment by introduce artificial packet loss, network delays, sudden
    disconnections and frequent relogins. All this simulation can be
    programmed with Bots' personality script.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8009"></a>7.2.&nbsp;Python Interface</h2></div></div></div><p>The Bots process was designed to be controlled programmatically via
    Python, but since Python can be used interactively, it is also a quick way
    to get some bots into the system and control them.</p><p>You can telnet to port 6075 to talk to the bots process, as
    illustrated below:</p><pre class="programlisting">$ telnet 10.40.7.12 6075
Welcome to the Bot process
&gt;&gt;&gt; BigWorld.getDefaultServer()
10.40.7.1
&gt;&gt;&gt; BigWorld.setDefaultServer('server2')
&gt;&gt;&gt; BigWorld.setDefaultTag('red')
&gt;&gt;&gt; BigWorld.addBotsSlowly(500, 0.1)
&gt;&gt;&gt; BigWorld.setDefaultTag('blue')
&gt;&gt;&gt; BigWorld.addBotsSlowly(500, 0.1)
&gt;&gt;&gt; BigWorld.addBotsWithName( [('Bot_01', '01'), ('Bot_02', '02')] )</pre><p><span class="citetitle">Example of use of Python interface to
    Bots</span></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8021"></a>7.2.1.&nbsp;Python Controller (<span class="literal">bot_op.py</span>)</h3></div></div></div><p>BigWorld provides a Python program to simplify the management of
      large numbers of bots.</p><p>It automatically starts bot processes as needed, load balancing
      (based on CPU load) on all available machines not running any other
      BigWorld components.</p><p>The script is located in folder bigworld/tools/server and has the
      following syntax:</p><pre class="programlisting">python bot_op.py [add [&lt;number_of_bots&gt;]]
                 [del [&lt;number_of_bots&gt;]]
                 [movement &lt;controller_type&gt; &lt;controller_data&gt; [&lt;bot_tag&gt;]]
                 [set (&lt;watcher_name&gt; &lt;value&gt;)+]
                 [run [&lt;command&gt;]]
                 [addprocs [&lt;num_of_procs&gt;]]
                 -u [username or uid]</pre><p>The options for invoking <span class="literal">bot_op.py</span> are
      described in the list below:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">add
          [<em class="replaceable"><code>&lt;number_of_bots&gt;</code></em>]</span></em></p><p>Adds the specified number of bots to the system. If
          &lt;number_of_bots&gt; is not specified, then one bots is
          added.</p><p>Bots are added 16 at a time, up to a maximum of 256 per bots
          process.</p><p>The script waits 1 second after each add, to check it a bot
          was effectively added. When all bots processes are full, it creates
          a new process on an available machine that is using less than 80%
          CPU (preferably one that is already running some bots
          processes).</p></li><li><p><em class="emphasis"><span class="literal">addprocs
          [<em class="replaceable"><code>&lt;num_of_procs&gt;</code></em>]</span></em></p><p>Spawns the given number of bots processes on each machine that
          is considered eligible for running them, or 1 on each if no number
          is given.</p></li><li><p><em class="emphasis"><span class="literal">del
          [<em class="replaceable"><code>&lt;number_of_bots&gt;</code></em>]</span></em></p><p>Deletes the specified number of bots from the system. If
          &lt;number_of_bots&gt; is not specified, then it defaults to 1. The
          number of bots will be ceiling clamped to the actual number of bots
          on the server.</p></li><li><p><em class="emphasis"><span class="literal">movement
          <em class="replaceable"><code>&lt;controller_type&gt;</code></em>
          <em class="replaceable"><code>&lt;controller_data&gt;</code></em>
          [<em class="replaceable"><code>&lt;bot_tag&gt;</code></em>]</span></em></p><p>Changes the bot's movement controller. If option
          &lt;bot_tag&gt; is specified, then only bots matching it will be
          changed. Otherwise, all bots will be changed.</p></li><li><p><em class="emphasis"><span class="literal">set
          (<em class="replaceable"><code>&lt;watcher_name&gt;</code></em>
          <em class="replaceable"><code>&lt;value&gt;</code></em>)+</span></em></p><p>Sets the watcher to specified value on all bot
          applications.</p></li><li><p><em class="emphasis"><span class="literal">run
          [<em class="replaceable"><code>&lt;command&gt;</code></em>]</span></em></p><p>Runs the specified Python command on all bots. If
          &lt;command&gt; is not specified, then it is read from stdin.</p></li><li><p><em class="emphasis"><span class="literal">-u
          [<em class="replaceable"><code>username</code></em>|<em class="replaceable"><code>uid</code></em>]</span></em></p><p>Manually specify the UID of the server that the script will
          take action on.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8127"></a>7.2.2.&nbsp;Methods and Attributes</h3></div></div></div><p>The list below describes the bots' attributes and methods on
      ClientApp and BigWorld:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">ClientApp Attributes</em></p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis"><span class="literal">id</span>
              (<span class="literal">int</span>)</em> &#8212; Bot ID
              (read-only).</p></li><li><p><em class="emphasis">spaceID(int)</em> &#8212; ID
              of the space the bot is currently in. 0 means not in any space
              (read-only).</p></li><li><p><em class="emphasis">loginName(string)</em> &#8212;
              Bot's login name.</p></li><li><p><em class="emphasis">loginPassword(string)</em>
              &#8212; Bot's login password.</p></li><li><p><em class="emphasis"><span class="literal">tag</span>
              (<span class="literal">string</span>)</em> &#8212; Bot's
              user-specified tag. Allows the control of partial sets of
              bots.</p></li><li><p><em class="emphasis"><span class="literal">speed</span>
              (<span class="literal"><span class="literal">float</span></span>)</em> &#8212;
              Bot's speed.</p></li><li><p><em class="emphasis"><span class="literal">position</span>
              (<span class="literal">Vector3</span>)</em> &#8212; Bot's
              position.</p></li><li><p><em class="emphasis"><span class="literal">yaw</span>
              (<span class="literal">float</span>)</em> &#8212; Bot's yaw.</p></li><li><p><em class="emphasis"><span class="literal">pitch</span>
              (<span class="literal">float</span>)</em> &#8212; Bot's
              pitch.</p></li><li><p><em class="emphasis"><span class="literal">roll</span>
              (<span class="literal">float</span>)</em> &#8212; Bot's roll.</p></li><li><p><em class="emphasis">isOnline(bool)</em> &#8212;
              Indicates whether the bot is connected to a server
              (read-only).</p></li><li><p><em class="emphasis">isDestroyed(bool)</em> &#8212;
              Indicates whether the bot has been destroyed (read-only).</p></li><li><p><em class="emphasis">entities(PyObject)</em></p><p>Dictionary-like attribute containing the list of entities
              that are in the simulated client's current AOI.</p></li></ul></div></li><li><p><em class="emphasis">ClientApp Methods</em></p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">logOn()</em></p><p>Initiate log on process for the simulated client to
              connect to a BW server.</p></li><li><p><em class="emphasis">logOff()</em></p><p>Make a simulate client disconnect from server gracefully.
              If the simulated client is not online, it will do
              nothing.</p></li><li><p><em class="emphasis">dropConnection()</em></p><p>Make a simulate client drop the connection with the
              server. If the simulated client is not online, it will do
              nothing.</p></li><li><p><em class="emphasis">setConnectionLossRatio( float
              lossRatio )</em></p><p>Set up network packet loss ratio for simulating unstable
              network environment. Range between 0.0 and 1.0. 0.0 means no
              packet loss. 1.0 mean 100 percent packet loss.</p></li><li><p><em class="emphasis">setConnectionLatency( float
              minLatency, float maxLatency )</em></p><p>Set up simulated network data latency (in
              milliseconds).</p></li><li><p><em class="emphasis">moveTo( Math.Vector3 position
              )</em></p><p>Set next destination position for the player avatar of the
              simulated client.</p></li><li><p><em class="emphasis">snapTo( Math.Vector3 position
              )</em></p><p>Set the player avatar position for the simulated
              client.</p></li><li><p><em class="emphasis">stop()</em></p><p>Stop the player avatar of the simulated client
              moving.</p></li><li><p><em class="emphasis">faceTowards( Math.Vector3 direction
              )</em></p><p>Set the direction of avatar of the simulated
              client.</p></li><li><p><em class="emphasis">addTimer()</em></p><p>Add a timer for the bot client. This function returns an
              integer timer id; otherwise it returns -1.</p></li><li><p><em class="emphasis">delTimer( int timerID
              )</em></p><p>deletes an active timer corresponding the timerID.</p></li><li><p><em class="emphasis">onTick()</em></p><p>This optional function is invoked every game tick, should
              it be defined in the player Avatar script.</p></li></ul></div></li><li><p><em class="emphasis">BigWorld Attributes</em></p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis"><span class="literal">bots</span></em></p><p>Dictionary-like attribute containing the list of simulated
              clients. The key is the player's ID, and value is an instance of
              ClientApp.</p></li><li><p><em class="emphasis"><span class="literal">bots
              [<em class="replaceable"><code>&lt;player_id&gt;</code></em>].
              entities</span></em></p><p>Dictionary-like attribute containing the list of entities
              created under the simulated client specified by
              <span class="literal"><em class="replaceable"><code>&lt;player_id&gt;</code></em></span>.
              The key is the entity's ID, and the value is the reference to
              the entity.</p><p>In non-script bots, only the player entity is created and
              stored in this attribute.</p></li><li><p><em class="emphasis"><span class="literal">bots
              [<em class="replaceable"><code>&lt;player_id&gt;</code></em>].entities[<em class="replaceable"><code>&lt;ent_id&gt;</code></em>].clientApp</span></em></p><p>Attribute referring to the ClientApp that owns the entity.
              An entity can access its owner ClientApp via this attribute.
              <span class="literal">BigWorld.bots[<em class="replaceable"><code>&lt;player_id&gt;</code></em>].entities[<em class="replaceable"><code>&lt;ent_id&gt;</code></em>].clientApp</span>
              equals to
              <span class="literal">BigWorld.bots[<em class="replaceable"><code>&lt;player_id&gt;</code></em>]</span>.</p></li></ul></div></li><li><p><em class="emphasis">BigWorld Methods</em></p><div class="itemizedlist"><ul type="circle"><li><p><em class="emphasis">setMovementController(string type,
              string data)</em> &#8212; Context: ClientApp</p><p>Sets a new movement controller for the bot. On failure,
              the controller is left unchanged. Returns
              <span class="literal">true</span> on success, <span class="literal">false</span> on
              failure.</p></li><li><p><em class="emphasis">setLoginMD5Digest(string
              MD5Digest)</em> &#8212; Context: BigWorld</p><p>Set the 32 character long MD5Digest (in hex readable form)
              for server login. If the input string length is not exactly 32
              character, the MD5 digest will be reset to empty.</p></li><li><p><em class="emphasis">addBots( int numBots )</em>
              &#8212; Context: BigWorld</p><p>Immediately adds the specified number of simulated clients
              to the application. If too many bots are added at once, then
              some of them may time out, depending on how long it takes to log
              in all of them.</p></li><li><p><em class="emphasis">addBotsSlowly(int numBots,float
              delayBetweenAdd,int groupSize=1)</em> &#8212; Context:
              BigWorld</p><p>Adds bots to the system in groups of groupSize, and add a
              delay between each group. This method returns immediately,
              adding the bots in the background, and is the best way to add
              bots to a system.</p></li><li><p><em class="emphasis">addBotsWithName( PyObject loginInfo
              )</em></p><p>Immediately add a set of bots with login name and login
              password specified from loginInfo. The structure of the
              loginInfo is a list of tuples which consist of two strings. The
              first string is the login name and the second one is login
              password. In the event of incorrect loginInfo, a Python
              exception will be thrown.</p></li><li><p><em class="emphasis">delBots( int numBots)</em>
              &#8212; Context: BigWorld</p><p>Deletes the specified number of simulated clients from the
              application. The method onClientAppDestroy() of the personality
              module is called.</p></li><li><p><em class="emphasis">getDefaultServer()</em>
              &#8212; Context: BigWorld</p><p>Returns the server name that the bots try to log
              in.</p></li><li><p><em class="emphasis">setDefaultServer( string serverName
              )</em> &#8212; Context: BigWorld</p><p>Sets the server name that the bots try to log in.</p></li><li><p><em class="emphasis">onTick()</em> &#8212; Context:
              BWPersonality</p><p>This optional function is invoked every game tick, should
              it be defined in the personality module in
              &lt;res&gt;/server/bw.xml.</p></li><li><p><em class="emphasis">onLoseConnection( int playerID )
              </em>&#8212; Context: BWPersonality</p><p>If this callback function is defined in the personality
              module specified in file &lt;res&gt;/server/bw.xml, it will be
              invoked when a simulated client loses its connection with a
              server abnormally. The personality script can decide whether the
              client should be destroyed or remain dormant for later
              reactivation by return True or False respectively. <em class="emphasis">NOTE</em>: if this callback is not defined,
              bots that lose connection will be automatically
              destroyed.</p></li><li><p><em class="emphasis">onClientAppDestroy( int playerID
              )</em> &#8212; Context: BWPersonality</p><p>If defined in the personality module specified in file
              &lt;res&gt;/server/bw.xml, this callback method is called for
              each destroyed bot client. The argument is the ID of the deleted
              player entity. A bot client may be destroyed due to either loss
              of server connection or by BigWorld.delBots() method call. If a
              bot client is destroyed by BigWorld.delBots() method call, it
              will be disconnected from the server gracefully. We recommend
              client should execute additional log off procedure in this
              onClientAppDestroy callback function. An example is as
              following:</p><pre class="programlisting">def onClientAppDestroyed( playerID ):
  bot = BigWorld.bots[playerID]
  if bot.isOnline:
    bot.entities[playerID].base.logOff()</pre><p>The implementation
              above assumes that the player entity on the server has an
              exposed base method logOff(), which will then destroy the player
              cell and base entities on the server. The script must to be
              placed under the script folder
              <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/scripts/bot</span>.</p></li></ul></div></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Controlling_Movement"></a>7.3.&nbsp;Controlling Movement</h2></div></div></div><p>The default movement controller Patrol moves the bots along a graph
    read from a file.</p><p>The name of the file containing the movement graph is specified in
    file &lt;res&gt;/server/ bw.xml, on section &lt;bots&gt;, by the
    configuration option controllerData.</p><pre class="programlisting">&lt;root&gt;
  ...
  &lt;bots&gt;
    &lt;controllerData&gt;  server/bots/test.bwp  &lt;/controllerData&gt;
    &lt;controllerType&gt;  Patrol                &lt;/controllerType&gt;
    &lt;password&gt;        passwd                &lt;/password&gt;
    &lt;username&gt;        Bot                   &lt;/username&gt;
    &lt;shouldLog&gt;       true                  &lt;/shouldLog&gt;
    &lt;serverName&gt;                            &lt;/serverName&gt;
    &lt;randomName&gt;      false                 &lt;/randomName&gt;
    &lt;scripts&gt;         false                 &lt;/scripts&gt;
    &lt;port&gt;            0                     &lt;/port&gt;
    &lt;publicKey&gt;       loginapp.pubkey       &lt;/publicKey&gt;
  &lt;/bots&gt;
  ...
&lt;/root&gt;</pre><p><span class="citetitle">Example file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span></span></p><p>The file name might have the suffix random, in which case the start
    position of the bot is chosen randomly from the set of node positions in
    the graph.</p><p>The format specification for the movement graph file is illustrated
    below:</p><pre class="programlisting">&lt;controller&gt;

  &lt;nodeDefaults&gt;
    ?NodeProperties
  &lt;/nodeDefaults&gt;

  &lt;nodes&gt;
    *&lt;node&gt;
         &lt;pos&gt;   integer integer integer  &lt;/pos&gt;
        ?&lt;name&gt;  string_node_name         &lt;/name&gt;
        ?NodeProperties
        *&lt;edges&gt;
           &lt;edge&gt;  string_node_name  &lt;/edge&gt;
         &lt;/edges&gt;
     &lt;/node&gt;
  &lt;/nodes&gt;

&lt;/controller&gt;</pre><p><span class="citetitle">Grammar of movement graph files</span></p><p>The list below describes the tags in the movement graph file:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">edge</span> (section
        <span class="literal">nodes/node/edges</span>)</em></p><p>Name of one of the nodes that this node borders. Must be the
        same value specified for a name section in the file.</p></li><li><p><em class="emphasis"><span class="literal">edges</span> (section
        <span class="literal">nodes/node</span>)</em></p><p>Tag specifying all the nodes that this node borders.</p></li><li><p><em class="emphasis"><span class="literal">name</span> (section
        <span class="literal">nodes/node</span>)</em></p><p>Name used to refer to the node. If this tag is not specified for
        a node, then you can refer to it by an integer sequential number, with
        the first node having an index of zero.</p></li><li><p><em class="emphasis"><span class="literal">node</span> (section
        <span class="literal">nodes</span>)</em></p><p>Tag for section specifying a specific node in the graph.</p></li><li><p><em class="emphasis"><span class="literal">nodeDefaults</span></em></p><p>Tag for section specifying default values for all nodes. These
        values can be overridden on a per-node basis in section
        nodes/node.</p></li><li><p><em class="emphasis"><span class="literal">NodeProperties</span> (section
        <span class="literal">NodeDefaults</span> and
        <span class="literal">nodes/node</span>)</em></p><p>For details, see <a href="#xref_NodeProperties_Section" title="7.3.1.&nbsp;NodeProperties Section">NodeProperties Section</a>.</p></li><li><p><em class="emphasis"><span class="literal">nodes</span></em></p><p>Tag for section specifying all the nodes in the graph.</p></li><li><p><em class="emphasis"><span class="literal">pos</span> (section
        <span class="literal">nodes/node</span>)</em></p><p>XYZ position of the centre of the node. The node is the area
        around pos, extending for n metres around it (n being the value of
        NodeProperties' tag radius).</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_NodeProperties_Section"></a>7.3.1.&nbsp;NodeProperties Section</h3></div></div></div><p>The format specification for the NodeProperties section is
      illustrated below:</p><pre class="programlisting">?&lt;minStay&gt;   float  &lt;/minStay&gt;
?&lt;maxStay&gt;   float  &lt;/maxStay&gt;
?&lt;radius&gt;    float  &lt;/radius&gt;
?&lt;minSpeed&gt;  float  &lt;/minSpeed&gt;
?&lt;maxSpeed&gt;  float  &lt;/maxSpeed&gt;</pre><p><span class="citetitle">Grammar of <em class="emphasis">NodeProperties</em> section</span></p><p>The list below describes the tags in the
      <span class="literal">NodeProperties</span> section:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">maxSpeed</span></em></p><p>Maximum speed of the bot.</p></li><li><p><em class="emphasis"><span class="literal">maxStay</span></em></p><p>Maximum number of seconds that the bot should stay in the
          node.</p></li><li><p><em class="emphasis"><span class="literal">minSpeed</span></em></p><p>Minimum speed of the bot.</p></li><li><p><em class="emphasis"><span class="literal">minStay</span></em></p><p>Minimum number of seconds that the bot should stay in the
          node.</p></li><li><p><em class="emphasis"><span class="literal">radius</span></em></p><p>Number of metres around the node's pos location to be
          considered as the node. When a bot is travelling between two nodes,
          it chooses a random point of arrival in the destination node. This
          way, the bots do not follow the exact same line. The point is chosen
          to lie within the radius of the destination node.</p></li></ul></div><p>An example movement graph file is displayed below:</p><pre class="programlisting">&lt;patrolGraph&gt;
  &lt;nodeDefaults&gt;
    &lt;minStay&gt;   5  &lt;/minStay&gt;
    &lt;maxStay&gt;  10  &lt;/maxStay&gt;
    &lt;radius&gt;   20  &lt;/radius&gt;
  &lt;/nodeDefaults&gt;
  &lt;nodes&gt;
    &lt;node&gt;
      &lt;name&gt;      Town1      &lt;/name&gt;
      &lt;minStay&gt;   7          &lt;/minStay&gt;
      &lt;pos&gt;       5000 0 0   &lt;/pos&gt;
      &lt;edges&gt;&lt;edge&gt;  Town2        &lt;/edge&gt;&lt;/edges&gt;
    &lt;/node&gt;
    &lt;node&gt;
      &lt;name&gt;      Town2        &lt;/name&gt;
      &lt;pos&gt;       5000 0 5000  &lt;/pos&gt;
    &lt;/node&gt;
  &lt;/nodes&gt;
&lt;/patrolGraph&gt;</pre><p><span class="citetitle">Example movement graph file</span></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8646"></a>7.4.&nbsp;Extending Bots</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8649"></a>7.4.1.&nbsp;Creating New Movement Controllers</h3></div></div></div><p>The default movement controller is Patrol, but you might want to
      create one that better represents the expected traffic patterns and
      entity distributions of your game, or to stress test other aspects of
      the system.</p><p>To create a new movement Controller, derive its class from the
      MovementController class. Also derive a class from the MovementFactory
      class. The factory is used to parse the Controller data argument, and
      instantiate a new movement controller, while the movement controller
      moves the bot around.</p><p>The fragments below list the relevant methods in the base
      classes:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">Class
          MovementController</em></p><pre class="programlisting">bool nextStep( float speed, float dTime, Vector3&amp; position, Direction3D&amp; direction)</pre></li></ul></div><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">Class
          MovementFactory</em></p><pre class="programlisting">MovementFactory(const char* name)

MovementController* create(
  const std::string&amp;  data,
  const Vector3&amp;      startPosition)</pre></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Bots_Misc"></a>7.5.&nbsp;Miscellaneous Bots Issues</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xref_Bots_Misc_File_Descriptor_Limit"></a>7.5.1.&nbsp;Running out of File Descriptors</h3></div></div></div><p>As the Bots process is designed to test a large number of client
      connections to a BigWorld server, it is possible that in doing so the
      Bots process may exceed the maximum number of open file descriptors
      allowed by the Linux kernel.</p><p>This issue will be identifiable by newly created bots not
      communicating with the LoginApp, as well as log output from the Bots
      process similar to the following:</p><pre class="programlisting">Bots   ERROR   Endpoint::findDefaultInterface: if_nameindex returned NULL (Too many open files)
Bots   ERROR   NetworkInterface::recreateListeningSocket: Couldn't determine ip addr of default interface</pre><p>If you encounter this issue, this can be worked around by changing
      your Linux system settings to increase the per-process limit for the
      maximum number of open file descriptors</p><p>To check the current limit allowed by your system, from a Linux
      shell type the following:</p><pre class="programlisting">$ ulimit -n
1024</pre><p>Here you can see the limit is 1024 open file descriptors
      per-process. In order to increase this limit for all processes we need
      to edit the file <code class="filename">/etc/security/limits.conf</code>. We do
      this on a per-user basis, so if we wanted to increase the limit for the
      <span class="literal">game_user</span> user account to 4096, we would add the
      following:</p><pre class="programlisting">game_user soft nofile 4096
game_user hard nofile 4096</pre><p>If the user is currently logged in, you may need to log out and
      then back in for the changes to take effect on the sessions.</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e7988" href="#d0e7988">12</a>] </sup>For details check <span class="literal">allowEmptyDigest</span> option in
        <a href="#xref_DBMgr_Configuration_Options" title="2.14.&nbsp;DBMgr Configuration Options">DBMgr Configuration Options</a>.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Security"></a>Chapter&nbsp;8.&nbsp;Security</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e8715">8.1. Security of the Server</a></span></dt><dt><span class="section"><a href="#xref_Security_Server_Ports">8.2. Server Ports</a></span></dt><dt><span class="section"><a href="#xref_Blocking_Ports_And_Related_Security_Considerations">8.3. Blocking Ports and Related Security Considerations</a></span></dt></dl></div><p>Security has been of paramount importance in the design and
  implementation of all parts of BigWorld.</p><p>The basic philosophy is to always handle with care any
  client-initiated actions or messages. This should be accomplished in a way
  that does not unduly limit potential game designs.</p><p>For more details, see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>, chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Security_Systems_In_BigWorld_Technology" class="olink"><i>Security</i></a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8715"></a>8.1.&nbsp;Security of the Server</h2></div></div></div><p>The internal network is assumed to be secure &#8212; BigWorld does
    not implement security measures to safeguard processes against an attacker
    gaining access to the cluster's internal LAN. Operators should ensure that
    the usual protections for an internal network are in place. Remote access
    should be very strictly controlled.</p><p>The external points of contact are the area of most concern when
    running an exposed server. For BigWorld, these are LoginApp and BaseApp,
    as illustrated below:</p><div class="informalfigure"><div class="mediaobject"><img src="images/bigworld_server_components.png"><span class="caption"><p>BigWorld Server components</p></span></div></div><p>Due to the bandwidth needs of a massively multiplayer online game,
    LoginApp and BaseApp are intended to be run on machines with external
    access. In some sense they are the firewall. For more details, see <a href="#xref_Blocking_Ports_And_Related_Security_Considerations" title="8.3.&nbsp;Blocking Ports and Related Security Considerations">Blocking Ports and Related Security Considerations</a>.</p><p>LoginApp receives only fixed-length queries, making it easy and
    transparent to secure. This process is expected to be tailored by
    customers to suit their game, but care should be taken when doing
    so.</p><p>BaseApp receives more complex data, including script method calls,
    and is the gateway to the rest of the BigWorld Server. It has many checks
    in place to ensure the integrity of received data, and to discard (and
    warn about) corrupted data and hacking attempts. The string
    <span class="literal">CHEAT</span> is used in the log messages when BigWorld
    receives potentially malicious data that does not conform to its protocols
    (the CellApp may also use this indicator). It is advised that
    MessageLogger logs be monitored for messages containing that string. For
    details on MessageLogger, see <a href="#xref_MessageLogger" title="3.2.&nbsp;Message Logger">Message Logger</a>.</p><p>The security of the game-level logic rests to a certain extent with
    the Python scripts that implement it. For example, an entity should not be
    able to stab another entity that is 100 metres away. For more details on
    this topic and on server features such as physics checking, see the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Proxies_And_Players" class="olink"><i>Proxies and Players</i></a>, section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Physics_Correction" class="olink">Physics Correction</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Security_Server_Ports"></a>8.2.&nbsp;Server Ports</h2></div></div></div><p>The list below describes the ports used by BigWorld server:</p><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis">20013 (Protocol: UDP, Access:
        External)</em></p><p>The default port used by LoginApp. This port can be overridden
        in
        <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>
        file's <span class="literal">loginApp/externalPorts</span> section, set the
        <span class="literal">port</span> configuration option. Multiple ports can be
        specified and the first available one is used.</p></li><li><p><em class="emphasis">20018 and 20019 (Protocol: UDP, Access:
        Internal)</em></p><p>Used by BWMachined.</p></li><li><p><em class="emphasis">40001-49999 (Protocol: TCP, Access:
        Internal)</em></p><p>The Python server on BaseApp.</p><p>All BaseApps have a Python server that can be telnetted to. If
        no <span class="literal">baseApp/pythonPort</span> is specified in
        <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>,
        the port number is 40000, plus the BaseApp ID is used.</p><p>BaseApp ID numbers start at 1, so to talk to the third started
        BaseApp, telnet to 40003.</p></li><li><p><em class="emphasis">50001-59999 (Protocol: TCP, Access:
        Internal)</em></p><p>The Python server on CellApp.</p><p>All CellApps have a Python server that can be telnetted to. If
        no <span class="literal">cellApp/pythonPort</span> is specified in
        <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>,
        the port number is 50000, plus the CellApp ID is used.</p><p>CellApp ID numbers start at 1, so to talk to the third started
        CellApp, telnet to 50003.</p></li><li><p><em class="emphasis">32768-61000 (Protocol: TCP, Access:
        Internal)</em></p><p>Used by CellAppMgr and CellApp for viewer applications such as
        Space Viewer. Automatically assigned by the kernel (see UDP
        entry).</p></li><li><p><em class="emphasis">32768-61000 (Protocol: UDP, Access:
        Internal [External for BaseApp])</em></p><p>Used by the server components: CellApp, CellAppMgr, BaseApp,
        BaseAppMgr, DBMgr, MessageLogger and StatLogger. Only the BaseApp has
        an external port.</p><p>Automatically assigned by the kernel, in the range of the kernel
        setting <code class="filename">/proc/sys/net/ipv4/ip_local_port_range</code>,
        which defaults to 32768-61000.</p><p>The BaseApp external port may be exempted from random
        assignment, by specifying it in the
        <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>
        file's <span class="literal">baseApp</span> section's
        <span class="literal">externalPorts/port</span> configuration options.</p><p>The port chosen can be displayed via the Watcher interface
        under:</p><div class="itemizedlist"><ul type="circle"><li><p><span class="literal">nub/address</span> for internal
            interfaces.</p></li><li><p><span class="literal">nubExternal/address</span> for the external
            interfaces on BaseApp and LoginApp.</p></li></ul></div></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Blocking_Ports_And_Related_Security_Considerations"></a>8.3.&nbsp;Blocking Ports and Related Security Considerations</h2></div></div></div><p>Since TCP/IP is not used externally, you can block all TCP traffic.
    Leave all UDP/IP ports 32768 and above open, as well as the login port
    (20013 by default). This range can be reduced if you specify possible
    ports in <span class="literal">baseApp/externalPorts/port</span> settings in
    <code class="filename">bw.xml</code>.</p><p>Use of a separate firewall machine is discouraged. The BaseApp
    machines are designed to be the firewalls themselves, and perform a very
    similar proxying function for clients. Their amount of processing is small
    enough so that they can handle a whole network adapter's worth of Internet
    traffic. Adding another machine would only be a waste of hardware,
    maintenance time, and latency. BaseApps only listen on one UDP port
    &#8212; and so the whole TCP stack can be disabled on the external
    interface. The use of standard firewall software such as iptables may be
    an appropriate way to accomplish this.</p><p>See chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_installation_guide/server_installation_guide.html#xref_Cluster_Configuration" class="olink"><i>Cluster Configuration</i></a> in the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_installation_guide/server_installation_guide.html#Server_Installation_Guide" class="olink">Server Installation Guide</a> for examples of using
    <code class="filename">iptables</code>.</p><p>Network tools such as <span><strong class="command">lsof</strong></span> and
    <span><strong class="command">netstat</strong></span> should be consulted, to ensure that you are not
    running any daemons listening on the external (or common) interface. Apart
    from BWMachined, you should not need to run any daemons with BigWorld, but
    if you wish to, then you should ensure that their ports are blocked.
    BWMachined should not listen on the external interface, only the internal
    interface.</p><p>Barring all TCP packets greatly improves the security of a BaseApp
    machine. TCP is a complicated protocol, and requires many tables and
    buffers to implement or firewall. By this rationale, the security of a
    BaseApp machine may be considered even better than that of an ordinary
    firewall, which must conditionally pass TCP packets.</p><p>To reduce exposure to DDOS attacks, it is recommended that the
    BaseApp be left to choose, within the range allocated by the operating
    system, a random port. This way, if an attacker discovers the IP and port
    of one of the BaseApp machines, then it does not mean he will
    automatically know those details for the other BaseApp machines.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_BigWorld_Server_Across_Multiple_Machines"></a>Chapter&nbsp;9.&nbsp;BigWorld Server Across Multiple Machines</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e8912">9.1. How To Start</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e8917">9.1.1. WebConsole</a></span></dt><dt><span class="section"><a href="#d0e8926">9.1.2. Auto Configuration Via
      <span class="literal">control_cluster.py</span></a></span></dt><dt><span class="section"><a href="#d0e8938">9.1.3. Hard-Coded Scripts</a></span></dt><dt><span class="section"><a href="#d0e8946">9.1.4. Manual Start</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e8951">9.2. How To Stop</a></span></dt><dt><span class="section"><a href="#d0e8967">9.3. How To Monitor</a></span></dt><dt><span class="section"><a href="#xref_LoginApp_And_Scalability">9.4. LoginApp and Scalability</a></span></dt></dl></div><p>To start a server cluster consisting of multiple machines, you can
  start each process in any of the following ways:</p><div class="itemizedlist"><ul type="disc"><li><p>the command line</p></li><li><p>the <span class="literal">control_cluster.py</span> script</p></li><li><p>WebConsole's ClusterControl module</p></li></ul></div><p>CellApps, BaseApps, and LoginApps can have multiple instances running,
  while the other processes can have only one. The clients should connect to
  the IP address of a machine that is running a LoginApp.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8912"></a>9.1.&nbsp;How To Start</h2></div></div></div><p>The following sub-sections describe how to start server
    components.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8917"></a>9.1.1.&nbsp;WebConsole</h3></div></div></div><p>WebConsole can be used to easily start, stop and control server
      components.</p><p>For an outline of WebConsole, see <a href="#xref_WebConsole" title="3.1.&nbsp;WebConsole">WebConsole</a>. For operational behaviour, see the online
      WebConsole documentation in the Cluster Control module.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8926"></a>9.1.2.&nbsp;Auto Configuration Via
      <span class="literal">control_cluster.py</span></h3></div></div></div><p>The script
      <span class="literal">bigworld/tools/server/control_cluster.py</span> is generally
      the easiest way to start a multi-machine BigWorld Server. For details,
      see <a href="#xref_control_cluster_py" title="3.4.1.&nbsp;Control Cluster">Control Cluster</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8938"></a>9.1.3.&nbsp;Hard-Coded Scripts</h3></div></div></div><p>Create your own shell scripts using the script
      <span class="literal">bigworld/tools/server/misc/startsingle.sh</span> as a
      guide.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8946"></a>9.1.4.&nbsp;Manual Start</h3></div></div></div><p>During development and testing, it is feasible to manually start
      processes individually.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8951"></a>9.2.&nbsp;How To Stop</h2></div></div></div><p>The method used to stop the system depends on the method used to
    start it. For example, calling the script
    <span class="literal">control_cluster.py</span> with the option
    <span class="literal">stop</span> stops a system started with that script. Stopping
    LoginApp triggers other processes to terminate, unless this feature is
    disabled in configuration file
    <span class="literal"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</span>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8967"></a>9.3.&nbsp;How To Monitor</h2></div></div></div><p>Use WebConsole<sup>[<a name="d0e8972" href="#ftn.d0e8972">13</a>]</sup> and <span class="literal">control_cluster.py</span><sup>[<a name="d0e8980" href="#ftn.d0e8980">14</a>]</sup> for monitoring and recording real-time statistics. You can
    also get profiling data from the watchers (via WebConsole's ClusterControl
    module). Use WebConsole's LogViewer module to monitor the centralised
    log.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_LoginApp_And_Scalability"></a>9.4.&nbsp;LoginApp and Scalability</h2></div></div></div><p>Just as you can use multiple CellApps and BaseApps in a large
    cluster, you can also run multiple LoginApps in a load sharing
    arrangement.</p><p>To do that, DNS has to set up so that it returns multiple DNS
    addresses for the login server's name. If you are using BIND, then you can
    simply put multiple A addresses in the zone configuration file. This means
    that when a client looks up the DNS address of the login server, it
    receives a login server randomly selected from the available pool.</p><p>For example, if you are using BIND as your DNS server (most Linux
    distributions come with BIND as their default DNS server), the zone file
    can have configuration similar to the ones in the table below:</p><div class="altrow"><table border="0" width="75%"><colgroup><col width="20%"><col width="20%"><col width="20%"><col width="20%"><col width="20%"></colgroup><thead><tr><th>Name</th><th>TTL</th><th><span class="literal">CLASS</span></th><th><span class="literal">TYPE</span></th><th><span class="literal">ResourceRecord</span></th></tr></thead><tbody><tr><td rowspan="3">login</td><td>600</td><td>IN</td><td>A</td><td>10.0.0.1</td></tr><tr><td>600</td><td>IN</td><td>A</td><td>10.0.0.2</td></tr><tr><td>600</td><td>IN</td><td>A</td><td>10.0.0.3</td></tr></tbody></table></div><p><span class="citetitle">Example configuration on a BIND zone
    file</span></p><p>Because there are multiple A records with different IP addresses
    under one name, the IP address returned to a client when it looks up the
    address for the login server will be picked up from the IP address list,
    in a round robin manner.</p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e8972" href="#d0e8972">13</a>] </sup>For details, see <a href="#xref_WebConsole" title="3.1.&nbsp;WebConsole">WebConsole</a>.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e8980" href="#d0e8980">14</a>] </sup>For details, see <a href="#xref_control_cluster_py" title="3.4.1.&nbsp;Control Cluster">Control Cluster</a>.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Multiple_BigWorld_Servers_In_A_Single_LAN"></a>Chapter&nbsp;10.&nbsp;Multiple BigWorld Servers in a Single LAN</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e9057">10.1. Keeping Processes Separate</a></span></dt><dt><span class="section"><a href="#d0e9067">10.2. Centralised Cluster Monitoring</a></span></dt><dt><span class="section"><a href="#xref_Auto_Detections_Of_LoginApps">10.3. Auto-Detection of LoginApps</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9057"></a>10.1.&nbsp;Keeping Processes Separate</h2></div></div></div><p>All server components in a BigWorld server cluster run under the
    same UID. If you want to run multiple server clusters on the same network,
    as can be required for different stages of testing, then make sure that
    you use different UIDs.</p><p>You also need to make sure that the LoginApps are on different
    machines. This is because by default each LoginApp opens the same specific
    port, and therefore only one could succeed in binding to it.
    Alternatively, multiple LoginApps can be run on a single machine as long
    as they have different port settings in &lt;res&gt;/server/bw.xml.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>It is important the username and UID mapping is consistent across
      all machines on the cluster. It is highly recommended to use centralised
      logins using LDAP or similar.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9067"></a>10.2.&nbsp;Centralised Cluster Monitoring</h2></div></div></div><p>The best way to keep track of processes is via WebConsole's
    StatGrapher module.</p><p>The module, which can be run on any web browser, uses log files
    generated by StatLogger daemon to display statistics, and has a variety of
    options to filter the output by user.</p><p>For more details, see <a href="#xref_WebConsole_StatGrapher" title="3.1.1.4.&nbsp;StatGrapher">StatGrapher</a>,
    and <a href="#xref_StatLogger" title="3.3.&nbsp;StatLogger">StatLogger</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Auto_Detections_Of_LoginApps"></a>10.3.&nbsp;Auto-Detection of LoginApps</h2></div></div></div><p>When running multiple servers, it is convenient for the client to
    auto-detect LoginApp processes (this is only suitable for a development
    environment).</p><p>The LoginApps have this functionality built in, and do not require
    any configuration to perform it &#8212; they register themselves with
    BWMachined, and the client broadcasts a 'find' message to retrieve their
    contact details. A probe message is then sent to each server to determine
    who, where and what it is running. This functionality is implemented on
    the client by class <span class="literal">ServerDiscovery</span>.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_DBMgr_MySQL_Support"></a>Chapter&nbsp;11.&nbsp;MySQL Support</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#xref_Compiling_DBMgr_With_MySQL_Support">11.1. Compiling DBMgr with MySQL Support</a></span></dt><dt><span class="section"><a href="#d0e9133">11.2. Update <code class="filename">bw.xml</code> To Use MySQL</a></span></dt><dt><span class="section"><a href="#xref_Initialise_Database_With_Entity_Definitions">11.3. Synchronise Database With Entity Definitions</a></span></dt><dt><span class="section"><a href="#xref_Enabling_Secondary_Databases">11.4. Enabling Secondary Databases</a></span></dt><dt><span class="section"><a href="#xref_MySQL_Privileges">11.5. Privileges</a></span></dt><dt><span class="section"><a href="#d0e9332">11.6. The ClearAutoLoad tool</a></span></dt></dl></div><p>Following is described the minimal set of steps required to enable
  MySQL support for a server cluster. They assume that a MySQL database has
  been installed and configured as outlined in the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_installation_guide/server_installation_guide.html#Server_Installation_Guide" class="olink">Server Installation Guide</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_installation_guide/server_installation_guide.html#xref_Installing_The_BigWorld_Server" class="olink"><i>Installing the BigWorld Server</i></a>, section <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_installation_guide/server_installation_guide.html#xref_Configure_MySQL_Server" class="olink">Configure MySQL Server</a>.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Compiling_DBMgr_With_MySQL_Support"></a>11.1.&nbsp;Compiling DBMgr with MySQL Support</h2></div></div></div><p>The DBMgr binary provided with the default BigWorld package does not
    have MySQL support built-in. This allows users to quickly start using
    BigWorld Technology without having to configure a production database to
    test a simple package. See the licensing_information.txt document for
    MySQL licensing considerations.</p><p>First, to enable compilation of DBMgr, make sure that the MySQL
    development files are installed on the build system. To do this, as root,
    run the following command:</p><pre class="programlisting"># yum install mysql-devel</pre><p>Next, the DBMgr makefile needs to be modified, to enable MySQL
    support. Edit <code class="filename">bigworld/src/server/dbmgr/Makefile</code> and
    change the variable definition from <em class="emphasis"><span class="literal">USE_MYSQL=0</span></em> to <em class="emphasis"><span class="literal">USE_MYSQL=1</span></em>. When enabling MySQL
    the <span class="literal">USE_XML</span> option can be left enabled without any
    adverse side effects.</p><p>After these alterations, it will be possible to rebuild DBMgr. From
    within the <code class="filename">bigworld/src/server/dbmgr</code> directory, issue the
    following command:</p><pre class="programlisting">$ make</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9133"></a>11.2.&nbsp;Update <code class="filename">bw.xml</code> To Use MySQL</h2></div></div></div><p>Once DBMgr has been compiled to communicate with a MySQL server, the
    game resource configuration file
    <code class="filename"><em class="replaceable"><code>&lt;res&gt;</code></em>/server/bw.xml</code>
    needs to be updated with details on <code class="property">username</code>,
    <code class="property">password</code> and the <code class="property">host</code> machine
    the MySQL server is running on.</p><p>The example below illustrates FantasyDemo configuration (via
    <code class="filename">fantasydemo/res/server/bw.xml</code>):</p><pre class="programlisting">&lt;dbMgr&gt;
    &lt;type&gt;     mysql                     &lt;/type&gt;
    &lt;host&gt;     my_mysql_server_machine &lt;/host&gt;
    &lt;username&gt; bigworld &lt;/username&gt;
    &lt;password&gt; my_pass &lt;/password&gt;
    &lt;databaseName&gt;     fantasydemo &lt;/databaseName&gt;
&lt;/dbMgr&gt;</pre><p><span class="citetitle">Example
    <code class="filename">fantasydemo/res/server/bw.xml</code></span></p><p>For details on these fields and other relevant configuration options
    for your production environment, see <a href="#xref_Server_Configuration_With_bw_xml" title="Chapter&nbsp;2.&nbsp;Server Configuration with bw.xml"><i xmlns:xlink="http://www.w3.org/1999/xlink">Server Configuration with <span class="literal">bw.xml</span></i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Initialise_Database_With_Entity_Definitions"></a>11.3.&nbsp;Synchronise Database With Entity Definitions</h2></div></div></div><p>DBMgr requires the MySQL database table structure to be synchronised
    with the current entity definitions. To initialise the MySQL database with
    the correct table structure run the <span class="literal">sync_db</span>
    tool:</p><pre class="programlisting">$ <em class="replaceable"><code>$MF_ROOT</code></em>/bigworld/bin/Hybrid64/commands/sync_db</pre><p>This tool will not run if there are unconsolidated secondary
    databases. For details on data consolidation, see <a href="#xref_Data_Consolidation_Tool" title="5.3.&nbsp;Data Consolidation Tool">Data Consolidation Tool</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>A SyncDB binary is not shipped by default with BigWorld releases.
      In order to use SyncDB you will need to compile the binary from
      <code class="filename">bigworld/src/server/tools/sync_db</code>, or have
	  already built DBMgr with MySQL support enabled.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Enabling_Secondary_Databases"></a>11.4.&nbsp;Enabling Secondary Databases</h2></div></div></div><p>Secondary databases can only be enabled when MySQL support is
    enabled. Please see the document <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#Server_Programming_Guide" class="olink">Server Programming Guide</a>'s chapter <a xmlns:xlink="http://www.w3.org/1999/xlink" href="../server_programming_guide/server_programming_guide.html#xref_Secondary_Databases" class="olink">Secondary Databases</a> for details about secondary
    databases.</p><p>To enable secondary database support, you must:</p><div class="itemizedlist"><ul type="disc"><li><p>Enable MySQL support (see above).</p></li><li><p>Build the data consolidation tool by issuing the
          <span><strong class="command">make</strong></span> command from within the <code class="filename">bigworld/src/server/tools/consolidate_dbs</code>
          directory.</p></li><li><p>Set the <code class="filename">bw.xml</code> option
          <code class="property">&lt;baseApp&gt;/&lt;secondaryDB&gt;/&lt;enable&gt;</code>
          to <span class="literal">true</span>.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_MySQL_Privileges"></a>11.5.&nbsp;Privileges</h2></div></div></div><p>Below are the MySQL privileges required for each BigWorld component
    that communicates with a MySQL database.</p><div class="altrow"><table border="0"><colgroup><col width="15%"><col width="37%"><col width="48%"></colgroup><thead><tr><th>Component</th><th>Required Privileges</th><th>User</th></tr></thead><tbody><tr><td>DBMgr</td><td>SELECT, INSERT, UPDATE, DELETE</td><td><p>dbMgr/username</p><p>(<code class="filename">bw.xml</code>)</p></td></tr><tr><td>sync_db</td><td>UPDATE, ALTER, CREATE, DROP, INDEX</td><td><p>dbMgr/username</p><p>(<code class="filename">bw.xml</code>)</p></td></tr><tr><td>snapshot.py</td><td>SELECT</td><td><p>dbMgr/username</p><p>(<code class="filename">bw.xml</code>)</p></td></tr><tr><td>snapshot_helper</td><td>RELOAD</td><td><p>dbMgr/username</p><p>(<code class="filename">bw.xml</code>)</p></td></tr><tr><td>StatLogger</td><td>SELECT, INSERT, UPDATE, DELETE, CREATE</td><td><p>preferences/options/dbUser</p><p>(<code class="filename">bigworld/tools/server/stat_logger/preferences.xml</code>)</p></td></tr><tr><td>WebConsole</td><td>SELECT, INSERT, UPDATE, DELETE, CREATE</td><td><p>sqlobject.dburiame</p><p>(<code class="filename">bigworld/tools/server/web_console/[dev|prod].cfg</code>)</p></td></tr></tbody></table></div><p>Use MySQL's GRANT command to set privileges for a user.</p><pre class="programlisting">$ mysql -u root
mysql&gt; GRANT SELECT, INSERT, UPDATE, DELETE ON fantasydemo.* TO 'bigworld'@'localhost' IDENTIFIED BY 'bigworld_passwd';</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9332"></a>11.6.&nbsp;The ClearAutoLoad tool</h2></div></div></div><p>Over the course of a server run, entities may be marked for
    auto-loading so that subsequent server startups will automatically create
    these entities and the spaces that they inhabited, with the entity data
    and space data that was present in those spaces at the time that the
    server was shut down. Additionally, the server game time is
    persistent.</p><p>It is sometimes desirable to clear that data so that the server
    starts from a clean slate without auto-loading any entity data, and reset
    the server game time to 0. There is a command tool called
    <span><strong class="command">clear_auto_load</strong></span> which can clear this data. It is
    located in
    <code class="filename">bigworld/bin/Hybrid64/commands/clear_auto_load</code>.
    Running it without command line arguments will clear the auto-load data in
    the database specified in the <code class="filename">bw.xml</code> for the current
    user.</p><pre class="programlisting">$ bigworld/bin/Hybrid64/commands/clear_auto_load</pre><p>You cannot run this tool while there is an instance of DBMgr or
    other BigWorld tool accessing the database.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>A ClearAutoLoad binary is not shipped by default with BigWorld
      releases. In order to use ClearAutoLoad you will need to compile the
      binary from <code class="filename">bigworld/src/server/tools/clear_auto_load</code>.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_RPM"></a>Chapter&nbsp;12.&nbsp;RPM</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e9390">12.1. Directory Structures and Files</a></span></dt><dt><span class="section"><a href="#d0e9426">12.2. How to Generate Binary RPM Packages</a></span></dt><dt><span class="section"><a href="#d0e9521">12.3. Customising RPM Packages</a></span></dt><dt><span class="section"><a href="#d0e9597">12.4. Setting up a Yum Repository</a></span></dt><dt><span class="section"><a href="#d0e9710">12.5. Install, Upgrade and Uninstall using Yum Command</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9718">12.5.1. Install and Upgrade using a RPM Package Directly</a></span></dt><dt><span class="section"><a href="#d0e9751">12.5.2. Install and Upgrade using Yum Repository</a></span></dt><dt><span class="section"><a href="#d0e9765">12.5.3. Remove an Installed Package</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e9772">12.6. How to Obtain Version Number of an Installed Package</a></span></dt></dl></div><p>BigWorld provides a RPM implementation which allows the creation of
  binary RPM package for BWMachined. The RPM implementation uses the RPM
  system available in Linux distributions such as CentOS, RHEL and Fedora to
  generate RPM packages.</p><p>This chapter provides the following information:</p><div class="itemizedlist"><ul type="disc"><li><p>Directory structure and files related to BigWorld RPM
      implementation.</p></li><li><p>How to generate BigWorld binary RPM packages.</p></li><li><p>Customising RPM Packages.</p></li><li><p>Setting up a <span class="literal">yum</span> repository.</p></li><li><p>Install, upgrade and uninstall using <code class="code">yum</code>
      command.</p></li><li><p>How to obtain version number of an installed package.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9390"></a>12.1.&nbsp;Directory Structures and Files</h2></div></div></div><p>The RPM implementation is located in the <code class="filename">bigworld/tools/server/rpm</code> directory:</p><div class="itemizedlist"><ul type="disc"><li><p>The <code class="filename">Makefile
        </code>is used to generate RPM packages.</p></li><li><p>The <code class="filename">generate.py</code> is used to
        facilitate the creation of RPM packages.</p></li><li><p>The <code class="filename">binary_rpms</code> directory
        is where generated RPM packages are placed.</p></li><li><p>The <code class="filename">rpm</code> directory also
        contains package specific directories. For example, the <code class="filename">bwmachined</code> directory contains all the
        files specific to BWMachined.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9426"></a>12.2.&nbsp;How to Generate Binary RPM Packages</h2></div></div></div><p>Binary RPM packages must be generated using a normal Unix user
    account. Binary RPM packages must not be generated using the root
    user.</p><p>In order to allow RPM's to be built into a user writeable directory,
    it is necessary to modify the user's <code class="filename">.rpmmacros</code> file.
    This file will contain the location of the directories in which the RPM
    files will be built. Firstly we need to create the directory structure to
    use. For this example we will create a new directory in the user's home
    directory called <code class="filename">rpmbuild</code>. We also
    require an <code class="filename">RPMS</code> subdirectory where
    package files will be placed.</p><pre class="programlisting">$ mkdir -p ~/rpmbuild/RPMS</pre><p>Next we need to let the rpm build environment know how to use that
    directory. This simply involves creating a new user specific rpm macro
    file as follows.</p><pre class="programlisting">$ vim ~/.rpmmacros</pre><p>Copy and paste the following content into the
    <code class="filename">.rpmmacros</code> file.</p><pre class="programlisting">%_topdir /home/<em class="replaceable"><code>username</code></em>/rpmbuild
%_tmppath %{_topdir}/tmp</pre><p>Write and close this file. To confirm the change you made has been
    successful, run the following command to ensure the path looks
    correct.</p><pre class="programlisting">$ rpm --eval %_topdir</pre><p>To generate RPM package for BWMachined, go to the <code class="filename">bigworld/tools/server/rpm</code> directory and run
    the following command:</p><pre class="programlisting">$ make</pre><p>The generated RPM package will be placed in the <code class="filename">bigworld/tools/server/rpm/binary_rpms</code>
    directory.</p><p>The generated RPM package will have the following file name:</p><pre class="programlisting">bigworld-bwmachined-<em class="replaceable"><code>&lt;version&gt;</code></em>-<em class="replaceable"><code>&lt;release&gt;</code></em>.<em class="replaceable"><code>&lt;architecture&gt;</code></em>.rpm </pre><div class="itemizedlist"><ul type="disc"><li><p>The <em class="replaceable"><code>&lt;version&gt;</code></em> field is the
        version number of the BigWorld release that the package was generated
        from. This field is based on the version number in <code class="filename">bigworld/res/version.xml</code>.</p></li><li><p>The <em class="replaceable"><code>&lt;release&gt;</code></em> field identifies
        the specific build of this RPM package. By default, it is not used and
        is mapped to <span class="literal">patch</span> number in <code class="filename">bigworld/res/version.xml</code>.</p></li><li><p>The <em class="replaceable"><code>&lt;architecture&gt;</code></em> field will
        be either <span class="literal">i386</span> for 32 bit systems, or
        <span class="literal">x86_64</span> for 64 bit installations.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9521"></a>12.3.&nbsp;Customising RPM Packages</h2></div></div></div><p>The most common customisation of a RPM package is the configuration
    file(s) installed by the package. That is, one RPM package may include the
    default configuration file and another may include a customised
    configuration file. These RPM packages can be distinguished by using the
    <span class="literal">release</span> field in the filename of these packages.</p><p>For example, the configuration file included in a BWMachined RPM
    package is located in <code class="filename">rpm/bwmachined/bwmachined.conf</code>.</p><p>To generate a BWMachined RPM package with the default configuration
    file and assign it the <span class="literal">release</span> number
    <span class="literal">0</span>:</p><div class="itemizedlist"><ul type="disc"><li><p>Use the <code class="filename">bwmachined.conf</code> provided by
        default.</p></li><li><p>Update the <code class="code">Release</code> tag in <code class="filename">rpm/bwmachined/bwmachined_template.spec
        </code>to the following:</p><pre class="programlisting">Release: 0</pre></li><li><p>Generate the RPM package.</p></li></ul></div><p>The file name of the RPM package generated will be, for example,
    <code class="filename">bigworld-bwmachined-1.9.1.0-0.i386.rpm</code>.</p><p>To generate a BWMachined RPM package with customised configuration
    file and assign it the <span class="literal">release</span> number
    <span class="literal">1</span>:</p><div class="itemizedlist"><ul type="disc"><li><p>Update the bwmachined.conf as required.</p></li><li><p>Update the <code class="code">Release</code> tag to
        <span class="literal">1</span>.</p></li><li><p>Generate the RPM package.</p></li></ul></div><p>The file name of the RPM package generated will be, for example,
    <code class="filename">bigworld-bwmachined-1.9.1.0-1.i386.rpm</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9597"></a>12.4.&nbsp;Setting up a Yum Repository</h2></div></div></div><p>For a large environment where RPM Packages, e.g. the BWMachined RPM
    Package, need to be installed on many machines, we recommend that a Yum
    repository to be set up to provide these RPM packages. This allows an RPM
    package to be installed on any machine in the cluster by running the
    <span><strong class="command">yum</strong></span> command without the need to manually copy the RPM
    package to each machine in the cluster.</p><p>The Yum repository created will need to be made available through a
    web server such as the <span class="literal">Apache HTTP Server</span>. The setup
    required is outside the scope of this document. Please consult relevant
    web server documentation on how to achieve this.</p><p>Steps to set up a Yum repository:</p><div class="itemizedlist"><ul type="disc"><li><p>On the machine that will be hosting the Yum repository, create a
        directory for the BigWorld RPM packages. The location of this
        directory will depend on the web server chosen and the web server
        configuration which is outside the scope of this document.</p></li><li><p>Copy the RPM packages to the directory created.</p></li><li><p>Install the <span class="literal"><span class="literal">createrepo</span></span>
        package using the following command:</p><pre class="programlisting">$ yum install createrepo</pre><p>This is a utility that will generate a common metadata
        repository from a directory of RPM packages.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>You will need to be the <span class="literal">root</span> user to
          install a package.</p></div></li><li><p>Run the following command to create the necessary metadata for
        the <span class="literal">yum</span> repository:</p><pre class="programlisting">$ createrepo &lt;path_to_dir&gt;</pre><p>where <em class="replaceable"><code>&lt;path_to_dir&gt;</code></em> is the path
        to the directory created.</p><p>For example, if the directory created is <code class="filename">/mnt/bigworld_repo</code>, then the command to
        run is the following:</p><pre class="programlisting">$ createrepo /mnt/bigworld_repo</pre><p>This creates a <code class="filename">repodata</code>
        directory in the <code class="filename">/mnt/bigworld_repo
        </code>directory.</p></li><li><p>The <code class="filename">/etc/yum.conf</code> on a machine that will
        access the repository created will need to be updated to include the
        following setting:</p><pre class="programlisting">[&lt;repo_name&gt;]
name=&lt;repo_name&gt;
baseurl=&lt;url_to_repo&gt;
enabled=1</pre><p>where &lt;repo_name&gt; is replaced by the name given to the
        repository and &lt;url_to_repo&gt; is replaced by the URL that refers
        to the repository.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>By default, the <code class="filename">/etc/yum.conf</code> contains a
          <span class="literal">[main]</span> entry. The entry above should be added
          after the <span class="literal">[main]</span> entry.</p></div></li></ul></div><p>When the <span class="literal">yum</span> repository is updated, for example,
    a new version of BWMachined RPM package is added, then the <code class="filename">repodata</code> directory should be deleted and the
    <code class="code">createrepo</code> command should be run again to generate up-to-date
    metadata.</p><p>If a new RPM package was added to the repository but is not
    displayed on a machine when running a query command such as</p><pre class="programlisting">$ yum info bigworld-bwmachined</pre><p>run the following command to delete the metadata used by Yum to
    determine the remote availability of packages:</p><pre class="programlisting">$ yum clean metadata</pre><p>When the <span><strong class="command">yum</strong></span> command is run the next time, it
    will download the up-to-date metadata.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9710"></a>12.5.&nbsp;Install, Upgrade and Uninstall using Yum Command</h2></div></div></div><p>This section describes how to install, upgrade and uninstall using
    the <span><strong class="command">yum</strong></span> command. The BWMachined package is used as an
    example.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9718"></a>12.5.1.&nbsp;Install and Upgrade using a RPM Package Directly</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>To install a RPM Package directly without using
          <span class="literal">yum</span> repository:</p><pre class="programlisting">$ yum --nogpgcheck install bigworld-bwmachined-&lt;version&gt;-&lt;release&gt;.i386.rpm</pre><p>where <em class="replaceable"><code>&lt;version&gt;</code></em> and
          <em class="replaceable"><code>&lt;release&gt;</code></em> are replaced by the
          actual version and release number.</p><p>This assumes that you are running the Yum command in a
          directory containing the specified <code class="filename">.rpm</code> file.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The RPM packages created by BigWorld RPM implementation are
            not signed, since these packages are from trusted source.
            Therefore, during installation and upgrade, GPG check is
            disabled.</p></div></li><li><p>To upgrade a package:</p><pre class="programlisting">$ yum --nogpgcheck upgrade bigworld-bwmachined-&lt;version&gt;-&lt;release&gt;.i386.rpm</pre></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9751"></a>12.5.2.&nbsp;Install and Upgrade using Yum Repository</h3></div></div></div><div class="itemizedlist"><ul type="disc"><li><p>To install a package from a Yum repository:</p><pre class="programlisting">$ yum --nogpgcheck install bigworld-bwmachined</pre></li><li><p>To upgrade a package:</p><pre class="programlisting">$ yum --nogpgcheck upgrade bigworld-bwmachined</pre></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9765"></a>12.5.3.&nbsp;Remove an Installed Package</h3></div></div></div><p>To remove an installed package:</p><pre class="programlisting">$ yum remove bigworld-bwmachined</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9772"></a>12.6.&nbsp;How to Obtain Version Number of an Installed Package</h2></div></div></div><p>To obtain the version number of an installed package such as the
    BWMachined package, run the following command:</p><pre class="programlisting">$ yum info bigworld-bwmachined</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_First_Aid_After_Crash"></a>Chapter&nbsp;13.&nbsp;First Aid After a Crash</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e9811">13.1. Change your coredump output directory, if necessary</a></span></dt><dt><span class="section"><a href="#d0e9842">13.2. Determine the first process(es) that crashed</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9854">13.2.1. BigWorld logs</a></span></dt><dt><span class="section"><a href="#d0e9868">13.2.2. Chronologically listing core files</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Generate_Stack_Trace">13.3. Generate a stack trace of the process that crashed</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9927">13.3.1. Troubleshooting</a></span></dt></dl></dd><dt><span class="section"><a href="#xref_Retrieve_Crash_Logs">13.4. Retrieve relevant log information</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e9960">13.4.1. Generating a log summary from a core file</a></span></dt><dt><span class="section"><a href="#d0e9975">13.4.2. Archiving all logs</a></span></dt></dl></dd><dt><span class="section"><a href="#d0e9989">13.5. Back up the crash information</a></span></dt><dt><span class="section"><a href="#d0e10030">13.6. Notify BigWorld Support of the crash</a></span></dt><dd><dl><dt><span class="section"><a href="#d0e10061">13.6.1. Uploading large files</a></span></dt><dt><span class="section"><a href="#d0e10083">13.6.2. Providing BigWorld access to your server cluster</a></span></dt></dl></dd></dl></div><p>If a BigWorld server component fails there are some steps that you
  should follow to assist BigWorld in identifying and resolve the problem as
  quickly as possible. These steps are outlined briefly below.</p><div class="itemizedlist"><ul type="disc"><li><p>Change your coredump output directory, if necessary.</p></li><li><p>Determine the first process(es) that crashed.</p></li><li><p>Generate a stack trace of the process that crashed.</p></li><li><p>Retrieve relevant log information.</p></li><li><p>Back up the crash information.</p></li><li><p>Notify BigWorld Support of the crash.</p></li></ul></div><p>A crash may be either an intentional event such as an
  <span class="literal">assert</span>, or unintentional event such as segmentation
  fault. Whenever a crash occurs a core file should be written to the
  <code class="filename">bigworld/bin/Hybrid64</code> directory (or
  equivalent directory in your system). These files provide a complete dump of
  the memory in use by the process at the time the failure occurred and allows
  deep investigation as to the state of the program which is often necessary
  to determine the cause of a problem.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9811"></a>13.1.&nbsp;Change your coredump output directory, if necessary</h2></div></div></div><p>By default, processes that crash will output a coredump into their
    current working directory, which is generally the directory where the
    binaries reside. This directory may need to be changed if the user running
    the server does not have sufficient permissions to write to that
    directory. This may be the case if you have installed using RPM
    packages.</p><p>The output path can be temporarily changed by writing the new output
    path and the core file pattern to
    <code class="filename">/proc/sys/kernel/core_pattern</code>. Note that this will
    change the coredump output path for all processes (not just BigWorld
    processes) dumping core on that machine.</p><p>For example, a command similar to the following can be used
    (executed as the root user):</p><pre class="programlisting">$ echo "/your/path/here/core.%e.%h.%p" &gt; /proc/sys/kernel/core_pattern</pre><p>Note that the change is only temporary and will not persist across
    machine restarts.</p><p>If a more permanent setting is required, there is the
    <code class="varname">CORE_PATH</code> shell variable defined in the BWMachined init
    script that can be set to a suitable output directory. For example, it can
    be set like this:</p><pre class="programlisting">CORE_PATH=/your/path/here</pre><p>The init script is located at<code class="filename">
    /etc/init.d/bwmachined2</code>. Note that after modifying
    <code class="varname">CORE_PATH</code>, the BWMachined service will need to be
    restarted for the changes to take effect.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9842"></a>13.2.&nbsp;Determine the first process(es) that crashed</h2></div></div></div><p>When diagnosing a crash it is important to find the first process
    that crashed if there have been multiple process failures. In most
    scenarios multiple crashes occur due to a single failure that then
    propagates through the cluster, so it is important to identify where the
    failure started. There are two methods which can be used to achieve
    this.</p><div class="itemizedlist"><ul type="disc"><li><p>BigWorld logs.</p></li><li><p>Chronologically listing core files.</p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9854"></a>13.2.1.&nbsp;BigWorld logs</h3></div></div></div><p>Whenever a crash occurs the logs should always be investigated as
      a first step to check for any known problems or obvious errors that may
      have occurred. When an issue has been identified, searching around the
      time period for <span class="literal">CRITICAL</span> and <span class="literal">ERROR</span>
      messages can help quickly identify the set of processes that failed.
      Searching through the logs can be performed either via WebConsole and
      LogViewer, or via the command line utility
      <code class="filename">mlcat.py</code>. Using the command line utility provides
      more flexibility for saving logs to a file which can then be collected
      and sent as part of a BigWorld support ticket.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9868"></a>13.2.2.&nbsp;Chronologically listing core files</h3></div></div></div><p>If a process failure occurs due to a non-assertion failure case
      you may find no obvious <span class="literal">CRITICAL</span> or
      <span class="literal">ERROR</span> messages appear in the server logs. In this
      circumstance you will need to search all of the server binary
      directories within your cluster to find the core files relating to a
      crash. This sort of operation will generally require a custom script
      that is suited for your environment as a cluster with hundreds of
      machines can be time consuming to examine.</p><p>The easiest way to perform this kind of search is to simply
      <span><strong class="command">ssh</strong></span> to all the server machines in the cluster and
      perform a directory listing. Below is the output of a simple
      chronologically sorted directory listing showing a sequence of core
      files.</p><pre class="programlisting">$ cd bigworld/bin/Hybrid64
$ ls -lt
...
-rw------- 1 game Company 124305408 Jan  7 10:17 core.cellapp.pc242.3030
-rw-r--r-- 1 game Company       275 Jan  7 10:16 assert.cellapp.pc242.3030.log
-rw------- 1 game Company  67174400 Jan  7 10:16 core.baseapp.pc242.3024
-rw------- 1 game Company  21635072 Jan  7 10:16 core.cellappmgr.pc242.3018
-rw-r--r-- 1 game Company       167 Jan  7 10:15 assert.baseapp.pc242.3024.log
-rw-r--r-- 1 game Company       166 Jan  7 10:15 assert.cellappmgr.pc242.3018.log
-rw------- 1 game Company 125972480 Jan  6 09:48 core.cellapp.pc242.600
-rw-r--r-- 1 game Company       275 Jan  6 09:48 assert.cellapp.pc242.600.log
-rw------- 1 game Company  21753856 Jan  6 09:47 core.cellappmgr.pc242.596
-rw-r--r-- 1 game Company       165 Jan  6 09:47 assert.cellappmgr.pc242.596.log
-rw------- 1 game Company  62255104 Jan  5 15:49 core.baseapp.pc242.601
-rw-r--r-- 1 game Company       275 Jan  5 15:49 assert.baseapp.pc242.601.log</pre><p>From the above example you can see there are 3 separate core files
      that have been generated on Jan 7th. As we are interested in the
      earliest crash we look at the two assertions from 10:15 which are for
      CellAppMgr and BaseApp. We then use these assertion files to find the
      corresponding core files using the PIDs 3018 and 3024. Thus the core
      files we are interested in investigating are:</p><div class="itemizedlist"><ul type="disc"><li><p>core.baseapp.pc242.3024</p></li><li><p>core.cellappmgr.pc242.3018</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Generate_Stack_Trace"></a>13.3.&nbsp;Generate a stack trace of the process that crashed</h2></div></div></div><p>As you can see from the directory listing in the previous section,
    core files can be extremely large. One of the most effective ways of
    notifying BigWorld of a crash is to generate a simple text stack trace of
    the crash. This can be performed by using the GNU Debugger program
    <span><strong class="command">gdb</strong></span>. For example using the BaseApp core file from the
    previous section we generate a stack trace as follows:</p><p>Load the BaseApp binary and core file into GDB.</p><pre class="programlisting">$ gdb baseapp core.baseapp.pc242.3024
GNU gdb (GDB) 7.0
Copyright (C) 2009 Free Software Foundation, Inc.
...
Core was generated by `/home/game/game_dir/bigworld/bin/Hybrid64/baseapp -machined --res /home/gam'.
Program terminated with signal 11, Segmentation fault.
#0  DebugMsgHelper::criticalMessageHelper (this=&lt;value optimized out&gt;, isDevAssertion=&lt;value optimized out&gt;, format=&lt;value optimized out&gt;, argPtr=&lt;value optimized out&gt;) at debug.cpp:321
321             *(int*)NULL = 0;
(gdb)</pre><p>Use the <span class="literal">bt</span> (backtrace) command to generate a
    stack trace.</p><pre class="programlisting">(gdb) bt
#0  DebugMsgHelper::criticalMessageHelper (this=&lt;value optimized out&gt;, isDevAssertion=&lt;value optimized out&gt;, format=&lt;value optimized out&gt;, argPtr=&lt;value optimized out&gt;) at debug.cpp:321
#1  0x000000000087882d in DebugMsgHelper::criticalMessage (this=0x2aaab4000020, format=0x2aaab4000078 "\020\326_\265\252*") at debug.cpp:128
#2  0x00000000007ce56c in Mercury::Channel::checkOverflowErrors (this=0x1b2e3120) at channel.cpp:460
#3  0x00000000007d16f1 in Mercury::Channel::addResendTimer (this=0x1b2e3120, seq=&lt;value optimized out&gt;, p=0x2aaab55fc240, roBeg=0x0, roEnd=&lt;value optimized out&gt;) at channel.cpp:898
#4  0x00000000007f8808 in Mercury::NetworkInterface::send (this=0x7fff6b280320, address=..., bundle=..., pChannel=0x1b2e3120) at network_interface.cpp:1095
#5  0x00000000007d060b in Mercury::Channel::send (this=0x1b2e3120, pBundle=0x1b2e2f50) at channel.cpp:769
#6  0x00000000005373c0 in Mercury::ChannelOwner::send (this=0x7fff6b27b950, arg=&lt;value optimized out&gt;) at channel_owner.hpp:33
#7  BaseApp::handleTimeout (this=0x7fff6b27b950, arg=&lt;value optimized out&gt;) at baseapp.cpp:4693
#8  0x00000000007da7cd in TimeQueueT&lt;unsigned long&gt;::Node::triggerTimer (this=0x1b2a7400, now=254536585659057) at time_queue.ipp:402
#9  TimeQueueT&lt;unsigned long&gt;::process (this=0x1b2a7400, now=254536585659057) at time_queue.ipp:184
#10 0x00000000007d9b16 in Mercury::EventDispatcher::processTimers (this=0x7fff6b27c1c0) at event_dispatcher.cpp:408
#11 0x00000000007d9c38 in Mercury::EventDispatcher::processOnce (this=0x7fff6b27c1c0, shouldIdle=true) at event_dispatcher.cpp:580
#12 0x00000000007d9c54 in Mercury::EventDispatcher::processContinuously (this=0x2aaab4000020) at event_dispatcher.cpp:564
#13 0x00000000007d9c69 in Mercury::EventDispatcher::processUntilBreak (this=0x2aaab4000020) at event_dispatcher.cpp:598
#14 0x000000000054ddbe in BaseApp::run (this=0x7fff6b27b950, argc=&lt;value optimized out&gt;, argv=&lt;value optimized out&gt;) at baseapp.cpp:1125
#15 0x000000000051a0eb in doMain (dispatcher=&lt;value optimized out&gt;, interface=&lt;value optimized out&gt;, argc=4, argv=0x7fff6b280b58) at main.cpp:47
#16 0x000000000051aa65 in bwMain (argc=4, argv=0x7fff6b280b58) at main.cpp:70
#17 0x000000000051b048 in main (argc=4, argv=0x7fff6b280b58) at main.cpp:60</pre><p>Quit <span><strong class="command">gdb</strong></span>.</p><pre class="programlisting">(gdb) quit</pre><p>The stack trace can then be copy and pasted into a separate text
    file and stored along with the other report information for the
    crash.</p><p>It is also possible to perform this step in one quick operation by
    issuing a command similar to the following:</p><pre class="programlisting">$ gdb -ex 'bt' -ex 'q' baseapp core.baseapp.pc242.3024 &gt; core.baseapp.pc242.3024.backtrace</pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9927"></a>13.3.1.&nbsp;Troubleshooting</h3></div></div></div><p>It is useful to identify when a bad / invalid stack trace has been
      generated. These can be caused by a number of issues such:</p><div class="itemizedlist"><ul type="disc"><li><p>Process binary has been modified since the core file was
          generated.</p></li><li><p>Core file or binary is corrupt.</p></li><li><p>Architecture of the core file and process binary do not
          match.</p></li></ul></div><p>Below is an example of an invalid stack trace that has been
      generated by GDB.</p><pre class="programlisting">$ gdb baseapp core.baseapp
...
warning: exec file is newer than core file.
[New Thread 7384]
[New Thread 7368]
Program terminated with signal 11, Segmentation fault.
#0  0x00000000008753d1 in MemberWatcher&lt;double, StatWithRatesOfChange&lt;unsigned int&gt;, double&gt;::getAsString (this=0x7fff13a189bf, base=0x1, path=&lt;value optimized out&gt;, result=..., desc=..., mode=@0x2e99d)
    at watcher.hpp:1846
1846                            RETURN_TYPE value = (useObject.*getMethod_)();
(gdb)</pre><p>You can see here that the initial loading of the file is warning
      us that the BaseApp executable is newer than the core file that is being
      examined. This can indicate that the binary has been recompiled and no
      longer corresponds to the core file. If we continue to examine the core
      file we see the following output:</p><pre class="programlisting">(gdb) bt
#0  0x00000000008753d1 in MemberWatcher&lt;double, StatWithRatesOfChange&lt;unsigned int&gt;, double&gt;::getAsString (this=0x7fff13a189bf, base=0x1, path=&lt;value optimized out&gt;, result=..., desc=..., mode=@0x2e99d)
    at watcher.hpp:1846
#1  0x616d732030373039 in ?? ()
#2  0x71655374754f6c6c in ?? ()
#3  0x383039313d5f7441 in ?? ()
#4  0x65646c6f202c3737 in ?? ()
#5  0x656b63616e557473 in ?? ()
#6  0x38313d5f71655364 in ?? ()
#7  0x6e69772032383736 in ?? ()
#8  0x5f657a6953776f64 in ?? ()
#9  0x6d202c363930343d in ?? ()
#10 0x6c667265764f7861 in ?? ()
#11 0x74656b636150776f in ?? ()
#12 0x000a323931383d73 in ?? ()
#13 0x0000000000c11440 in ?? ()
#14 0x000000000fa4dc00 in ?? ()
#15 0x000000000fa84050 in ?? ()
#16 0x000000000fa840ce in ?? ()
#17 0x000000000fa840d0 in ?? ()</pre><p>What we are seeing here is GDB being unable to match the
      information in the core file with the executable and then presenting us
      with '<span class="literal">?? ()</span>' to indicate something is wrong. If you
      see this kind of output while generating a stack trace please identify
      the reason for this occurring and generate a new correct stack trace
      before sending it to BigWorld Support.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Retrieve_Crash_Logs"></a>13.4.&nbsp;Retrieve relevant log information</h2></div></div></div><p>Most server clusters tend not to keep all server logs for a long
    period of time due to the data storage requirement. If server logs are
    being deleted on a semi-frequent basis it is important to make a backup of
    the relevant log files so they can be referred to during crash analysis by
    either your own team or BigWorld support.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9960"></a>13.4.1.&nbsp;Generating a log summary from a core file</h3></div></div></div><p>In order to produce a quick log summary of a crash based on a core
      file you can use the MessageLogger tool mlcat.py. For example using the
      BaseApp core file from previous sections we can quickly generate a log
      summary using the following command:</p><pre class="programlisting">$ mlcat.py --around core.baseapp.pc242.3024 --context=50 &gt; core.baseapp.pc242.3024.log</pre><p>This command has queried the server logs based on the timestamp of
      the core file and saved 50 lines of context from before and after this
      time into the log file
      <code class="filename">core.baseapp.pc242.3024.log</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>As core files can be extremely large and take a long time to
        write to disk, the time stamp of a core file may be significantly
        later than the server logs (sometimes in the order of minutes
        later).</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e9975"></a>13.4.2.&nbsp;Archiving all logs</h3></div></div></div><p>It is also recommended to archive the complete set of logs
      surrounding a crash. This can be easily performed by using the mltar.py
      MessageLogger utility program as follows:</p><pre class="programlisting">$ mltar.py -zcf 20100107_logs.tar.gz                                                                                                                                     &lt;server/message_logger&gt;
Please select the segments to archive (e.g. 0,1,5-10):

  #  Time                      Duration          Entries     Size
  0  2010-01-06-09:47:07             7h            83490    4.5MB
  1  2010-01-07-10:15:31             4h            97268    5.5MB

Enter segments to archive [all]: </pre><p>In this scenario we have already identified that the crash has
      occurred at around Jan 7th at 10:16am so it would be useful to archive
      both log segments.</p><p>We now have an archive of the relevant server logs in the file
      <code class="filename">20100107_logs.tar.gz</code> which can be used by your
      internal team or by BigWorld support as required.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e9989"></a>13.5.&nbsp;Back up the crash information</h2></div></div></div><p>Having successfully identified all the files that are relevant to a
    crash, backing up the files is the next step to ensure that all data
    remains available should it be needed during the investigation process. It
    is recommended to copy all files relating to a crash into a new directory
    on a non cluster machine that is well named to help identify the data at a
    later point. For example using the core file and crash information from
    previous sections a new directory might be created such as
    <code class="filename">/home/game_admin/crashes/20100107_baseapp</code>.</p><p>You can now copy all the relevant files mentioned in the previous
    sections using scp or other network file transfer mechanisms suited to
    your environment. Below is a complete list of files recommended to
    keep.</p><div class="itemizedlist"><ul type="disc"><li><p>Core files (e.g.,
        <code class="filename">core.baseapp.pc242.3024</code>)</p></li><li><p>Binaries (e.g., <code class="filename">baseapp</code>)</p></li><li><p>Stack trace summaries (e.g.,
        <code class="filename">core.baseapp.pc242.3024.backtrace</code>)</p></li><li><p>Log file summaries (e.g.,
        <code class="filename">core.baseapp.pc242.3024.log</code>)</p></li><li><p>Complete log files (e.g.,
        <code class="filename">20100107_logs.tar.gz</code>)</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10030"></a>13.6.&nbsp;Notify BigWorld Support of the crash</h2></div></div></div><p>You should now have a collected set of information regarding the
    crash which can be sent to BigWorld Support if you find you need
    assistance with the analysis and diagnosis of the crash.</p><p>When reporting a process crash to BigWorld Support please include as
    much information as possible. After you have reviewed the core files and
    log output summary, if you believe the crash is related to any specific
    section of Python game script or other custom game resources, providing
    these files with the initial bug report can greatly speed up the time it
    will take BigWorld Support to identify an issue and assist in finding a
    solution.</p><p>When creating a support ticket please include the following
    information:</p><div class="itemizedlist"><ul type="disc"><li><p>Exact BigWorld server version used (e.g., 1.9.4.3)</p></li><li><p>All relevant stack traces (see <a href="#xref_Generate_Stack_Trace" title="13.3.&nbsp;Generate a stack trace of the process that crashed">Generate a stack trace of the process that crashed</a>)</p></li><li><p>All relevant logs (see <a href="#xref_Retrieve_Crash_Logs" title="13.4.&nbsp;Retrieve relevant log information">Retrieve relevant log information</a>)</p></li><li><p>Is the crash reproducible?</p></li><li><p>How frequently does the crash occur?</p></li></ul></div><p>By providing all the above information in the original support
    ticket it can be possible to save a number of days by allowing the support
    team to start work on the issue as quickly as possible.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10061"></a>13.6.1.&nbsp;Uploading large files</h3></div></div></div><p>If you need to upload large core files and logs to assist with the
      support process BigWorld provides an FTP location for you to upload this
      data to.</p><div class="variablelist"><dl><dt><span class="term"><a xmlns:xlink="http://www.w3.org/1999/xlink" href="ftp://ftp.bigworldtech.com" target="_top">ftp://ftp.bigworldtech.com</a></span></dt><dd><p>Username: bwguest</p><p>Password: <span class="literal">3f7eepE3</span></p></dd></dl></div><p>When using this FTP location please note that as it is in use by
      numerous customers, naming your files as specifically as possible
      greatly assists BigWorld support. The FTP is only writable by customers
      so feel free to use file names with customer and game information, for
      example
      <code class="filename">customer_cellapp_report_20100128.zip</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e10083"></a>13.6.2.&nbsp;Providing BigWorld access to your server cluster</h3></div></div></div><p>In certain scenarios it can be necessary for BigWorld support to
      require access to your server cluster in order to fully assist with an
      issue. While this is not a common occurrence it can save time if your
      staff is aware of this possibility and has a plan in place should it be
      required.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Common_Log_Messages"></a>Chapter&nbsp;14.&nbsp;Common Log Messages</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e10093">14.1. Warnings</a></span></dt><dt><span class="section"><a href="#d0e10198">14.2. Errors</a></span></dt></dl></div><p>This section provides the description of common log messages.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10093"></a>14.1.&nbsp;Warnings</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><pre class="programlisting">CellApp    WARNING  WatcherDoc::initWatcherDoc: unable to load watcherdoc/cellapp.xml </pre><p>This <span class="literal">WARNING</span> is due to an incomplete feature
        to add documentation to our watchers. We apologise if it caused any
        confusion. You can silence this warning by creating <code class="filename">cellapp.xml</code> in <code class="filename">bigworld/res/watcherdoc</code>. The file should
        contain an empty <span class="literal">root</span> section:</p><pre class="programlisting">&lt;root&gt;
&lt;/root&gt;</pre></li><li><pre class="programlisting">CellApp    WARNING  InterfaceElement::expandLength: Received a message longer than normal length</pre><p>We try to optimise network traffic by using the smallest integer
        size that can encode the expected length of the message. For example,
        if we expect the message to be always less than 255 bytes, we will use
        just one byte to encode the length. We use 2 bytes for messages that
        are expected to be less than 65535 bytes long, etc. However, if the
        message exceeds the expected size, we will fallback to using 4 bytes
        to encode the length. The above <span class="literal">WARNING</span> means that
        a message has exceeded the expected message length.</p></li><li><pre class="programlisting"> CellApp    WARNING  CellApp::handleGameTickTimeSlice: Last game tick took 0.21 seconds </pre><p>This <span class="literal">WARNING</span> means that the game tick took
        longer than the normal 0.1 seconds. This can be due to many reasons
        but usually it is due to a script function taking a long time. You
        should ensure that your script code does not do anything that takes
        significant amount of time. You may have to break your processing into
        several runs by using a timer.</p></li><li><pre class="programlisting">CellApp    WARNING  CellApp: Scaling back!!</pre><p>In response to a game tick exceeding 0.1 seconds, the CellApp
        will skip some of its usual processing to help decrease the load, e.g.
        it will reduce the amount of updates sent to the client. This
        <span class="literal">WARNING</span> is to inform you that clients may receive
        less updates e.g. entity movements may be jerky.</p></li><li><pre class="programlisting">CellApp    WARNING  cellapp.cpp:1918: Profile CALL_TIMERS took 0.12 seconds </pre><p>This means that the total time of all
        <code class="methodname">onTimer</code>() callbacks in that tick took 0.12
        seconds. This is bad because one tick should be less than 0.1
        seconds.</p><pre class="programlisting">CellApp    WARNING  cellapp.cpp:1572: Profile GAME_TICK took 0.12 seconds</pre><p>This means the game tick took more than 0.1 seconds. This time
        includes the <span class="literal">CALL_TIMERS</span> time above so almost all
        of the game tick was in <code class="methodname">onTimer</code>()
        callbacks.</p></li><li><pre class="programlisting">CellApp    WARNING  Witness::update: 474 has a deficit of 2370 bytes (10.68 packets)</pre><p>This is related to the <em class="emphasis"><span class="literal">&lt;bitsPerSecondToClient&gt;</span></em>
        configuration in <code class="filename">bw.xml</code>. If <em class="emphasis"><span class="literal">&lt;bitsPerSecondToClient&gt;</span></em>
        is 20000, then it means that the maximum number of bytes we can send
        to the client every tick is
        <span class="literal">((20000/BitsPerSecond)/UpdateHertz) - UDPOverhead =
        ((20000/8)/10) - 28 = 222 bytes</span>. The above
        <span class="literal">WARNING</span> means that we are sending 2370 bytes to the
        client in one tick. This is 10.68 times the allowed data rate.</p><p>This is usually caused by method calls to the entities located
        on the client i.e. entities in the AoI of the player or the player
        itself. If many method calls are made, or if the method calls are
        passing large arguments, then we will exceed the bandwidth allocation
        for the client. When bandwidth allocation is exceeded, the position
        updates send to the client is reduced so entity movements will become
        jerky.</p></li><li><pre class="programlisting">CellApp    WARNING  controller.cpp:158: Profile SCRIPT_CALL took 0.63 seconds
CellApp    WARNING  Controller::standardCallback: method = onTimer; id = 17648; controllerID = 270; userArg = 260
CellApp    WARNING  timer_controller.cpp:156: Profile ON_TIMER took 0.62 seconds</pre><p>The above 3 <span class="literal">WARNING</span>s are generated together.
        They mean a single <code class="methodname">onTimer</code>() callback took
        0.62 seconds. This is very bad since it means a single entity is using
        6 times a normal game tick.</p></li><li><pre class="programlisting">CellApp    WARNING  TimerController::New: Rounding up initial offset to 1 from 0 (initialOffset 0.000000)</pre><p>This means that you are adding a timer that is less than 0.1
        seconds long. Our minimum timeout is 1 tick.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10198"></a>14.2.&nbsp;Errors</h2></div></div></div><div class="itemizedlist"><ul type="disc"><li><pre class="programlisting">CellApp    ERROR    CellApp: Scale back exhausted. spareTime 0.016686 tickPeriod 0.124365, real/entities 887/887, recvs 4504 trys 3958 good 0 errs (546 sels), nub timers 753 calls 752 rescheds
	    </pre><p>The means that the game tick has exceeded 0.1 seconds for many
        ticks. The CellApp has already reduced updates to the clients to a
        minimum but still cannot keep the game tick shorter than 0.1
        seconds.</p></li><li><pre class="programlisting">CellApp    ERROR    Chunk::load: Failed to load chunk 001xfffx/sep/0010fffco: unknown error in item 'model'</pre><p>This means that there is an error loading a model in the chunk
        0010fffco. Unfortunately, there is not enough information to identify
        what is causing the error. You can try loading the space in World
        Editor and see if the same error occurs. World Editor may be able to
        provide more information about the error.</p></li><li><pre class="programlisting">CellApp    ERROR    Received message id 41 for nonexistent entity 2844 from 192.168.50.21:49140</pre><p>Message <span class="literal">41</span> is the
        <span class="literal">destroyEntity</span> message. This means that entity 2844
        was already destroyed when the CellApp received this message. Make
        sure that you have not called
        "<code class="varname">self</code>.<code class="methodname">destroy</code>()" in the
        cell and
        "<code class="varname">self</code>.<code class="methodname">destroyCellEntity</code>()"
        in the base at the same time.</p><p>This may also be an indication of a BigWorld Server bug. If you are
        not able to resolve the issue, please send us more log output around
        the time of this error.</p></li><li><pre class="programlisting">BaseApp    ERROR    BaseApp::setClient: Could not find base id 2881

BaseApp    ERROR    getProxyForCall: No proxy set!

BaseApp    ERROR    getProxyForCall: No proxy set!</pre><p>The above messages means that the entity (2881) has been
        destroyed but is still receiving messages. This may be due to another
        entity calling a method using a mailbox of the destroyed entity. You
        have to make sure that when an entity is destroyed, all other entities
        holding a mailbox to the destroyed entity is informed so that they can
        reset the mailbox.</p><p>This may also be an indication of a BigWorld Server bug. If you are
        unable to resolve the issue please send us more logs around the time
        of this error.</p></li><li><pre class="programlisting">BaseApp    ERROR    0.0.0.0:0: Exception was thrown: REASON_GENERAL_NETWORK</pre><p>This means that there was an error with the network. Either the
        machine has been disconnected from the network, or there is some sort
        of hardware error.</p></li><li><pre class="programlisting">BaseApp    ERROR    10.40.3.17:56859: Exception was thrown: REASON_NO_SUCH_PORT</pre><p>This means that either the machine has been disconnected from
        the network, or the destination process has crashed.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Clock"></a>Chapter&nbsp;15.&nbsp;Clock</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e10259">15.1. BigWorld Timing Methods</a></span></dt><dt><span class="section"><a href="#xref_Clock_source">15.2. Linux Clock Source</a></span></dt></dl></div><p>The BigWorld server relies heavily on having an accurate clock for
  timers and load calculation. Unstable clocks (clocks that may move backward)
  can cause undesired behaviour and even crashes. Therefore properly
  configuring how BigWorld reads the time is essential for a stable, efficient
  server.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10259"></a>15.1.&nbsp;BigWorld Timing Methods</h2></div></div></div><p>BigWorld provides three timing methods to select between. This can
    be configured by editing the file
    <code class="filename">/etc/bwmachined.conf</code>. For example, to use the
    <span class="literal">gettime</span> timing method, include a section like this:
    </p><pre class="programlisting">[TimingMethod]
gettime
</pre><div class="itemizedlist"><ul type="disc"><li><p><em class="emphasis"><span class="literal">rdtsc</span></em> reads
        the time stamp counter register on the CPU.</p><p>It is known to become unstable in multi-core machines where a
        process moves between cores or if frequency scaling is used. In many
        single core systems it is completely stable and could be used without
        any issues.</p></li><li><p><em class="emphasis"><span class="literal">gettime</span></em> uses
        the kernel's clock driver to access the current time.</p><p>This method is far slower than <span class="literal">rdtsc</span> but has
        the ability to draw on multiple time sources to ensure a good
        compromise between speed, accuracy and stability is reachable. For
        additional system level configuration see <a href="#xref_Clock_source" title="15.2.&nbsp;Linux Clock Source">Linux Clock Source</a>.</p></li><li><p><em class="emphasis"><span class="literal">gettimeofday</span></em>
        is a deprecated timing method.</p><p>This method of timing is similar to <span class="literal">gettime</span>
        but has a lower theoretical maximum resolution and may be disrupted by
        NTP.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_Clock_source"></a>15.2.&nbsp;Linux Clock Source</h2></div></div></div><p>Linux should automatically select an appropriate clock driver for
    its internal timekeeping, however at times the system administrator may
    need to select a different driver. If <span class="literal">gettime</span> is used
    as the timing method this will have a direct impact on how BigWorld
    behaves.</p><p>A user may check which clocksource they are using with the following
    command run as root: </p><pre class="programlisting"># cat /sys/devices/system/clocksource/clocksource0/current_clocksource</pre><p>
    You may check which options available with: </p><pre class="programlisting"># cat /sys/devices/system/clocksource/clocksource0/available_clocksource</pre><p>Both the <span class="literal">tsc</span> and <span class="literal">jiffies</span>
    options are known to be unstable. There have also been reports that
    <span class="literal">acpi_pm</span> is unstable with some motherboard chipsets. We
    suggest that the <span class="literal">hpet</span> option is used if it is
    available, or <span class="literal">acpi_pm</span> if it is not.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xref_Machine_Groups"></a>Chapter&nbsp;16.&nbsp;Machine Groups and Categories</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d0e10340">16.1. Introduction</a></span></dt><dt><span class="section"><a href="#xref_BWMachined_Machine_Groups">16.2. Configuration</a></span></dt><dt><span class="section"><a href="#d0e10381">16.3. User Defined Categories</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10340"></a>16.1.&nbsp;Introduction</h2></div></div></div><p>Machine groups are a method in which machines in a server cluster
    can be allocated to one or more named sets of machines. These groups can
    then utilised by MessageLogger, WebConsole or your own custom utilities.
    Note that the use of groups is optional.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xref_BWMachined_Machine_Groups"></a>16.2.&nbsp;Configuration</h2></div></div></div><p>Machine groups are created by placing a category
    <span class="literal">[Groups]</span> in the
    <code class="filename">/etc/bwmachined.conf</code> file, with entries containing
    the machine groups that the machine is assigned to. For example, two
    machines in the BigWorld office are allocated separately to the client and
    server team for each teams testing purposes during the week, but also
    belong to an office wide cluster group that can be used for larger scale
    weekend testing.</p><p>Machine A's <code class="filename">/etc/bwmachined.conf</code>:</p><pre class="programlisting">[Groups]
bw_client
bw_weekend_tests</pre><p>Machine B's <code class="filename">/etc/bwmachined.conf</code>:</p><pre class="programlisting">[Groups]
bw_server
bw_weekend_tests</pre><p>In WebConsole when starting a new server the option "On a group of
    machines" can then be chosen and the server will start across all machines
    contained in the selected group. For information on how to use Machine
    Groups with MessageLogger to assist scalability within a production
    environment please refer to the <a xmlns:xlink="http://www.w3.org/1999/xlink" href="server_operations_guide.html#xref_MessageLogger_Scalability" class="olink">Production Scalability</a>.</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/machine_group_start.png" align="middle"></div></div><p><span class="citetitle">Starting a server using a machine group</span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e10381"></a>16.3.&nbsp;User Defined Categories</h2></div></div></div><p>The global configuration file
    <code class="filename">/etc/bwmachined.conf</code> can contain entries for user
    defined categories, and a list of items pertaining to it. The syntax for
    these categories is as follows (<span class="literal">*</span> meaning 0 or more
    occurrences):</p><pre class="programlisting">*[category]
*item</pre><p>Server tools can query BWMachined to find the items associated with
    user categories. Categories may be used by future tools or
    customer-created tools. The following sections outline some usages of
    categories currently in use by BigWorld.</p></div></div></div></div></body></html>